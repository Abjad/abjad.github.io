

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>abjad.sequence &mdash; Abjad 3.23 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/abjad.css?v=1f187528" />
      <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../../_static/uqbar.css?v=e6773f5c" />
      <link rel="stylesheet" type="text/css" href="../../_static/lightbox2/css/lightbox.css?v=d2ef71d2" />

  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="canonical" href="https://abjad.github.io_modules/abjad/sequence.html"/>
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=01f62dc6"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/ga.js?v=c455bbd5"></script>
      <script src="../../_static/toggleprompt.js?v=5801b3bb"></script>
      <script defer="defer" src="../../_static/lightbox2/js/lightbox.js?v=bc25c2e6"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #332211" >


    <a href="../../index.html" class="icon icon-home" alt="Documentation
    Home"> Abjad 3.23



</a>




<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>


        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">First steps</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../first_steps/audience.html">Audience</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../first_steps/macos.html">macOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../first_steps/linux.html">Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../first_steps/windows.html">Windows</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../overview/containers.html">Containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/containers-basic-operations-on.html">Containers, basic operations on</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/containers-retrieving-by-name.html">Containers, retrieving by name</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/containers-time-interpretation-of.html">Containers, time interpretation of</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/contexts-lilypond-type-of.html">Contexts, LilyPond type of</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/indicators.html">Indicators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/lilypond-files-preamble-of.html">LilyPond files, preamble of</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/lilypond-format-of-abjad-objects.html">LilyPond format, of Abjad objects</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../examples/corpus-selection.html">Corpus, figure selection from</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/design-by-dyads.html">Design, by dyads</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/enumeration.html">Enumeration, of rhythmic cells</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/magic-square-from-twelve-tone-row.html">Magic square, from twelve-tone row</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/scales-diatonic.html">Scales, diatonic</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/score-fragment-piano.html">Score fragment, piano</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">All classes &amp; functions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">Abjad API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Appendices</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../appendices/best-practices.html">Best practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendices/changes.html">Changes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendices/community.html">Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendices/configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendices/developer-installation.html">Developer installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendices/lilypond-context-concatenation.html">LilyPond context concatenation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendices/publications.html">Publications</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Score gallery</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../gallery-2020.html">2016-present</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gallery-2015.html">2015-11</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gallery-2010.html">2010-00</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #332211" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Abjad</a>
      </nav>

      <div class="wy-nav-content">

<div class="rst-content style-external-links">

    


    <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
    <div itemprop="articleBody">
    
  <h1>Source code for abjad.sequence</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">builtins</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">collections</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">copy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">fractions</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">itertools</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">typing</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">cyclictuple</span> <span class="k">as</span> <span class="n">_cyclictuple</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">enums</span> <span class="k">as</span> <span class="n">_enums</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">math</span> <span class="k">as</span> <span class="n">_math</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_partition_sequence_cyclically_by_weights_at_least</span><span class="p">(</span>
    <span class="n">sequence</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">overhang</span><span class="o">=</span><span class="kc">False</span>
<span class="p">):</span>
    <span class="n">l_copy</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">current_part</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">target_weight_index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">len_weights</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">l_copy</span><span class="p">:</span>
        <span class="n">target_weight</span> <span class="o">=</span> <span class="n">weights</span><span class="p">[</span><span class="n">target_weight_index</span> <span class="o">%</span> <span class="n">len_weights</span><span class="p">]</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">l_copy</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">current_part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">target_weight</span> <span class="o">&lt;=</span> <span class="n">_math</span><span class="o">.</span><span class="n">weight</span><span class="p">(</span><span class="n">current_part</span><span class="p">):</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_part</span><span class="p">)</span>
            <span class="n">current_part</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">target_weight_index</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">l_copy</span>
    <span class="k">if</span> <span class="n">current_part</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">overhang</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_part</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="n">sequence</span><span class="p">)(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">result</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_partition_sequence_cyclically_by_weights_at_most</span><span class="p">(</span>
    <span class="n">sequence</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">overhang</span><span class="o">=</span><span class="kc">False</span>
<span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">current_part</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">current_target_weight_index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">current_target_weight</span> <span class="o">=</span> <span class="n">weights</span><span class="p">[</span><span class="n">current_target_weight_index</span><span class="p">]</span>
    <span class="n">l_copy</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">l_copy</span><span class="p">:</span>
        <span class="n">current_target_weight</span> <span class="o">=</span> <span class="n">weights</span><span class="p">[</span><span class="n">current_target_weight_index</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="p">)]</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">l_copy</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">current_part_weight</span> <span class="o">=</span> <span class="n">_math</span><span class="o">.</span><span class="n">weight</span><span class="p">(</span><span class="n">current_part</span><span class="p">)</span>
        <span class="n">candidate_part_weight</span> <span class="o">=</span> <span class="n">current_part_weight</span> <span class="o">+</span> <span class="n">_math</span><span class="o">.</span><span class="n">weight</span><span class="p">([</span><span class="n">item</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">candidate_part_weight</span> <span class="o">&lt;</span> <span class="n">current_target_weight</span><span class="p">:</span>
            <span class="n">current_part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">candidate_part_weight</span> <span class="o">==</span> <span class="n">current_target_weight</span><span class="p">:</span>
            <span class="n">current_part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_part</span><span class="p">)</span>
            <span class="n">current_part</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">current_target_weight_index</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">current_target_weight</span> <span class="o">&lt;</span> <span class="n">candidate_part_weight</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">current_part</span><span class="p">:</span>
                <span class="n">l_copy</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_part</span><span class="p">)</span>
                <span class="n">current_part</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">current_target_weight_index</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;elements in sequence too big.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;candidate and target rates must compare.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">current_part</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">overhang</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_part</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="n">sequence</span><span class="p">)(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">result</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_partition_sequence_once_by_weights_at_least</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">overhang</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">current_part</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">l_copy</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">num_weight</span><span class="p">,</span> <span class="n">target_weight</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">weights</span><span class="p">):</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">item</span> <span class="o">=</span> <span class="n">l_copy</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">num_weight</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">current_part</span><span class="p">:</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_part</span><span class="p">)</span>
                        <span class="k">break</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;too few elements in sequence.&quot;</span><span class="p">)</span>
            <span class="n">current_part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">target_weight</span> <span class="o">&lt;=</span> <span class="n">_math</span><span class="o">.</span><span class="n">weight</span><span class="p">(</span><span class="n">current_part</span><span class="p">):</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_part</span><span class="p">)</span>
                <span class="n">current_part</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">break</span>
    <span class="k">if</span> <span class="n">l_copy</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">overhang</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l_copy</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="n">sequence</span><span class="p">)(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">result</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_partition_sequence_once_by_weights_at_most</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">overhang</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">l_copy</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">current_part</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">target_weight</span> <span class="ow">in</span> <span class="n">weights</span><span class="p">:</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">item</span> <span class="o">=</span> <span class="n">l_copy</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;too few elements in sequence.&quot;</span><span class="p">)</span>
            <span class="n">current_weight</span> <span class="o">=</span> <span class="n">_math</span><span class="o">.</span><span class="n">weight</span><span class="p">(</span><span class="n">current_part</span><span class="p">)</span>
            <span class="n">candidate_weight</span> <span class="o">=</span> <span class="n">current_weight</span> <span class="o">+</span> <span class="n">_math</span><span class="o">.</span><span class="n">weight</span><span class="p">([</span><span class="n">item</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">candidate_weight</span> <span class="o">&lt;</span> <span class="n">target_weight</span><span class="p">:</span>
                <span class="n">current_part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">candidate_weight</span> <span class="o">==</span> <span class="n">target_weight</span><span class="p">:</span>
                <span class="n">current_part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_part</span><span class="p">)</span>
                <span class="n">current_part</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">break</span>
            <span class="k">elif</span> <span class="n">target_weight</span> <span class="o">&lt;</span> <span class="n">candidate_weight</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">current_part</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_part</span><span class="p">)</span>
                    <span class="n">current_part</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">l_copy</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;elements in sequence too big.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;candidate and target weights must compare.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">overhang</span><span class="p">:</span>
        <span class="n">left_over</span> <span class="o">=</span> <span class="n">current_part</span> <span class="o">+</span> <span class="n">l_copy</span>
        <span class="k">if</span> <span class="n">left_over</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">left_over</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="n">sequence</span><span class="p">)(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">result</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">result</span>


<div class="viewcode-block" id="partition_by_counts">
<a class="viewcode-back" href="../../api/abjad/sequence.html#abjad.sequence.partition_by_counts">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">partition_by_counts</span><span class="p">(</span>
    <span class="n">sequence</span><span class="p">,</span>
    <span class="n">counts</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">cyclic</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">enchain</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">overhang</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="n">_enums</span><span class="o">.</span><span class="n">Comparison</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">reversed_</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Partitions ``sequence`` by ``counts``.</span>

<span class="sd">    Partitions sequence once by counts without overhang:</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; sequence = list(range(16))</span>
<span class="sd">        &gt;&gt;&gt; sequence = abjad.sequence.partition_by_counts(</span>
<span class="sd">        ...     sequence,</span>
<span class="sd">        ...     [3],</span>
<span class="sd">        ...     cyclic=False,</span>
<span class="sd">        ...     overhang=False,</span>
<span class="sd">        ... )</span>

<span class="sd">        &gt;&gt;&gt; sequence</span>
<span class="sd">        [[0, 1, 2]]</span>

<span class="sd">        &gt;&gt;&gt; for part in sequence:</span>
<span class="sd">        ...     part</span>
<span class="sd">        [0, 1, 2]</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Partitions sequence once by counts without overhang:</span>

<span class="sd">        &gt;&gt;&gt; sequence = list(range(16))</span>
<span class="sd">        &gt;&gt;&gt; parts = abjad.sequence.partition_by_counts(</span>
<span class="sd">        ...     sequence,</span>
<span class="sd">        ...     [4, 3],</span>
<span class="sd">        ...     cyclic=False,</span>
<span class="sd">        ...     overhang=False,</span>
<span class="sd">        ... )</span>

<span class="sd">        &gt;&gt;&gt; for part in parts:</span>
<span class="sd">        ...     part</span>
<span class="sd">        [0, 1, 2, 3]</span>
<span class="sd">        [4, 5, 6]</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Partitions sequence cyclically by counts without overhang:</span>

<span class="sd">        &gt;&gt;&gt; sequence = list(range(16))</span>
<span class="sd">        &gt;&gt;&gt; parts = abjad.sequence.partition_by_counts(</span>
<span class="sd">        ...     sequence,</span>
<span class="sd">        ...     [3],</span>
<span class="sd">        ...     cyclic=True,</span>
<span class="sd">        ...     overhang=False,</span>
<span class="sd">        ... )</span>

<span class="sd">        &gt;&gt;&gt; for part in parts:</span>
<span class="sd">        ...     part</span>
<span class="sd">        [0, 1, 2]</span>
<span class="sd">        [3, 4, 5]</span>
<span class="sd">        [6, 7, 8]</span>
<span class="sd">        [9, 10, 11]</span>
<span class="sd">        [12, 13, 14]</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Partitions sequence cyclically by counts without overhang:</span>

<span class="sd">        &gt;&gt;&gt; sequence = list(range(16))</span>
<span class="sd">        &gt;&gt;&gt; parts = abjad.sequence.partition_by_counts(</span>
<span class="sd">        ...     sequence,</span>
<span class="sd">        ...     [4, 3],</span>
<span class="sd">        ...     cyclic=True,</span>
<span class="sd">        ...     overhang=False,</span>
<span class="sd">        ... )</span>

<span class="sd">        &gt;&gt;&gt; for part in parts:</span>
<span class="sd">        ...     part</span>
<span class="sd">        [0, 1, 2, 3]</span>
<span class="sd">        [4, 5, 6]</span>
<span class="sd">        [7, 8, 9, 10]</span>
<span class="sd">        [11, 12, 13]</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Partitions sequence once by counts with overhang:</span>

<span class="sd">        &gt;&gt;&gt; sequence = list(range(16))</span>
<span class="sd">        &gt;&gt;&gt; parts = abjad.sequence.partition_by_counts(</span>
<span class="sd">        ...     sequence,</span>
<span class="sd">        ...     [3],</span>
<span class="sd">        ...     cyclic=False,</span>
<span class="sd">        ...     overhang=True,</span>
<span class="sd">        ... )</span>

<span class="sd">        &gt;&gt;&gt; for part in parts:</span>
<span class="sd">        ...     part</span>
<span class="sd">        [0, 1, 2]</span>
<span class="sd">        [3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15]</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Partitions sequence once by counts with overhang:</span>

<span class="sd">        &gt;&gt;&gt; sequence = list(range(16))</span>
<span class="sd">        &gt;&gt;&gt; parts = abjad.sequence.partition_by_counts(</span>
<span class="sd">        ...     sequence,</span>
<span class="sd">        ...     [4, 3],</span>
<span class="sd">        ...     cyclic=False,</span>
<span class="sd">        ...     overhang=True,</span>
<span class="sd">        ... )</span>

<span class="sd">        &gt;&gt;&gt; for part in parts:</span>
<span class="sd">        ...     part</span>
<span class="sd">        [0, 1, 2, 3]</span>
<span class="sd">        [4, 5, 6]</span>
<span class="sd">        [7, 8, 9, 10, 11, 12, 13, 14, 15]</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Partitions sequence cyclically by counts with overhang:</span>

<span class="sd">        &gt;&gt;&gt; sequence = list(range(16))</span>
<span class="sd">        &gt;&gt;&gt; parts = abjad.sequence.partition_by_counts(</span>
<span class="sd">        ...     sequence,</span>
<span class="sd">        ...     [3],</span>
<span class="sd">        ...     cyclic=True,</span>
<span class="sd">        ...     overhang=True,</span>
<span class="sd">        ... )</span>

<span class="sd">        &gt;&gt;&gt; for part in parts:</span>
<span class="sd">        ...     part</span>
<span class="sd">        [0, 1, 2]</span>
<span class="sd">        [3, 4, 5]</span>
<span class="sd">        [6, 7, 8]</span>
<span class="sd">        [9, 10, 11]</span>
<span class="sd">        [12, 13, 14]</span>
<span class="sd">        [15]</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Partitions sequence cyclically by counts with overhang:</span>

<span class="sd">        &gt;&gt;&gt; sequence = list(range(16))</span>
<span class="sd">        &gt;&gt;&gt; parts = abjad.sequence.partition_by_counts(</span>
<span class="sd">        ...     sequence,</span>
<span class="sd">        ...     [4, 3],</span>
<span class="sd">        ...     cyclic=True,</span>
<span class="sd">        ...     overhang=True,</span>
<span class="sd">        ... )</span>

<span class="sd">        &gt;&gt;&gt; for part in parts:</span>
<span class="sd">        ...     part</span>
<span class="sd">        [0, 1, 2, 3]</span>
<span class="sd">        [4, 5, 6]</span>
<span class="sd">        [7, 8, 9, 10]</span>
<span class="sd">        [11, 12, 13]</span>
<span class="sd">        [14, 15]</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Reverse-partitions sequence once by counts without overhang:</span>

<span class="sd">        &gt;&gt;&gt; sequence = list(range(16))</span>
<span class="sd">        &gt;&gt;&gt; parts = abjad.sequence.partition_by_counts(</span>
<span class="sd">        ...     sequence,</span>
<span class="sd">        ...     [3],</span>
<span class="sd">        ...     cyclic=False,</span>
<span class="sd">        ...     overhang=False,</span>
<span class="sd">        ...     reversed_=True,</span>
<span class="sd">        ... )</span>

<span class="sd">        &gt;&gt;&gt; for part in parts:</span>
<span class="sd">        ...     part</span>
<span class="sd">        [13, 14, 15]</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Reverse-partitions sequence once by counts without overhang:</span>

<span class="sd">        &gt;&gt;&gt; sequence = list(range(16))</span>
<span class="sd">        &gt;&gt;&gt; parts = abjad.sequence.partition_by_counts(</span>
<span class="sd">        ...     sequence,</span>
<span class="sd">        ...     [4, 3],</span>
<span class="sd">        ...     cyclic=False,</span>
<span class="sd">        ...     overhang=False,</span>
<span class="sd">        ...     reversed_=True,</span>
<span class="sd">        ... )</span>

<span class="sd">        &gt;&gt;&gt; for part in parts:</span>
<span class="sd">        ...     part</span>
<span class="sd">        [9, 10, 11]</span>
<span class="sd">        [12, 13, 14, 15]</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Reverse-partitions sequence cyclically by counts without overhang:</span>

<span class="sd">        &gt;&gt;&gt; sequence = list(range(16))</span>
<span class="sd">        &gt;&gt;&gt; parts = abjad.sequence.partition_by_counts(</span>
<span class="sd">        ...     sequence,</span>
<span class="sd">        ...     [3],</span>
<span class="sd">        ...     cyclic=True,</span>
<span class="sd">        ...     overhang=False,</span>
<span class="sd">        ...     reversed_=True,</span>
<span class="sd">        ... )</span>

<span class="sd">        &gt;&gt;&gt; for part in parts:</span>
<span class="sd">        ...     part</span>
<span class="sd">        [1, 2, 3]</span>
<span class="sd">        [4, 5, 6]</span>
<span class="sd">        [7, 8, 9]</span>
<span class="sd">        [10, 11, 12]</span>
<span class="sd">        [13, 14, 15]</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Reverse-partitions sequence cyclically by counts without overhang:</span>

<span class="sd">        &gt;&gt;&gt; sequence = list(range(16))</span>
<span class="sd">        &gt;&gt;&gt; parts = abjad.sequence.partition_by_counts(</span>
<span class="sd">        ...     sequence,</span>
<span class="sd">        ...     [4, 3],</span>
<span class="sd">        ...     cyclic=True,</span>
<span class="sd">        ...     overhang=False,</span>
<span class="sd">        ...     reversed_=True,</span>
<span class="sd">        ... )</span>

<span class="sd">        &gt;&gt;&gt; for part in parts:</span>
<span class="sd">        ...     part</span>
<span class="sd">        [2, 3, 4]</span>
<span class="sd">        [5, 6, 7, 8]</span>
<span class="sd">        [9, 10, 11]</span>
<span class="sd">        [12, 13, 14, 15]</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Reverse-partitions sequence once by counts with overhang:</span>

<span class="sd">        &gt;&gt;&gt; sequence = list(range(16))</span>
<span class="sd">        &gt;&gt;&gt; parts = abjad.sequence.partition_by_counts(</span>
<span class="sd">        ...     sequence,</span>
<span class="sd">        ...     [3],</span>
<span class="sd">        ...     cyclic=False,</span>
<span class="sd">        ...     overhang=True,</span>
<span class="sd">        ...     reversed_=True,</span>
<span class="sd">        ... )</span>

<span class="sd">        &gt;&gt;&gt; for part in parts:</span>
<span class="sd">        ...     part</span>
<span class="sd">        [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]</span>
<span class="sd">        [13, 14, 15]</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Reverse-partitions sequence once by counts with overhang:</span>

<span class="sd">        &gt;&gt;&gt; sequence = list(range(16))</span>
<span class="sd">        &gt;&gt;&gt; parts = abjad.sequence.partition_by_counts(</span>
<span class="sd">        ...     sequence,</span>
<span class="sd">        ...     [4, 3],</span>
<span class="sd">        ...     cyclic=False,</span>
<span class="sd">        ...     overhang=True,</span>
<span class="sd">        ...     reversed_=True,</span>
<span class="sd">        ... )</span>

<span class="sd">        &gt;&gt;&gt; for part in parts:</span>
<span class="sd">        ...     part</span>
<span class="sd">        [0, 1, 2, 3, 4, 5, 6, 7, 8]</span>
<span class="sd">        [9, 10, 11]</span>
<span class="sd">        [12, 13, 14, 15]</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Reverse-partitions sequence cyclically by counts with overhang:</span>

<span class="sd">        &gt;&gt;&gt; sequence = list(range(16))</span>
<span class="sd">        &gt;&gt;&gt; parts = abjad.sequence.partition_by_counts(</span>
<span class="sd">        ...     sequence,</span>
<span class="sd">        ...     [3],</span>
<span class="sd">        ...     cyclic=True,</span>
<span class="sd">        ...     overhang=True,</span>
<span class="sd">        ...     reversed_=True,</span>
<span class="sd">        ... )</span>

<span class="sd">        &gt;&gt;&gt; for part in parts:</span>
<span class="sd">        ...     part</span>
<span class="sd">        [0]</span>
<span class="sd">        [1, 2, 3]</span>
<span class="sd">        [4, 5, 6]</span>
<span class="sd">        [7, 8, 9]</span>
<span class="sd">        [10, 11, 12]</span>
<span class="sd">        [13, 14, 15]</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Reverse-partitions sequence cyclically by counts with overhang:</span>

<span class="sd">        &gt;&gt;&gt; sequence = list(range(16))</span>
<span class="sd">        &gt;&gt;&gt; parts = abjad.sequence.partition_by_counts(</span>
<span class="sd">        ...     sequence,</span>
<span class="sd">        ...     [4, 3],</span>
<span class="sd">        ...     cyclic=True,</span>
<span class="sd">        ...     overhang=True,</span>
<span class="sd">        ...     reversed_=True,</span>
<span class="sd">        ... )</span>

<span class="sd">        &gt;&gt;&gt; for part in parts:</span>
<span class="sd">        ...     part</span>
<span class="sd">        [0, 1]</span>
<span class="sd">        [2, 3, 4]</span>
<span class="sd">        [5, 6, 7, 8]</span>
<span class="sd">        [9, 10, 11]</span>
<span class="sd">        [12, 13, 14, 15]</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Partitions sequence once by counts and asserts that sequence partitions</span>
<span class="sd">        exactly (with no overhang):</span>

<span class="sd">        &gt;&gt;&gt; sequence = list(range(10))</span>
<span class="sd">        &gt;&gt;&gt; parts = abjad.sequence.partition_by_counts(</span>
<span class="sd">        ...     sequence,</span>
<span class="sd">        ...     [2, 3, 5],</span>
<span class="sd">        ...     cyclic=False,</span>
<span class="sd">        ...     overhang=abjad.EXACT,</span>
<span class="sd">        ... )</span>

<span class="sd">        &gt;&gt;&gt; for part in parts:</span>
<span class="sd">        ...     part</span>
<span class="sd">        [0, 1]</span>
<span class="sd">        [2, 3, 4]</span>
<span class="sd">        [5, 6, 7, 8, 9]</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Partitions sequence cyclically by counts and asserts that sequence partitions</span>
<span class="sd">        exactly. Exact partitioning means partitioning with no overhang:</span>

<span class="sd">        &gt;&gt;&gt; sequence = list(range(10))</span>
<span class="sd">        &gt;&gt;&gt; parts = abjad.sequence.partition_by_counts(</span>
<span class="sd">        ...     sequence,</span>
<span class="sd">        ...     [2],</span>
<span class="sd">        ...     cyclic=True,</span>
<span class="sd">        ...     overhang=abjad.EXACT,</span>
<span class="sd">        ... )</span>

<span class="sd">        &gt;&gt;&gt; for part in parts:</span>
<span class="sd">        ...     part</span>
<span class="sd">        [0, 1]</span>
<span class="sd">        [2, 3]</span>
<span class="sd">        [4, 5]</span>
<span class="sd">        [6, 7]</span>
<span class="sd">        [8, 9]</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Partitions string:</span>

<span class="sd">        &gt;&gt;&gt; sequence = list(&quot;some text&quot;)</span>
<span class="sd">        &gt;&gt;&gt; parts = abjad.sequence.partition_by_counts(</span>
<span class="sd">        ...     sequence,</span>
<span class="sd">        ...     [3],</span>
<span class="sd">        ...     cyclic=False,</span>
<span class="sd">        ...     overhang=True,</span>
<span class="sd">        ... )</span>

<span class="sd">        &gt;&gt;&gt; for part in parts:</span>
<span class="sd">        ...     part</span>
<span class="sd">        [&#39;s&#39;, &#39;o&#39;, &#39;m&#39;]</span>
<span class="sd">        [&#39;e&#39;, &#39; &#39;, &#39;t&#39;, &#39;e&#39;, &#39;x&#39;, &#39;t&#39;]</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Partitions sequence cyclically into enchained parts by counts; truncates</span>
<span class="sd">        overhang:</span>

<span class="sd">        &gt;&gt;&gt; sequence = list(range(16))</span>
<span class="sd">        &gt;&gt;&gt; parts = abjad.sequence.partition_by_counts(</span>
<span class="sd">        ...     sequence,</span>
<span class="sd">        ...     [2, 6],</span>
<span class="sd">        ...     cyclic=True,</span>
<span class="sd">        ...     enchain=True,</span>
<span class="sd">        ...     overhang=False,</span>
<span class="sd">        ... )</span>

<span class="sd">        &gt;&gt;&gt; for part in parts:</span>
<span class="sd">        ...     part</span>
<span class="sd">        [0, 1]</span>
<span class="sd">        [1, 2, 3, 4, 5, 6]</span>
<span class="sd">        [6, 7]</span>
<span class="sd">        [7, 8, 9, 10, 11, 12]</span>
<span class="sd">        [12, 13]</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Partitions sequence cyclically into enchained parts by counts; returns</span>
<span class="sd">        overhang at end:</span>

<span class="sd">        &gt;&gt;&gt; sequence = list(range(16))</span>
<span class="sd">        &gt;&gt;&gt; parts = abjad.sequence.partition_by_counts(</span>
<span class="sd">        ...     sequence,</span>
<span class="sd">        ...     [2, 6],</span>
<span class="sd">        ...     cyclic=True,</span>
<span class="sd">        ...     enchain=True,</span>
<span class="sd">        ...     overhang=True,</span>
<span class="sd">        ... )</span>

<span class="sd">        &gt;&gt;&gt; for part in parts:</span>
<span class="sd">        ...     part</span>
<span class="sd">        [0, 1]</span>
<span class="sd">        [1, 2, 3, 4, 5, 6]</span>
<span class="sd">        [6, 7]</span>
<span class="sd">        [7, 8, 9, 10, 11, 12]</span>
<span class="sd">        [12, 13]</span>
<span class="sd">        [13, 14, 15]</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        REGRESSION: partitions sequence cyclically into enchained parts by counts;</span>
<span class="sd">        does not return false 1-element part at end:</span>

<span class="sd">        &gt;&gt;&gt; sequence = list(range(16))</span>
<span class="sd">        &gt;&gt;&gt; parts = abjad.sequence.partition_by_counts(</span>
<span class="sd">        ...     sequence,</span>
<span class="sd">        ...     [5],</span>
<span class="sd">        ...     cyclic=True,</span>
<span class="sd">        ...     enchain=True,</span>
<span class="sd">        ...     overhang=True,</span>
<span class="sd">        ... )</span>

<span class="sd">        &gt;&gt;&gt; for part in parts:</span>
<span class="sd">        ...     part</span>
<span class="sd">        [0, 1, 2, 3, 4]</span>
<span class="sd">        [4, 5, 6, 7, 8]</span>
<span class="sd">        [8, 9, 10, 11, 12]</span>
<span class="sd">        [12, 13, 14, 15]</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Edge case: empty counts nests sequence and ignores keywords:</span>

<span class="sd">        &gt;&gt;&gt; sequence = list(range(16))</span>
<span class="sd">        &gt;&gt;&gt; parts = abjad.sequence.partition_by_counts(sequence, [])</span>

<span class="sd">        &gt;&gt;&gt; for part in parts:</span>
<span class="sd">        ...     part</span>
<span class="sd">        [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15]</span>

<span class="sd">    Returns list of ``sequence`` types.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cyclic</span><span class="p">,</span> <span class="nb">bool</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">cyclic</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">enchain</span><span class="p">,</span> <span class="nb">bool</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">enchain</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">overhang</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">_enums</span><span class="o">.</span><span class="n">EXACT</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">overhang</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reversed_</span><span class="p">,</span> <span class="nb">bool</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">reversed_</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">_</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">counts</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;must be nonnegative integers: </span><span class="si">{</span><span class="n">counts</span><span class="si">!r}</span><span class="s2">.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">reversed_</span><span class="p">:</span>
        <span class="n">sequence</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">sequence</span><span class="p">)(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">sequence</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">counts</span><span class="p">:</span>
        <span class="n">counts</span> <span class="o">=</span> <span class="n">_cyclictuple</span><span class="o">.</span><span class="n">CyclicTuple</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">sequence</span><span class="p">)([</span><span class="n">sequence</span><span class="p">])</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">i</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="n">count</span>
        <span class="n">part</span> <span class="o">=</span> <span class="n">sequence</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">stop</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">enchain</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">part</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">part</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">break</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cyclic</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">i</span><span class="p">:</span>
            <span class="n">part</span> <span class="o">=</span> <span class="n">sequence</span><span class="p">[</span><span class="n">start</span><span class="p">:]</span>
            <span class="k">break</span>
        <span class="k">if</span> <span class="n">enchain</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">part</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">overhang</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">overhang</span> <span class="ow">is</span> <span class="n">_enums</span><span class="o">.</span><span class="n">EXACT</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">part</span><span class="p">)</span> <span class="o">==</span> <span class="n">count</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">overhang</span> <span class="ow">is</span> <span class="n">_enums</span><span class="o">.</span><span class="n">EXACT</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">part</span><span class="p">)</span> <span class="o">!=</span> <span class="n">count</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;sequence does not partition exactly.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">reversed_</span><span class="p">:</span>
        <span class="n">result_</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
            <span class="n">part_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
            <span class="n">part</span> <span class="o">=</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
            <span class="n">part</span> <span class="o">=</span> <span class="n">part_type</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
            <span class="n">result_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result_</span>
    <span class="k">return</span> <span class="n">result</span></div>



<div class="viewcode-block" id="partition_by_ratio_of_lengths">
<a class="viewcode-back" href="../../api/abjad/sequence.html#abjad.sequence.partition_by_ratio_of_lengths">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">partition_by_ratio_of_lengths</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="n">ratio</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Partitions ``sequence`` by ``ratio`` of lengths.</span>

<span class="sd">    Partitions sequence by ``1:1:1`` ratio:</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; numbers = list(range(10))</span>
<span class="sd">        &gt;&gt;&gt; ratio = (1, 1, 1)</span>

<span class="sd">        &gt;&gt;&gt; for part in abjad.sequence.partition_by_ratio_of_lengths(numbers, ratio):</span>
<span class="sd">        ...     part</span>
<span class="sd">        [0, 1, 2]</span>
<span class="sd">        [3, 4, 5, 6]</span>
<span class="sd">        [7, 8, 9]</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Partitions sequence by ``1:1:2`` ratio:</span>

<span class="sd">        &gt;&gt;&gt; numbers = list(range(10))</span>
<span class="sd">        &gt;&gt;&gt; ratio = (1, 1, 2)</span>

<span class="sd">        &gt;&gt;&gt; for part in abjad.sequence.partition_by_ratio_of_lengths(numbers, ratio):</span>
<span class="sd">        ...     part</span>
<span class="sd">        [0, 1, 2]</span>
<span class="sd">        [3, 4]</span>
<span class="sd">        [5, 6, 7, 8, 9]</span>

<span class="sd">    Returns list of ``sequence`` types.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ratio</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">ratio</span><span class="p">)</span>
    <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>
    <span class="n">counts</span> <span class="o">=</span> <span class="n">_math</span><span class="o">.</span><span class="n">partition_integer_by_ratio</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">ratio</span><span class="p">)</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="n">partition_by_counts</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="n">cyclic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">overhang</span><span class="o">=</span><span class="n">_enums</span><span class="o">.</span><span class="n">EXACT</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">parts</span></div>



<div class="viewcode-block" id="partition_by_ratio_of_weights">
<a class="viewcode-back" href="../../api/abjad/sequence.html#abjad.sequence.partition_by_ratio_of_weights">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">partition_by_ratio_of_weights</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="n">weights</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Partitions ``sequence`` by ratio of ``weights``.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; ratio = (1, 1, 1)</span>
<span class="sd">        &gt;&gt;&gt; sequence = list(10 * [1])</span>
<span class="sd">        &gt;&gt;&gt; sequence = abjad.sequence.partition_by_ratio_of_weights(sequence, ratio)</span>
<span class="sd">        &gt;&gt;&gt; for item in sequence:</span>
<span class="sd">        ...     item</span>
<span class="sd">        ...</span>
<span class="sd">        [1, 1, 1]</span>
<span class="sd">        [1, 1, 1, 1]</span>
<span class="sd">        [1, 1, 1]</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; ratio = (1, 1, 1, 1)</span>
<span class="sd">        &gt;&gt;&gt; sequence = list(10 * [1])</span>
<span class="sd">        &gt;&gt;&gt; sequence = abjad.sequence.partition_by_ratio_of_weights(sequence, ratio)</span>
<span class="sd">        &gt;&gt;&gt; for item in sequence:</span>
<span class="sd">        ...     item</span>
<span class="sd">        ...</span>
<span class="sd">        [1, 1, 1]</span>
<span class="sd">        [1, 1]</span>
<span class="sd">        [1, 1, 1]</span>
<span class="sd">        [1, 1]</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; ratio = (2, 2, 3)</span>
<span class="sd">        &gt;&gt;&gt; sequence = list(10 * [1])</span>
<span class="sd">        &gt;&gt;&gt; sequence = abjad.sequence.partition_by_ratio_of_weights(sequence, ratio)</span>
<span class="sd">        &gt;&gt;&gt; for item in sequence:</span>
<span class="sd">        ...     item</span>
<span class="sd">        ...</span>
<span class="sd">        [1, 1, 1]</span>
<span class="sd">        [1, 1, 1]</span>
<span class="sd">        [1, 1, 1, 1]</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; ratio = (3, 2, 2)</span>
<span class="sd">        &gt;&gt;&gt; sequence = list(10 * [1])</span>
<span class="sd">        &gt;&gt;&gt; sequence = abjad.sequence.partition_by_ratio_of_weights(sequence, ratio)</span>
<span class="sd">        &gt;&gt;&gt; for item in sequence:</span>
<span class="sd">        ...     item</span>
<span class="sd">        ...</span>
<span class="sd">        [1, 1, 1, 1]</span>
<span class="sd">        [1, 1, 1]</span>
<span class="sd">        [1, 1, 1]</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; ratio = (1, 1)</span>
<span class="sd">        &gt;&gt;&gt; items = [1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2]</span>
<span class="sd">        &gt;&gt;&gt; sequence = list(items)</span>
<span class="sd">        &gt;&gt;&gt; sequence = abjad.sequence.partition_by_ratio_of_weights(sequence, ratio)</span>
<span class="sd">        &gt;&gt;&gt; for item in sequence:</span>
<span class="sd">        ...     item</span>
<span class="sd">        ...</span>
<span class="sd">        [1, 1, 1, 1, 1, 1, 2, 2]</span>
<span class="sd">        [2, 2, 2, 2]</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; ratio = (1, 1, 1)</span>
<span class="sd">        &gt;&gt;&gt; items = [1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2]</span>
<span class="sd">        &gt;&gt;&gt; sequence = list(items)</span>
<span class="sd">        &gt;&gt;&gt; sequence = abjad.sequence.partition_by_ratio_of_weights(sequence, ratio)</span>
<span class="sd">        &gt;&gt;&gt; for item in sequence:</span>
<span class="sd">        ...     item</span>
<span class="sd">        ...</span>
<span class="sd">        [1, 1, 1, 1, 1, 1]</span>
<span class="sd">        [2, 2, 2]</span>
<span class="sd">        [2, 2, 2]</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; ratio = (1, 1, 1)</span>
<span class="sd">        &gt;&gt;&gt; sequence = list([5, 5])</span>
<span class="sd">        &gt;&gt;&gt; sequence = abjad.sequence.partition_by_ratio_of_weights(sequence, ratio)</span>
<span class="sd">        &gt;&gt;&gt; for item in sequence:</span>
<span class="sd">        ...     item</span>
<span class="sd">        ...</span>
<span class="sd">        [5]</span>
<span class="sd">        [5]</span>
<span class="sd">        []</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; ratio = (1, 1, 1, 1)</span>
<span class="sd">        &gt;&gt;&gt; sequence = list([5, 5])</span>
<span class="sd">        &gt;&gt;&gt; sequence = abjad.sequence.partition_by_ratio_of_weights(sequence, ratio)</span>
<span class="sd">        &gt;&gt;&gt; for item in sequence:</span>
<span class="sd">        ...     item</span>
<span class="sd">        ...</span>
<span class="sd">        [5]</span>
<span class="sd">        []</span>
<span class="sd">        [5]</span>
<span class="sd">        []</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; ratio = (2, 2, 3)</span>
<span class="sd">        &gt;&gt;&gt; sequence = list([5, 5])</span>
<span class="sd">        &gt;&gt;&gt; sequence = abjad.sequence.partition_by_ratio_of_weights(sequence, ratio)</span>
<span class="sd">        &gt;&gt;&gt; for item in sequence:</span>
<span class="sd">        ...     item</span>
<span class="sd">        ...</span>
<span class="sd">        [5]</span>
<span class="sd">        [5]</span>
<span class="sd">        []</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; ratio = (3, 2, 2)</span>
<span class="sd">        &gt;&gt;&gt; sequence = list([5, 5])</span>
<span class="sd">        &gt;&gt;&gt; sequence = abjad.sequence.partition_by_ratio_of_weights(sequence, ratio)</span>
<span class="sd">        &gt;&gt;&gt; for item in sequence:</span>
<span class="sd">        ...     item</span>
<span class="sd">        ...</span>
<span class="sd">        [5]</span>
<span class="sd">        [5]</span>
<span class="sd">        []</span>

<span class="sd">    Rounded weight-proportions of sequences returned equal to rounded ``weights``.</span>

<span class="sd">    Returns list of ``sequence`` types.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">fractions</span><span class="o">.</span><span class="n">Fraction</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">)</span>
    <span class="n">sequence_weight</span> <span class="o">=</span> <span class="n">_math</span><span class="o">.</span><span class="n">weight</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>
    <span class="n">partitioned_weights</span> <span class="o">=</span> <span class="n">_math</span><span class="o">.</span><span class="n">partition_integer_by_ratio</span><span class="p">(</span><span class="n">sequence_weight</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
    <span class="n">cumulative_weights</span> <span class="o">=</span> <span class="n">_math</span><span class="o">.</span><span class="n">cumulative_sums</span><span class="p">(</span><span class="n">partitioned_weights</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">sublist</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sublist</span><span class="p">)</span>
    <span class="n">current_cumulative_weight</span> <span class="o">=</span> <span class="n">cumulative_weights</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">:</span>
        <span class="n">sublist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">current_cumulative_weight</span> <span class="o">&lt;=</span> <span class="n">_math</span><span class="o">.</span><span class="n">weight</span><span class="p">(</span><span class="n">flatten</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">depth</span><span class="o">=-</span><span class="mi">1</span><span class="p">)):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">current_cumulative_weight</span> <span class="o">=</span> <span class="n">cumulative_weights</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">sublist</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sublist</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">break</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="n">sequence</span><span class="p">)(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">items</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">result</span></div>



<div class="viewcode-block" id="partition_by_weights">
<a class="viewcode-back" href="../../api/abjad/sequence.html#abjad.sequence.partition_by_weights">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">partition_by_weights</span><span class="p">(</span>
    <span class="n">sequence</span><span class="p">,</span>
    <span class="n">weights</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span> <span class="o">|</span> <span class="n">fractions</span><span class="o">.</span><span class="n">Fraction</span><span class="p">],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">cyclic</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">overhang</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">allow_part_weights</span><span class="p">:</span> <span class="n">_enums</span><span class="o">.</span><span class="n">Comparison</span> <span class="o">=</span> <span class="n">_enums</span><span class="o">.</span><span class="n">EXACT</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Partitions ``sequence`` by ``weights`` exactly.</span>

<span class="sd">    &gt;&gt;&gt; sequence = [3, 3, 3, 3, 4, 4, 4, 4, 5]</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Partitions sequence once by weights with overhang:</span>

<span class="sd">        &gt;&gt;&gt; for item in abjad.sequence.partition_by_weights(</span>
<span class="sd">        ...     sequence,</span>
<span class="sd">        ...     [3, 9],</span>
<span class="sd">        ...     cyclic=False,</span>
<span class="sd">        ...     overhang=False,</span>
<span class="sd">        ... ):</span>
<span class="sd">        ...     item</span>
<span class="sd">        ...</span>
<span class="sd">        [3]</span>
<span class="sd">        [3, 3, 3]</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Partitions sequence once by weights. Allows overhang:</span>

<span class="sd">        &gt;&gt;&gt; for item in abjad.sequence.partition_by_weights(</span>
<span class="sd">        ...     sequence,</span>
<span class="sd">        ...     [3, 9],</span>
<span class="sd">        ...     cyclic=False,</span>
<span class="sd">        ...     overhang=True,</span>
<span class="sd">        ... ):</span>
<span class="sd">        ...     item</span>
<span class="sd">        ...</span>
<span class="sd">        [3]</span>
<span class="sd">        [3, 3, 3]</span>
<span class="sd">        [4, 4, 4, 4, 5]</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Partitions sequence cyclically by weights:</span>

<span class="sd">        &gt;&gt;&gt; for item in abjad.sequence.partition_by_weights(</span>
<span class="sd">        ...     sequence,</span>
<span class="sd">        ...     [12],</span>
<span class="sd">        ...     cyclic=True,</span>
<span class="sd">        ...     overhang=False,</span>
<span class="sd">        ... ):</span>
<span class="sd">        ...     item</span>
<span class="sd">        ...</span>
<span class="sd">        [3, 3, 3, 3]</span>
<span class="sd">        [4, 4, 4]</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Partitions sequence cyclically by weights. Allows overhang:</span>

<span class="sd">        &gt;&gt;&gt; for item in abjad.sequence.partition_by_weights(</span>
<span class="sd">        ...     sequence,</span>
<span class="sd">        ...     [12],</span>
<span class="sd">        ...     cyclic=True,</span>
<span class="sd">        ...     overhang=True,</span>
<span class="sd">        ... ):</span>
<span class="sd">        ...     item</span>
<span class="sd">        ...</span>
<span class="sd">        [3, 3, 3, 3]</span>
<span class="sd">        [4, 4, 4]</span>
<span class="sd">        [4, 5]</span>

<span class="sd">    &gt;&gt;&gt; sequence = list([3, 3, 3, 3, 4, 4, 4, 4, 5, 5])</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Partitions sequence once by weights. Allows part weights to be just less than</span>
<span class="sd">        specified:</span>

<span class="sd">        &gt;&gt;&gt; for item in abjad.sequence.partition_by_weights(</span>
<span class="sd">        ...     sequence,</span>
<span class="sd">        ...     [10, 4],</span>
<span class="sd">        ...     cyclic=False,</span>
<span class="sd">        ...     overhang=False,</span>
<span class="sd">        ...     allow_part_weights=abjad.LESS,</span>
<span class="sd">        ... ):</span>
<span class="sd">        ...     item</span>
<span class="sd">        ...</span>
<span class="sd">        [3, 3, 3]</span>
<span class="sd">        [3]</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Partitions sequence once by weights. Allows part weights to be just less than</span>
<span class="sd">        specified. Allows overhang:</span>

<span class="sd">        &gt;&gt;&gt; for item in abjad.sequence.partition_by_weights(</span>
<span class="sd">        ...     sequence,</span>
<span class="sd">        ...     [10, 4],</span>
<span class="sd">        ...     cyclic=False,</span>
<span class="sd">        ...     overhang=True,</span>
<span class="sd">        ...     allow_part_weights=abjad.LESS,</span>
<span class="sd">        ... ):</span>
<span class="sd">        ...     item</span>
<span class="sd">        ...</span>
<span class="sd">        [3, 3, 3]</span>
<span class="sd">        [3]</span>
<span class="sd">        [4, 4, 4, 4, 5, 5]</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Partitions sequence cyclically by weights. Allows part weights to be just</span>
<span class="sd">        less than specified:</span>

<span class="sd">        &gt;&gt;&gt; for item in abjad.sequence.partition_by_weights(</span>
<span class="sd">        ...     sequence,</span>
<span class="sd">        ...     [10, 5],</span>
<span class="sd">        ...     cyclic=True,</span>
<span class="sd">        ...     overhang=False,</span>
<span class="sd">        ...     allow_part_weights=abjad.LESS,</span>
<span class="sd">        ... ):</span>
<span class="sd">        ...     item</span>
<span class="sd">        ...</span>
<span class="sd">        [3, 3, 3]</span>
<span class="sd">        [3]</span>
<span class="sd">        [4, 4]</span>
<span class="sd">        [4]</span>
<span class="sd">        [4, 5]</span>
<span class="sd">        [5]</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Partitions sequence cyclically by weights. Allows part weights to be just</span>
<span class="sd">        less than specified. Allows overhang:</span>

<span class="sd">        &gt;&gt;&gt; for item in abjad.sequence.partition_by_weights(</span>
<span class="sd">        ...     sequence,</span>
<span class="sd">        ...     [10, 5],</span>
<span class="sd">        ...     cyclic=True,</span>
<span class="sd">        ...     overhang=True,</span>
<span class="sd">        ...     allow_part_weights=abjad.LESS,</span>
<span class="sd">        ... ):</span>
<span class="sd">        ...     item</span>
<span class="sd">        ...</span>
<span class="sd">        [3, 3, 3]</span>
<span class="sd">        [3]</span>
<span class="sd">        [4, 4]</span>
<span class="sd">        [4]</span>
<span class="sd">        [4, 5]</span>
<span class="sd">        [5]</span>

<span class="sd">    &gt;&gt;&gt; sequence = list([3, 3, 3, 3, 4, 4, 4, 4, 5, 5])</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Partitions sequence once by weights. Allow part weights to be just more than</span>
<span class="sd">        specified:</span>

<span class="sd">        &gt;&gt;&gt; for item in abjad.sequence.partition_by_weights(</span>
<span class="sd">        ...     sequence,</span>
<span class="sd">        ...     [10, 4],</span>
<span class="sd">        ...     cyclic=False,</span>
<span class="sd">        ...     overhang=False,</span>
<span class="sd">        ...     allow_part_weights=abjad.MORE,</span>
<span class="sd">        ... ):</span>
<span class="sd">        ...     item</span>
<span class="sd">        ...</span>
<span class="sd">        [3, 3, 3, 3]</span>
<span class="sd">        [4]</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Partitions sequence once by weights. Allows part weights to be just more than</span>
<span class="sd">        specified. Allows overhang:</span>

<span class="sd">        &gt;&gt;&gt; for item in abjad.sequence.partition_by_weights(</span>
<span class="sd">        ...     sequence,</span>
<span class="sd">        ...     [10, 4],</span>
<span class="sd">        ...     cyclic=False,</span>
<span class="sd">        ...     overhang=True,</span>
<span class="sd">        ...     allow_part_weights=abjad.MORE,</span>
<span class="sd">        ... ):</span>
<span class="sd">        ...     item</span>
<span class="sd">        ...</span>
<span class="sd">        [3, 3, 3, 3]</span>
<span class="sd">        [4]</span>
<span class="sd">        [4, 4, 4, 5, 5]</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Partitions sequence cyclically by weights. Allows part weights to be just</span>
<span class="sd">        more than specified:</span>

<span class="sd">        &gt;&gt;&gt; for item in abjad.sequence.partition_by_weights(</span>
<span class="sd">        ...     sequence,</span>
<span class="sd">        ...     [10, 4],</span>
<span class="sd">        ...     cyclic=True,</span>
<span class="sd">        ...     overhang=False,</span>
<span class="sd">        ...     allow_part_weights=abjad.MORE,</span>
<span class="sd">        ... ):</span>
<span class="sd">        ...     item</span>
<span class="sd">        ...</span>
<span class="sd">        [3, 3, 3, 3]</span>
<span class="sd">        [4]</span>
<span class="sd">        [4, 4, 4]</span>
<span class="sd">        [5]</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Partitions sequence cyclically by weights. Allows part weights to be just</span>
<span class="sd">        more than specified. Allows overhang:</span>

<span class="sd">        &gt;&gt;&gt; for item in abjad.sequence.partition_by_weights(</span>
<span class="sd">        ...     sequence,</span>
<span class="sd">        ...     [10, 4],</span>
<span class="sd">        ...     cyclic=True,</span>
<span class="sd">        ...     overhang=True,</span>
<span class="sd">        ...     allow_part_weights=abjad.MORE,</span>
<span class="sd">        ... ):</span>
<span class="sd">        ...     item</span>
<span class="sd">        ...</span>
<span class="sd">        [3, 3, 3, 3]</span>
<span class="sd">        [4]</span>
<span class="sd">        [4, 4, 4]</span>
<span class="sd">        [5]</span>
<span class="sd">        [5]</span>

<span class="sd">    Returns list of ``sequence`` types.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">allow_part_weights</span> <span class="ow">is</span> <span class="n">_enums</span><span class="o">.</span><span class="n">EXACT</span><span class="p">:</span>
        <span class="n">candidate</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">sequence</span><span class="p">)(</span><span class="n">sequence</span><span class="p">)</span>
        <span class="n">candidate</span> <span class="o">=</span> <span class="n">split</span><span class="p">(</span><span class="n">candidate</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">cyclic</span><span class="o">=</span><span class="n">cyclic</span><span class="p">,</span> <span class="n">overhang</span><span class="o">=</span><span class="n">overhang</span><span class="p">)</span>
        <span class="n">flattened_candidate</span> <span class="o">=</span> <span class="n">flatten</span><span class="p">(</span><span class="n">candidate</span><span class="p">,</span> <span class="n">depth</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">flattened_candidate</span> <span class="o">==</span> <span class="n">sequence</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">flattened_candidate</span><span class="p">)]:</span>
            <span class="k">return</span> <span class="n">candidate</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;can not partition exactly.&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">allow_part_weights</span> <span class="ow">is</span> <span class="n">_enums</span><span class="o">.</span><span class="n">MORE</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cyclic</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">_partition_sequence_once_by_weights_at_least</span><span class="p">(</span>
                <span class="n">sequence</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">overhang</span><span class="o">=</span><span class="n">overhang</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">_partition_sequence_cyclically_by_weights_at_least</span><span class="p">(</span>
                <span class="n">sequence</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">overhang</span><span class="o">=</span><span class="n">overhang</span>
            <span class="p">)</span>
    <span class="k">elif</span> <span class="n">allow_part_weights</span> <span class="ow">is</span> <span class="n">_enums</span><span class="o">.</span><span class="n">LESS</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cyclic</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">_partition_sequence_once_by_weights_at_most</span><span class="p">(</span>
                <span class="n">sequence</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">overhang</span><span class="o">=</span><span class="n">overhang</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">_partition_sequence_cyclically_by_weights_at_most</span><span class="p">(</span>
                <span class="n">sequence</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">overhang</span><span class="o">=</span><span class="n">overhang</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;allow_part_weights must be ordinal constant: </span><span class="si">{!r}</span><span class="s2">.&quot;</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">allow_part_weights</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span></div>



<div class="viewcode-block" id="split">
<a class="viewcode-back" href="../../api/abjad/sequence.html#abjad.sequence.split">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">split</span><span class="p">(</span>
    <span class="n">sequence</span><span class="p">,</span>
    <span class="n">weights</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span> <span class="o">|</span> <span class="n">fractions</span><span class="o">.</span><span class="n">Fraction</span><span class="p">],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">cyclic</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">overhang</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Splits ``sequence`` by ``weights``.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Splits sequence cyclically by weights with overhang:</span>

<span class="sd">        &gt;&gt;&gt; sequence = list([10, -10, 10, -10])</span>

<span class="sd">        &gt;&gt;&gt; for part in abjad.sequence.split(</span>
<span class="sd">        ...     sequence,</span>
<span class="sd">        ...     (3, 15, 3),</span>
<span class="sd">        ...     cyclic=True,</span>
<span class="sd">        ...     overhang=True,</span>
<span class="sd">        ... ):</span>
<span class="sd">        ...     part</span>
<span class="sd">        ...</span>
<span class="sd">        [3]</span>
<span class="sd">        [7, -8]</span>
<span class="sd">        [-2, 1]</span>
<span class="sd">        [3]</span>
<span class="sd">        [6, -9]</span>
<span class="sd">        [-1]</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Splits sequence once by weights with overhang:</span>

<span class="sd">        &gt;&gt;&gt; for part in abjad.sequence.split(</span>
<span class="sd">        ...     sequence,</span>
<span class="sd">        ...     (3, 15, 3),</span>
<span class="sd">        ...     cyclic=False,</span>
<span class="sd">        ...     overhang=True,</span>
<span class="sd">        ... ):</span>
<span class="sd">        ...     part</span>
<span class="sd">        ...</span>
<span class="sd">        [3]</span>
<span class="sd">        [7, -8]</span>
<span class="sd">        [-2, 1]</span>
<span class="sd">        [9, -10]</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Splits sequence once by weights without overhang:</span>

<span class="sd">        &gt;&gt;&gt; for part in abjad.sequence.split(</span>
<span class="sd">        ...     sequence,</span>
<span class="sd">        ...     (3, 15, 3),</span>
<span class="sd">        ...     cyclic=False,</span>
<span class="sd">        ...     overhang=False,</span>
<span class="sd">        ... ):</span>
<span class="sd">        ...     part</span>
<span class="sd">        ...</span>
<span class="sd">        [3]</span>
<span class="sd">        [7, -8]</span>
<span class="sd">        [-2, 1]</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        REGRESSION. Splits sequence of durations cyclically by weights</span>
<span class="sd">        with overhang; then expresses durations as pairs with denominator:</span>

<span class="sd">        &gt;&gt;&gt; sequence = list([</span>
<span class="sd">        ...     abjad.Duration(20, 2),</span>
<span class="sd">        ...     abjad.Duration(-20, 2),</span>
<span class="sd">        ...     abjad.Duration(20, 2),</span>
<span class="sd">        ...     abjad.Duration(-20, 2),</span>
<span class="sd">        ... ])</span>

<span class="sd">        &gt;&gt;&gt; for part in abjad.sequence.split(</span>
<span class="sd">        ...     sequence,</span>
<span class="sd">        ...     (3, 15, 3),</span>
<span class="sd">        ...     cyclic=True,</span>
<span class="sd">        ...     overhang=True,</span>
<span class="sd">        ... ):</span>
<span class="sd">        ...     [abjad.duration.with_denominator(_, 2) for _ in part]</span>
<span class="sd">        ...</span>
<span class="sd">        [(6, 2)]</span>
<span class="sd">        [(14, 2), (-16, 2)]</span>
<span class="sd">        [(-4, 2), (2, 2)]</span>
<span class="sd">        [(6, 2)]</span>
<span class="sd">        [(12, 2), (-18, 2)]</span>
<span class="sd">        [(-2, 2)]</span>

<span class="sd">    Returns list of ``sequence`` types.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">current_index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">current_piece</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">cyclic</span><span class="p">:</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="n">repeat_to_weight</span><span class="p">(</span>
            <span class="n">weights</span><span class="p">,</span> <span class="n">_math</span><span class="o">.</span><span class="n">weight</span><span class="p">(</span><span class="n">sequence</span><span class="p">),</span> <span class="n">allow_total</span><span class="o">=</span><span class="n">_enums</span><span class="o">.</span><span class="n">LESS</span>
        <span class="p">)</span>
    <span class="k">for</span> <span class="n">weight</span> <span class="ow">in</span> <span class="n">weights</span><span class="p">:</span>
        <span class="n">current_piece_weight</span> <span class="o">=</span> <span class="n">_math</span><span class="o">.</span><span class="n">weight</span><span class="p">(</span><span class="n">current_piece</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">current_piece_weight</span> <span class="o">&lt;</span> <span class="n">weight</span><span class="p">:</span>
            <span class="n">current_piece</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sequence</span><span class="p">[</span><span class="n">current_index</span><span class="p">])</span>
            <span class="n">current_index</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">current_piece_weight</span> <span class="o">=</span> <span class="n">_math</span><span class="o">.</span><span class="n">weight</span><span class="p">(</span><span class="n">current_piece</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">current_piece_weight</span> <span class="o">==</span> <span class="n">weight</span><span class="p">:</span>
            <span class="n">current_piece_</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">sequence</span><span class="p">)(</span><span class="n">current_piece</span><span class="p">)</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_piece_</span><span class="p">)</span>
            <span class="n">current_piece</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">elif</span> <span class="n">weight</span> <span class="o">&lt;</span> <span class="n">current_piece_weight</span><span class="p">:</span>
            <span class="n">overage</span> <span class="o">=</span> <span class="n">current_piece_weight</span> <span class="o">-</span> <span class="n">weight</span>
            <span class="n">current_last_element</span> <span class="o">=</span> <span class="n">current_piece</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">needed</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">current_last_element</span><span class="p">)</span> <span class="o">-</span> <span class="n">overage</span>
            <span class="n">needed</span> <span class="o">*=</span> <span class="n">_math</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">current_last_element</span><span class="p">)</span>
            <span class="n">current_piece</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">needed</span><span class="p">)</span>
            <span class="n">current_piece_</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">sequence</span><span class="p">)(</span><span class="n">current_piece</span><span class="p">)</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_piece_</span><span class="p">)</span>
            <span class="n">overage</span> <span class="o">*=</span> <span class="n">_math</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">current_last_element</span><span class="p">)</span>
            <span class="n">current_piece</span> <span class="o">=</span> <span class="p">[</span><span class="n">overage</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">overhang</span><span class="p">:</span>
        <span class="n">last_piece</span> <span class="o">=</span> <span class="n">current_piece</span>
        <span class="n">last_piece</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">sequence</span><span class="p">[</span><span class="n">current_index</span><span class="p">:])</span>
        <span class="k">if</span> <span class="n">last_piece</span><span class="p">:</span>
            <span class="n">last_piece_</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">sequence</span><span class="p">)(</span><span class="n">last_piece</span><span class="p">)</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">last_piece_</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span></div>



<div class="viewcode-block" id="filter">
<a class="viewcode-back" href="../../api/abjad/sequence.html#abjad.sequence.filter">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="n">predicate</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Callable</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Filters ``sequence`` by callable ``predicate``.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        By length:</span>

<span class="sd">        &gt;&gt;&gt; sequence = [[1], [2, 3, [4]], [5], [6, 7, [8]]]</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.filter(sequence, lambda _: len(_) == 1)</span>
<span class="sd">        [[1], [5]]</span>

<span class="sd">        By duration:</span>

<span class="sd">        &gt;&gt;&gt; staff = abjad.Staff(&quot;c&#39;4. d&#39;8 e&#39;4. f&#39;8 g&#39;2&quot;)</span>
<span class="sd">        &gt;&gt;&gt; sequence = list(staff)</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.filter(</span>
<span class="sd">        ...     sequence, lambda _: _.written_duration == abjad.Duration(1, 8)</span>
<span class="sd">        ... )</span>
<span class="sd">        [Note(&quot;d&#39;8&quot;), Note(&quot;f&#39;8&quot;)]</span>

<span class="sd">    Returns ``sequence`` type.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">predicate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">sequence</span><span class="p">[:]</span>
    <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">predicate</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
            <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">sequence</span><span class="p">)(</span><span class="n">items</span><span class="p">)</span></div>



<span class="c1"># creates an iterator that can generate a flattened list,</span>
<span class="c1"># descending down into child elements to a depth given in the arguments.</span>
<span class="c1"># note that depth &lt; 0 is effectively equivalent to infinity.</span>
<span class="k">def</span><span class="w"> </span><span class="nf">_flatten_helper</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="n">classes</span><span class="p">,</span> <span class="n">depth</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="n">classes</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">sequence</span>
    <span class="k">elif</span> <span class="n">depth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">item</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">:</span>
            <span class="c1"># flatten an iterable by one level</span>
            <span class="n">depth_</span> <span class="o">=</span> <span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">item_</span> <span class="ow">in</span> <span class="n">_flatten_helper</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">classes</span><span class="p">,</span> <span class="n">depth_</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">item_</span>


<div class="viewcode-block" id="flatten">
<a class="viewcode-back" href="../../api/abjad/sequence.html#abjad.sequence.flatten">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">flatten</span><span class="p">(</span>
    <span class="n">sequence</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">classes</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Type</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
<span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Flattens ``sequence``.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Flattens sequence:</span>

<span class="sd">        &gt;&gt;&gt; sequence = [1, [2, 3, [4]], 5, [6, 7, [8]]]</span>
<span class="sd">        &gt;&gt;&gt; abjad.sequence.flatten(sequence)</span>
<span class="sd">        [1, 2, 3, [4], 5, 6, 7, [8]]</span>

<span class="sd">        Flattens sequence to depth 2:</span>

<span class="sd">        &gt;&gt;&gt; sequence = [1, [2, 3, [4]], 5, [6, 7, [8]]]</span>
<span class="sd">        &gt;&gt;&gt; abjad.sequence.flatten(sequence, depth=2)</span>
<span class="sd">        [1, 2, 3, 4, 5, 6, 7, 8]</span>

<span class="sd">        Flattens sequence to depth -1:</span>

<span class="sd">        &gt;&gt;&gt; sequence = [1, [2, 3, [4]], 5, [6, 7, [8]]]</span>
<span class="sd">        &gt;&gt;&gt; abjad.sequence.flatten(sequence, depth=-1)</span>
<span class="sd">        [1, 2, 3, 4, 5, 6, 7, 8]</span>

<span class="sd">        Flattens tuples in sequence only:</span>

<span class="sd">        &gt;&gt;&gt; sequence = [&quot;ab&quot;, &quot;cd&quot;, (&quot;ef&quot;, &quot;gh&quot;), (&quot;ij&quot;, &quot;kl&quot;)]</span>
<span class="sd">        &gt;&gt;&gt; abjad.sequence.flatten(sequence, classes=(tuple, list))</span>
<span class="sd">        [&#39;ab&#39;, &#39;cd&#39;, &#39;ef&#39;, &#39;gh&#39;, &#39;ij&#39;, &#39;kl&#39;]</span>

<span class="sd">    Returns ``sequence`` type.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">classes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">classes</span> <span class="o">=</span> <span class="p">(</span><span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">,)</span>
    <span class="n">items</span> <span class="o">=</span> <span class="n">_flatten_helper</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="n">classes</span><span class="p">,</span> <span class="n">depth</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">sequence</span><span class="p">)(</span><span class="n">items</span><span class="p">)</span></div>



<div class="viewcode-block" id="group_by">
<a class="viewcode-back" href="../../api/abjad/sequence.html#abjad.sequence.group_by">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">group_by</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="n">predicate</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Callable</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Groups ``sequence`` items by value of items.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; items = [0, 0, -1, -1, 2, 3, -5, 1, 1, 5, -5]</span>
<span class="sd">        &gt;&gt;&gt; sequence = list(items)</span>
<span class="sd">        &gt;&gt;&gt; for item in abjad.sequence.group_by(sequence):</span>
<span class="sd">        ...     item</span>
<span class="sd">        ...</span>
<span class="sd">        [0, 0]</span>
<span class="sd">        [-1, -1]</span>
<span class="sd">        [2]</span>
<span class="sd">        [3]</span>
<span class="sd">        [-5]</span>
<span class="sd">        [1, 1]</span>
<span class="sd">        [5]</span>
<span class="sd">        [-5]</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; staff = abjad.Staff(&quot;c&#39;8 d&#39; d&#39; e&#39; e&#39; e&#39;&quot;)</span>
<span class="sd">        &gt;&gt;&gt; predicate = lambda _: abjad.PitchSet([_])</span>
<span class="sd">        &gt;&gt;&gt; sequence = list(staff)</span>
<span class="sd">        &gt;&gt;&gt; for item in abjad.sequence.group_by(sequence, predicate):</span>
<span class="sd">        ...     item</span>
<span class="sd">        ...</span>
<span class="sd">        [Note(&quot;c&#39;8&quot;)]</span>
<span class="sd">        [Note(&quot;d&#39;8&quot;), Note(&quot;d&#39;8&quot;)]</span>
<span class="sd">        [Note(&quot;e&#39;8&quot;), Note(&quot;e&#39;8&quot;), Note(&quot;e&#39;8&quot;)]</span>

<span class="sd">    Returns list of ``sequence`` types.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">predicate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">pairs</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="n">_</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">:</span>
            <span class="n">item</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">sequence</span><span class="p">)(</span><span class="n">group</span><span class="p">)</span>
            <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pairs</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="n">predicate</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">:</span>
            <span class="n">item</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">sequence</span><span class="p">)(</span><span class="n">group</span><span class="p">)</span>
            <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">items</span></div>



<div class="viewcode-block" id="has_duplicates">
<a class="viewcode-back" href="../../api/abjad/sequence.html#abjad.sequence.has_duplicates">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">has_duplicates</span><span class="p">(</span><span class="n">sequence</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Is true when ``sequence`` has duplicates.</span>

<span class="sd">    ..  container::</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.has_duplicates([0, 1, 2, 3, 4])</span>
<span class="sd">        False</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.has_duplicates([0, 1, 2, 3, 3])</span>
<span class="sd">        True</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.has_duplicates([0, 1, 0, 1, 0])</span>
<span class="sd">        True</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">sequence</span><span class="p">))</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span></div>



<div class="viewcode-block" id="is_decreasing">
<a class="viewcode-back" href="../../api/abjad/sequence.html#abjad.sequence.is_decreasing">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">is_decreasing</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">strict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Is true when ``sequence`` is decreasing.</span>

<span class="sd">    Is true when sequence is strictly decreasing:</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.is_decreasing([5, 4, 3, 2, 1, 0], strict=True)</span>
<span class="sd">        True</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.is_decreasing([3, 3, 3, 2, 1, 0], strict=True)</span>
<span class="sd">        False</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.is_decreasing([3, 3, 3, 3, 3, 3], strict=True)</span>
<span class="sd">        False</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.is_decreasing([], strict=True)</span>
<span class="sd">        True</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Is true when sequence decreases monotonically:</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.is_decreasing([5, 4, 3, 2, 1, 0], strict=False)</span>
<span class="sd">        True</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.is_decreasing([3, 3, 3, 2, 1, 0], strict=False)</span>
<span class="sd">        True</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.is_decreasing([3, 3, 3, 3, 3, 3], strict=False)</span>
<span class="sd">        True</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.is_decreasing([], strict=False)</span>
<span class="sd">        True</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">strict</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">previous</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">current</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">previous</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">current</span> <span class="o">&lt;</span> <span class="n">previous</span><span class="p">:</span>
                        <span class="k">return</span> <span class="kc">False</span>
                <span class="n">previous</span> <span class="o">=</span> <span class="n">current</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">previous</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">current</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">previous</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">current</span> <span class="o">&lt;=</span> <span class="n">previous</span><span class="p">:</span>
                        <span class="k">return</span> <span class="kc">False</span>
                <span class="n">previous</span> <span class="o">=</span> <span class="n">current</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>



<div class="viewcode-block" id="is_increasing">
<a class="viewcode-back" href="../../api/abjad/sequence.html#abjad.sequence.is_increasing">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">is_increasing</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">strict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Is true when ``sequence`` is increasing.</span>

<span class="sd">    Is true when sequence is strictly increasing:</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.is_increasing([0, 1, 2, 3, 4, 5], strict=True)</span>
<span class="sd">        True</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.is_increasing([0, 1, 2, 3, 3, 3], strict=True)</span>
<span class="sd">        False</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.is_increasing([3, 3, 3, 3, 3, 3], strict=True)</span>
<span class="sd">        False</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.is_increasing([], strict=True)</span>
<span class="sd">        True</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Is true when sequence increases monotonically:</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.is_increasing([0, 1, 2, 3, 4, 5], strict=False)</span>
<span class="sd">        True</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.is_increasing([0, 1, 2, 3, 3, 3], strict=False)</span>
<span class="sd">        True</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.is_increasing([3, 3, 3, 3, 3, 3], strict=False)</span>
<span class="sd">        True</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.is_increasing([], strict=False)</span>
<span class="sd">        True</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">strict</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">previous</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">current</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">previous</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">previous</span> <span class="o">&lt;</span> <span class="n">current</span><span class="p">:</span>
                        <span class="k">return</span> <span class="kc">False</span>
                <span class="n">previous</span> <span class="o">=</span> <span class="n">current</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">previous</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">current</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">previous</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">previous</span> <span class="o">&lt;=</span> <span class="n">current</span><span class="p">:</span>
                        <span class="k">return</span> <span class="kc">False</span>
                <span class="n">previous</span> <span class="o">=</span> <span class="n">current</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>



<div class="viewcode-block" id="is_permutation">
<a class="viewcode-back" href="../../api/abjad/sequence.html#abjad.sequence.is_permutation">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">is_permutation</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Is true when ``sequence`` is a permutation.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.is_permutation([4, 5, 0, 3, 2, 1])</span>
<span class="sd">        True</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.is_permutation([1, 1, 5, 3, 2, 1])</span>
<span class="sd">        False</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">sequence</span><span class="p">))</span> <span class="o">==</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sequence</span><span class="p">)))</span></div>



<div class="viewcode-block" id="is_repetition_free">
<a class="viewcode-back" href="../../api/abjad/sequence.html#abjad.sequence.is_repetition_free">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">is_repetition_free</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Is true when ``sequence`` is repetition-free.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.is_repetition_free([0, 1, 2, 6, 7, 8])</span>
<span class="sd">        True</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.is_repetition_free([])</span>
<span class="sd">        True</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.is_repetition_free([0, 1, 2, 2, 7, 8])</span>
<span class="sd">        False</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="ow">in</span> <span class="n">nwise</span><span class="p">(</span><span class="n">sequence</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">left</span> <span class="o">==</span> <span class="n">right</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span></div>



<div class="viewcode-block" id="join">
<a class="viewcode-back" href="../../api/abjad/sequence.html#abjad.sequence.join">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">join</span><span class="p">(</span><span class="n">sequence</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Join subsequences in ``sequence``.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; items = [(1, 2, 3), (), (4, 5), (), (6,)]</span>
<span class="sd">        &gt;&gt;&gt; sequence = list(items)</span>
<span class="sd">        &gt;&gt;&gt; sequence</span>
<span class="sd">        [(1, 2, 3), (), (4, 5), (), (6,)]</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.join(sequence)</span>
<span class="sd">        [(1, 2, 3, 4, 5, 6)]</span>

<span class="sd">    Returns ``sequence`` type.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">sequence</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">sequence</span><span class="p">)()</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">sequence</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">item_</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">item</span> <span class="o">+=</span> <span class="n">item_</span>
    <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">sequence</span><span class="p">)([</span><span class="n">item</span><span class="p">])</span></div>



<div class="viewcode-block" id="nwise">
<a class="viewcode-back" href="../../api/abjad/sequence.html#abjad.sequence.nwise">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">nwise</span><span class="p">(</span>
    <span class="n">sequence</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">cyclic</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">wrapped</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Iterator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Iterates ``sequence`` ``n`` items at a time.</span>

<span class="sd">    Iterates items 2 at a time:</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; sequence = list(range(10))</span>
<span class="sd">        &gt;&gt;&gt; for item in abjad.sequence.nwise(sequence):</span>
<span class="sd">        ...     item</span>
<span class="sd">        ...</span>
<span class="sd">        [0, 1]</span>
<span class="sd">        [1, 2]</span>
<span class="sd">        [2, 3]</span>
<span class="sd">        [3, 4]</span>
<span class="sd">        [4, 5]</span>
<span class="sd">        [5, 6]</span>
<span class="sd">        [6, 7]</span>
<span class="sd">        [7, 8]</span>
<span class="sd">        [8, 9]</span>

<span class="sd">        Iterates items 3 at a time:</span>

<span class="sd">        &gt;&gt;&gt; sequence = list(range(10))</span>
<span class="sd">        &gt;&gt;&gt; for item in abjad.sequence.nwise(sequence, n=3):</span>
<span class="sd">        ...     item</span>
<span class="sd">        ...</span>
<span class="sd">        [0, 1, 2]</span>
<span class="sd">        [1, 2, 3]</span>
<span class="sd">        [2, 3, 4]</span>
<span class="sd">        [3, 4, 5]</span>
<span class="sd">        [4, 5, 6]</span>
<span class="sd">        [5, 6, 7]</span>
<span class="sd">        [6, 7, 8]</span>
<span class="sd">        [7, 8, 9]</span>

<span class="sd">        Iterates items 2 at a time. Wraps around at end:</span>

<span class="sd">        &gt;&gt;&gt; sequence = list(range(10))</span>
<span class="sd">        &gt;&gt;&gt; for item in abjad.sequence.nwise(sequence, n=2, wrapped=True):</span>
<span class="sd">        ...     item</span>
<span class="sd">        ...</span>
<span class="sd">        [0, 1]</span>
<span class="sd">        [1, 2]</span>
<span class="sd">        [2, 3]</span>
<span class="sd">        [3, 4]</span>
<span class="sd">        [4, 5]</span>
<span class="sd">        [5, 6]</span>
<span class="sd">        [6, 7]</span>
<span class="sd">        [7, 8]</span>
<span class="sd">        [8, 9]</span>
<span class="sd">        [9, 0]</span>

<span class="sd">        Iterates items 3 at a time. Wraps around at end:</span>

<span class="sd">        &gt;&gt;&gt; sequence = list(range(10))</span>
<span class="sd">        &gt;&gt;&gt; for item in abjad.sequence.nwise(sequence, n=3, wrapped=True):</span>
<span class="sd">        ...     item</span>
<span class="sd">        ...</span>
<span class="sd">        [0, 1, 2]</span>
<span class="sd">        [1, 2, 3]</span>
<span class="sd">        [2, 3, 4]</span>
<span class="sd">        [3, 4, 5]</span>
<span class="sd">        [4, 5, 6]</span>
<span class="sd">        [5, 6, 7]</span>
<span class="sd">        [6, 7, 8]</span>
<span class="sd">        [7, 8, 9]</span>
<span class="sd">        [8, 9, 0]</span>
<span class="sd">        [9, 0, 1]</span>

<span class="sd">        Iterates items 2 at a time. Cycles indefinitely:</span>

<span class="sd">        &gt;&gt;&gt; sequence = list(range(10))</span>
<span class="sd">        &gt;&gt;&gt; pairs = abjad.sequence.nwise(sequence, n=2, cyclic=True)</span>
<span class="sd">        &gt;&gt;&gt; for _ in range(15):</span>
<span class="sd">        ...     next(pairs)</span>
<span class="sd">        ...</span>
<span class="sd">        [0, 1]</span>
<span class="sd">        [1, 2]</span>
<span class="sd">        [2, 3]</span>
<span class="sd">        [3, 4]</span>
<span class="sd">        [4, 5]</span>
<span class="sd">        [5, 6]</span>
<span class="sd">        [6, 7]</span>
<span class="sd">        [7, 8]</span>
<span class="sd">        [8, 9]</span>
<span class="sd">        [9, 0]</span>
<span class="sd">        [0, 1]</span>
<span class="sd">        [1, 2]</span>
<span class="sd">        [2, 3]</span>
<span class="sd">        [3, 4]</span>
<span class="sd">        [4, 5]</span>

<span class="sd">        Returns infinite generator.</span>

<span class="sd">        Iterates items 3 at a time. Cycles indefinitely:</span>

<span class="sd">        &gt;&gt;&gt; sequence = list(range(10))</span>
<span class="sd">        &gt;&gt;&gt; triples = abjad.sequence.nwise(sequence, n=3, cyclic=True)</span>
<span class="sd">        &gt;&gt;&gt; for _ in range(15):</span>
<span class="sd">        ...     next(triples)</span>
<span class="sd">        ...</span>
<span class="sd">        [0, 1, 2]</span>
<span class="sd">        [1, 2, 3]</span>
<span class="sd">        [2, 3, 4]</span>
<span class="sd">        [3, 4, 5]</span>
<span class="sd">        [4, 5, 6]</span>
<span class="sd">        [5, 6, 7]</span>
<span class="sd">        [6, 7, 8]</span>
<span class="sd">        [7, 8, 9]</span>
<span class="sd">        [8, 9, 0]</span>
<span class="sd">        [9, 0, 1]</span>
<span class="sd">        [0, 1, 2]</span>
<span class="sd">        [1, 2, 3]</span>
<span class="sd">        [2, 3, 4]</span>
<span class="sd">        [3, 4, 5]</span>
<span class="sd">        [4, 5, 6]</span>

<span class="sd">        Returns infinite generator.</span>

<span class="sd">        Iterates items 1 at a time:</span>

<span class="sd">        &gt;&gt;&gt; sequence = list(range(10))</span>
<span class="sd">        &gt;&gt;&gt; for item in abjad.sequence.nwise(sequence, n=1):</span>
<span class="sd">        ...     item</span>
<span class="sd">        ...</span>
<span class="sd">        [0]</span>
<span class="sd">        [1]</span>
<span class="sd">        [2]</span>
<span class="sd">        [3]</span>
<span class="sd">        [4]</span>
<span class="sd">        [5]</span>
<span class="sd">        [6]</span>
<span class="sd">        [7]</span>
<span class="sd">        [8]</span>
<span class="sd">        [9]</span>

<span class="sd">    Ignores ``wrapped`` when ``cyclic=True``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">cyclic</span><span class="p">:</span>
        <span class="n">item_buffer</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">long_enough</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">:</span>
            <span class="n">item_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">long_enough</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">item_buffer</span><span class="p">):</span>
                    <span class="n">long_enough</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">long_enough</span><span class="p">:</span>
                <span class="k">yield</span> <span class="nb">type</span><span class="p">(</span><span class="n">sequence</span><span class="p">)(</span><span class="n">item_buffer</span><span class="p">[</span><span class="o">-</span><span class="n">n</span><span class="p">:])</span>
        <span class="n">len_sequence</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">item_buffer</span><span class="p">)</span>
        <span class="n">current</span> <span class="o">=</span> <span class="n">len_sequence</span> <span class="o">-</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">local_offset</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                <span class="n">index</span> <span class="o">=</span> <span class="p">(</span><span class="n">current</span> <span class="o">+</span> <span class="n">local_offset</span><span class="p">)</span> <span class="o">%</span> <span class="n">len_sequence</span>
                <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item_buffer</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
            <span class="k">yield</span> <span class="nb">type</span><span class="p">(</span><span class="n">sequence</span><span class="p">)(</span><span class="n">output</span><span class="p">)</span>
            <span class="n">current</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">current</span> <span class="o">%=</span> <span class="n">len_sequence</span>
    <span class="k">elif</span> <span class="n">wrapped</span><span class="p">:</span>
        <span class="n">first_n_minus_1</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">item_buffer</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">:</span>
            <span class="n">item_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">item_buffer</span><span class="p">)</span> <span class="o">==</span> <span class="n">n</span><span class="p">:</span>
                <span class="k">yield</span> <span class="nb">type</span><span class="p">(</span><span class="n">sequence</span><span class="p">)(</span><span class="n">item_buffer</span><span class="p">)</span>
                <span class="n">item_buffer</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">first_n_minus_1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">first_n_minus_1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">item_buffer</span> <span class="o">=</span> <span class="n">item_buffer</span> <span class="o">+</span> <span class="n">first_n_minus_1</span>
        <span class="k">if</span> <span class="n">item_buffer</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">n</span>
                <span class="k">yield</span> <span class="nb">type</span><span class="p">(</span><span class="n">sequence</span><span class="p">)(</span><span class="n">item_buffer</span><span class="p">[</span><span class="n">x</span><span class="p">:</span><span class="n">stop</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">item_buffer</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">:</span>
            <span class="n">item_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">item_buffer</span><span class="p">)</span> <span class="o">==</span> <span class="n">n</span><span class="p">:</span>
                <span class="k">yield</span> <span class="nb">type</span><span class="p">(</span><span class="n">sequence</span><span class="p">)(</span><span class="n">item_buffer</span><span class="p">)</span>
                <span class="n">item_buffer</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div>



<div class="viewcode-block" id="permute">
<a class="viewcode-back" href="../../api/abjad/sequence.html#abjad.sequence.permute">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">permute</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="n">permutation</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Permutes ``sequence`` by ``permutation``.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.permute([10, 11, 12, 13, 14, 15], [5, 4, 0, 1, 2, 3])</span>
<span class="sd">        [15, 14, 10, 11, 12, 13]</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.permute([11, 12, 13, 14], [1, 0, 3, 2])</span>
<span class="sd">        [12, 11, 14, 13]</span>

<span class="sd">    ..  container:: exception</span>

<span class="sd">        Raises exception when lengths do not match:</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.permute([1, 2, 3, 4, 5, 6], [3, 0, 1, 2])</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">            ...</span>
<span class="sd">        ValueError: permutation [3, 0, 1, 2] must match length of [1, 2, 3, 4, 5, 6].</span>

<span class="sd">    Returns ``sequence`` type.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">permutation</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">sequence</span><span class="p">)(</span><span class="n">permutation</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_permutation</span><span class="p">(</span><span class="n">permutation</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;must be permutation: </span><span class="si">{</span><span class="n">permutation</span><span class="si">!r}</span><span class="s2">.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">permutation</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sequence</span><span class="p">):</span>
        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;permutation </span><span class="si">{</span><span class="n">permutation</span><span class="si">!r}</span><span class="s2"> must match length of </span><span class="si">{</span><span class="n">sequence</span><span class="w"> </span><span class="si">!r}</span><span class="s2">.&quot;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sequence</span><span class="p">):</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">permutation</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">item_</span> <span class="o">=</span> <span class="n">sequence</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item_</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">sequence</span><span class="p">)(</span><span class="n">result</span><span class="p">)</span></div>



<div class="viewcode-block" id="remove">
<a class="viewcode-back" href="../../api/abjad/sequence.html#abjad.sequence.remove">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">remove</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="n">pattern</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Removes ``sequence`` items at indices specified by ``pattern``.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; sequence = list(range(15))</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.remove(sequence, abjad.index([2, 3]))</span>
<span class="sd">        [0, 1, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14]</span>

<span class="sd">        Removes elements and indices -2 and -3:</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.remove(sequence, abjad.index([-2, -3]))</span>
<span class="sd">        [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 14]</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.remove(sequence, abjad.index([2, 3], 4))</span>
<span class="sd">        [0, 1, 4, 5, 8, 9, 12, 13]</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.remove(sequence, abjad.index([-2, -3], 4))</span>
<span class="sd">        [2, 3, 6, 7, 10, 11, 14]</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.remove(sequence, abjad.index([]))</span>
<span class="sd">        [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14]</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.remove(sequence, abjad.index([97, 98, 99]))</span>
<span class="sd">        [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14]</span>

<span class="sd">        Removes no elements:</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.remove(sequence, abjad.index([-97, -98, -99]))</span>
<span class="sd">        [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14]</span>

<span class="sd">    Returns ``sequence`` type.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">indices</span>
    <span class="n">period</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">period</span> <span class="ow">or</span> <span class="n">length</span>
    <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
    <span class="n">new_indices</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">length</span> <span class="o">&lt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">length</span> <span class="o">+</span> <span class="n">i</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">%</span> <span class="n">period</span>
        <span class="n">new_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="n">new_indices</span>
    <span class="n">indices</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sequence</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="n">period</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
            <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">sequence</span><span class="p">)(</span><span class="n">items</span><span class="p">)</span></div>



<div class="viewcode-block" id="remove_repeats">
<a class="viewcode-back" href="../../api/abjad/sequence.html#abjad.sequence.remove_repeats">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">remove_repeats</span><span class="p">(</span><span class="n">sequence</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Removes repeats from ``sequence``.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.remove_repeats([31, 31, 35, 35, 31, 31, 31, 31, 35])</span>
<span class="sd">        [31, 35, 31, 35]</span>

<span class="sd">    Returns ``sequence`` type.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">sequence</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="k">if</span> <span class="n">item</span> <span class="o">!=</span> <span class="n">items</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">sequence</span><span class="p">)(</span><span class="n">items</span><span class="p">)</span></div>



<div class="viewcode-block" id="repeat">
<a class="viewcode-back" href="../../api/abjad/sequence.html#abjad.sequence.repeat">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">repeat</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Repeats ``sequence``, to a total of ``n`` copies.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.repeat([1, 2, 3], n=0)</span>
<span class="sd">        []</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.repeat([1, 2, 3], n=1)</span>
<span class="sd">        [[1, 2, 3]]</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.repeat([1, 2, 3], n=2)</span>
<span class="sd">        [[1, 2, 3], [1, 2, 3]]</span>

<span class="sd">    Returns list of ``sequence`` types.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sequences</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">sequences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sequence</span><span class="p">[:])</span>
    <span class="k">return</span> <span class="n">sequences</span></div>



<div class="viewcode-block" id="repeat_to_length">
<a class="viewcode-back" href="../../api/abjad/sequence.html#abjad.sequence.repeat_to_length">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">repeat_to_length</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="n">length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Repeats ``sequence`` to ``length``.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Repeats list to length 11:</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.repeat_to_length([0, 1, 2, 3, 4], 11)</span>
<span class="sd">        [0, 1, 2, 3, 4, 0, 1, 2, 3, 4, 0]</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.repeat_to_length([0, 1, 2, 3, 4], 11, start=2)</span>
<span class="sd">        [2, 3, 4, 0, 1, 2, 3, 4, 0, 1, 2]</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.repeat_to_length([0, -1, -2, -3, -4], 11)</span>
<span class="sd">        [0, -1, -2, -3, -4, 0, -1, -2, -3, -4, 0]</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.repeat_to_length([0, -1, -2, -3, -4], 0)</span>
<span class="sd">        []</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.repeat_to_length([1, 2, 3], 10, start=100)</span>
<span class="sd">        [2, 3, 1, 2, 3, 1, 2, 3, 1, 2]</span>

<span class="sd">    Returns ``sequence`` type.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">_math</span><span class="o">.</span><span class="n">is_nonnegative_integer</span><span class="p">(</span><span class="n">length</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">sequence</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>
    <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">start</span> <span class="o">%=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>
    <span class="n">stop_index</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="n">length</span>
    <span class="n">repetitions</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">stop_index</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">sequence</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">repetitions</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">:</span>
            <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">sequence</span><span class="p">)(</span><span class="n">items</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop_index</span><span class="p">])</span></div>



<div class="viewcode-block" id="repeat_to_weight">
<a class="viewcode-back" href="../../api/abjad/sequence.html#abjad.sequence.repeat_to_weight">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">repeat_to_weight</span><span class="p">(</span>
    <span class="n">sequence</span><span class="p">,</span>
    <span class="n">weight</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">fractions</span><span class="o">.</span><span class="n">Fraction</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">allow_total</span><span class="p">:</span> <span class="n">_enums</span><span class="o">.</span><span class="n">Comparison</span> <span class="o">=</span> <span class="n">_enums</span><span class="o">.</span><span class="n">EXACT</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Repeats ``sequence`` to ``weight``.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Repeats sequence to weight of 23 exactly:</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.repeat_to_weight([5, -5, -5], 23)</span>
<span class="sd">        [5, -5, -5, 5, -3]</span>

<span class="sd">        Repeats sequence to weight of 23 more:</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.repeat_to_weight([5, -5, -5], 23, allow_total=abjad.MORE)</span>
<span class="sd">        [5, -5, -5, 5, -5]</span>

<span class="sd">        Repeats sequence to weight of 23 or less:</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.repeat_to_weight([5, -5, -5], 23, allow_total=abjad.LESS)</span>
<span class="sd">        [5, -5, -5, 5]</span>

<span class="sd">        &gt;&gt;&gt; sequence = [abjad.Duration(3, 16)]</span>
<span class="sd">        &gt;&gt;&gt; weight = abjad.Duration(5, 4)</span>
<span class="sd">        &gt;&gt;&gt; sequence = abjad.sequence.repeat_to_weight(sequence, weight)</span>
<span class="sd">        &gt;&gt;&gt; sum(sequence)</span>
<span class="sd">        Duration(5, 4)</span>

<span class="sd">        &gt;&gt;&gt; [abjad.duration.with_denominator(_, 16) for _ in sequence]</span>
<span class="sd">        [(3, 16), (3, 16), (3, 16), (3, 16), (3, 16), (3, 16), (2, 16)]</span>

<span class="sd">    Returns ``sequence`` type.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">weight</span>
    <span class="k">if</span> <span class="n">allow_total</span> <span class="ow">is</span> <span class="n">_enums</span><span class="o">.</span><span class="n">EXACT</span><span class="p">:</span>
        <span class="n">sequence_weight</span> <span class="o">=</span> <span class="n">_math</span><span class="o">.</span><span class="n">weight</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>
        <span class="n">complete_repetitions</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">sequence_weight</span><span class="p">)))</span>
        <span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>
        <span class="n">items</span> <span class="o">=</span> <span class="n">complete_repetitions</span> <span class="o">*</span> <span class="n">items</span>
        <span class="n">overage</span> <span class="o">=</span> <span class="n">complete_repetitions</span> <span class="o">*</span> <span class="n">sequence_weight</span> <span class="o">-</span> <span class="n">weight</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">overage</span><span class="p">:</span>
                <span class="n">element_weight</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="n">candidate_overage</span> <span class="o">=</span> <span class="n">overage</span> <span class="o">-</span> <span class="n">element_weight</span>
                <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">candidate_overage</span><span class="p">:</span>
                    <span class="n">overage</span> <span class="o">=</span> <span class="n">candidate_overage</span>
                    <span class="n">items</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">absolute_amount_to_keep</span> <span class="o">=</span> <span class="n">element_weight</span> <span class="o">-</span> <span class="n">overage</span>
                    <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">absolute_amount_to_keep</span>
                    <span class="n">signed_amount_to_keep</span> <span class="o">=</span> <span class="n">absolute_amount_to_keep</span>
                    <span class="n">signed_amount_to_keep</span> <span class="o">*=</span> <span class="n">_math</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                    <span class="n">items</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                    <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">signed_amount_to_keep</span><span class="p">)</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>
    <span class="k">elif</span> <span class="n">allow_total</span> <span class="ow">is</span> <span class="n">_enums</span><span class="o">.</span><span class="n">LESS</span><span class="p">:</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">sequence</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="n">_math</span><span class="o">.</span><span class="n">weight</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">weight</span><span class="p">:</span>
            <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sequence</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">sequence</span><span class="p">)])</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">weight</span> <span class="o">&lt;</span> <span class="n">_math</span><span class="o">.</span><span class="n">weight</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">items</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">sequence</span><span class="p">)(</span><span class="n">items</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">allow_total</span> <span class="ow">is</span> <span class="n">_enums</span><span class="o">.</span><span class="n">MORE</span><span class="p">:</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">sequence</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="n">_math</span><span class="o">.</span><span class="n">weight</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">weight</span><span class="p">:</span>
            <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sequence</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">sequence</span><span class="p">)])</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">sequence</span><span class="p">)(</span><span class="n">items</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;is not an ordinal value constant: </span><span class="si">{</span><span class="n">allow_total</span><span class="si">!r}</span><span class="s2">.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">sequence</span><span class="p">)(</span><span class="n">items</span><span class="p">)</span></div>



<div class="viewcode-block" id="replace">
<a class="viewcode-back" href="../../api/abjad/sequence.html#abjad.sequence.replace">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">replace</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Replaces every ``old``-valued item in ``sequence`` with ``new``.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; sequence = [0, 2, 3, 0, 2, 3, 0, 2, 3]</span>
<span class="sd">        &gt;&gt;&gt; abjad.sequence.replace(sequence, 0, 1)</span>
<span class="sd">        [1, 2, 3, 1, 2, 3, 1, 2, 3]</span>

<span class="sd">    Returns ``sequence`` type.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="n">old</span><span class="p">:</span>
            <span class="n">new_copy</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">new</span><span class="p">)</span>
            <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_copy</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">sequence</span><span class="p">)(</span><span class="n">items</span><span class="p">)</span></div>



<div class="viewcode-block" id="replace_at">
<a class="viewcode-back" href="../../api/abjad/sequence.html#abjad.sequence.replace_at">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">replace_at</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">new_material</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Replaces items at ``indices`` with ``new_material``.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Replaces items at indices 0, 2, 4, 6:</span>

<span class="sd">        &gt;&gt;&gt; sequence = list(range(16))</span>
<span class="sd">        &gt;&gt;&gt; abjad.sequence.replace_at(</span>
<span class="sd">        ...     sequence,</span>
<span class="sd">        ...     ([0], 2),</span>
<span class="sd">        ...     ([&#39;A&#39;, &#39;B&#39;, &#39;C&#39;, &#39;D&#39;], None),</span>
<span class="sd">        ... )</span>
<span class="sd">        [&#39;A&#39;, 1, &#39;B&#39;, 3, &#39;C&#39;, 5, &#39;D&#39;, 7, 8, 9, 10, 11, 12, 13, 14, 15]</span>

<span class="sd">        Replaces elements at indices 0, 1, 8, 13:</span>

<span class="sd">        &gt;&gt;&gt; sequence = list(range(16))</span>
<span class="sd">        &gt;&gt;&gt; abjad.sequence.replace_at(</span>
<span class="sd">        ...     sequence,</span>
<span class="sd">        ...     ([0, 1, 8, 13], None),</span>
<span class="sd">        ...     ([&#39;A&#39;, &#39;B&#39;, &#39;C&#39;, &#39;D&#39;], None),</span>
<span class="sd">        ... )</span>
<span class="sd">        [&#39;A&#39;, &#39;B&#39;, 2, 3, 4, 5, 6, 7, &#39;C&#39;, 9, 10, 11, 12, &#39;D&#39;, 14, 15]</span>

<span class="sd">        Replaces every item at even index:</span>

<span class="sd">        &gt;&gt;&gt; sequence = list(range(16))</span>
<span class="sd">        &gt;&gt;&gt; abjad.sequence.replace_at(</span>
<span class="sd">        ...     sequence,</span>
<span class="sd">        ...     ([0], 2),</span>
<span class="sd">        ...     ([&#39;*&#39;], 1),</span>
<span class="sd">        ... )</span>
<span class="sd">        [&#39;*&#39;, 1, &#39;*&#39;, 3, &#39;*&#39;, 5, &#39;*&#39;, 7, &#39;*&#39;, 9, &#39;*&#39;, 11, &#39;*&#39;, 13, &#39;*&#39;, 15]</span>

<span class="sd">        Replaces every element at an index congruent to 0 (mod 6) with ``&#39;A&#39;``; replaces</span>
<span class="sd">        every element at an index congruent to 2 (mod 6) with ``&#39;B&#39;``:</span>

<span class="sd">        &gt;&gt;&gt; sequence = list(range(16))</span>
<span class="sd">        &gt;&gt;&gt; abjad.sequence.replace_at(</span>
<span class="sd">        ...     sequence,</span>
<span class="sd">        ...     ([0], 2),</span>
<span class="sd">        ...     ([&#39;A&#39;, &#39;B&#39;], 3),</span>
<span class="sd">        ... )</span>
<span class="sd">        [&#39;A&#39;, 1, &#39;B&#39;, 3, 4, 5, &#39;A&#39;, 7, &#39;B&#39;, 9, 10, 11, &#39;A&#39;, 13, &#39;B&#39;, 15]</span>

<span class="sd">    Returns ``sequence`` type.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
    <span class="n">index_values</span><span class="p">,</span> <span class="n">index_period</span> <span class="o">=</span> <span class="n">indices</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index_values</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">)</span>
    <span class="n">index_values</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">index_values</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index_period</span><span class="p">,</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_material</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_material</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
    <span class="n">material_values</span><span class="p">,</span> <span class="n">material_period</span> <span class="o">=</span> <span class="n">new_material</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">material_values</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">)</span>
    <span class="n">material_values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">material_values</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">material_period</span><span class="p">,</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>
    <span class="n">maxsize</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span>
    <span class="k">if</span> <span class="n">index_period</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">index_period</span> <span class="o">=</span> <span class="n">maxsize</span>
    <span class="k">if</span> <span class="n">material_period</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">material_period</span> <span class="o">=</span> <span class="n">maxsize</span>
    <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">material_index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sequence</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">%</span> <span class="n">index_period</span> <span class="ow">in</span> <span class="n">index_values</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cyclic_material_index</span> <span class="o">=</span> <span class="n">material_index</span> <span class="o">%</span> <span class="n">material_period</span>
                <span class="n">material_value</span> <span class="o">=</span> <span class="n">material_values</span><span class="p">[</span><span class="n">cyclic_material_index</span><span class="p">]</span>
                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">material_value</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="n">material_index</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">sequence</span><span class="p">)(</span><span class="n">items</span><span class="p">)</span></div>



<div class="viewcode-block" id="retain_pattern">
<a class="viewcode-back" href="../../api/abjad/sequence.html#abjad.sequence.retain_pattern">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">retain_pattern</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="n">pattern</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retains ``sequence`` items at indices matching ``pattern``.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; sequence = list(range(10))</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.retain_pattern(sequence, abjad.index_all())</span>
<span class="sd">        [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.retain_pattern(sequence, abjad.index([2, 3]))</span>
<span class="sd">        [2, 3]</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.retain_pattern(sequence, abjad.index([-2, -3]))</span>
<span class="sd">        [7, 8]</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.retain_pattern(sequence, abjad.index([2, 3], 4))</span>
<span class="sd">        [2, 3, 6, 7]</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.retain_pattern(sequence, abjad.index([-2, -3], 4))</span>
<span class="sd">        [0, 3, 4, 7, 8]</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.retain_pattern(sequence, abjad.index([97, 98, 99]))</span>
<span class="sd">        []</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.retain_pattern(sequence, abjad.index([-97, -98, -99]))</span>
<span class="sd">        []</span>

<span class="sd">    Returns ``sequence`` type.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>
    <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sequence</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">pattern</span><span class="o">.</span><span class="n">matches_index</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
            <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">sequence</span><span class="p">)(</span><span class="n">items</span><span class="p">)</span></div>



<div class="viewcode-block" id="reverse">
<a class="viewcode-back" href="../../api/abjad/sequence.html#abjad.sequence.reverse">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">reverse</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">recurse</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reverses ``sequence``.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Reverses sequence:</span>

<span class="sd">        &gt;&gt;&gt; sequence = [[1, 2], 3, [4, 5]]</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.reverse(sequence)</span>
<span class="sd">        [[4, 5], 3, [1, 2]]</span>

<span class="sd">        Reverses recursively:</span>

<span class="sd">        &gt;&gt;&gt; segment_1 = abjad.PitchClassSegment([1, 2])</span>
<span class="sd">        &gt;&gt;&gt; pitch = abjad.NumberedPitch(3)</span>
<span class="sd">        &gt;&gt;&gt; segment_2 = abjad.PitchClassSegment([4, 5])</span>
<span class="sd">        &gt;&gt;&gt; sequence = list([segment_1, pitch, segment_2])</span>

<span class="sd">        &gt;&gt;&gt; for item in abjad.sequence.reverse(sequence, recurse=True):</span>
<span class="sd">        ...     item</span>
<span class="sd">        ...</span>
<span class="sd">        PitchClassSegment([5, 4])</span>
<span class="sd">        NumberedPitch(3)</span>
<span class="sd">        PitchClassSegment([2, 1])</span>

<span class="sd">    Returns ``sequence`` type.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">recurse</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">sequence</span><span class="p">)(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">sequence</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_reverse_helper</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">):</span>
            <span class="n">subitems_</span> <span class="o">=</span> <span class="p">[</span><span class="n">_reverse_helper</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">item</span><span class="p">)]</span>
            <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">)(</span><span class="n">subitems_</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">item</span>

    <span class="n">items</span> <span class="o">=</span> <span class="n">_reverse_helper</span><span class="p">(</span><span class="n">sequence</span><span class="p">[:])</span>
    <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">sequence</span><span class="p">)(</span><span class="n">items</span><span class="p">)</span></div>



<div class="viewcode-block" id="rotate">
<a class="viewcode-back" href="../../api/abjad/sequence.html#abjad.sequence.rotate">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">rotate</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Rotates ``sequence`` by index ``n``.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Rotates sequence to the right:</span>

<span class="sd">        &gt;&gt;&gt; sequence = list(range(10))</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.rotate(sequence, n=4)</span>
<span class="sd">        [6, 7, 8, 9, 0, 1, 2, 3, 4, 5]</span>

<span class="sd">        Rotates sequence to the left:</span>

<span class="sd">        &gt;&gt;&gt; sequence = list(range(10))</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.rotate(sequence, n=-3)</span>
<span class="sd">        [3, 4, 5, 6, 7, 8, 9, 0, 1, 2]</span>

<span class="sd">        Rotates sequence to neither the right nor the left:</span>

<span class="sd">        &gt;&gt;&gt; sequence = list(range(10))</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.rotate(sequence, n=0)</span>
<span class="sd">        [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</span>

<span class="sd">    Returns ``sequence`` type.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="ow">or</span> <span class="mi">0</span>
    <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sequence</span><span class="p">):</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">[</span><span class="o">-</span><span class="n">n</span> <span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">sequence</span><span class="p">)]</span> <span class="o">+</span> <span class="n">sequence</span><span class="p">[:</span><span class="o">-</span><span class="n">n</span><span class="p">]:</span>
            <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">sequence</span><span class="p">)(</span><span class="n">items</span><span class="p">)</span></div>



<div class="viewcode-block" id="sum_by_sign">
<a class="viewcode-back" href="../../api/abjad/sequence.html#abjad.sequence.sum_by_sign">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">sum_by_sign</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">sign</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sums consecutive ``sequence`` items by ``sign``.</span>

<span class="sd">    &gt;&gt;&gt; sequence = [0, 0, -1, -1, 2, 3, -5, 1, 2, 5, -5, -6]</span>

<span class="sd">    &gt;&gt;&gt; abjad.sequence.sum_by_sign(sequence)</span>
<span class="sd">    [0, -2, 5, -5, 8, -11]</span>

<span class="sd">    &gt;&gt;&gt; abjad.sequence.sum_by_sign(sequence, sign=[-1])</span>
<span class="sd">    [0, 0, -2, 2, 3, -5, 1, 2, 5, -11]</span>

<span class="sd">    &gt;&gt;&gt; abjad.sequence.sum_by_sign(sequence, sign=[0])</span>
<span class="sd">    [0, -1, -1, 2, 3, -5, 1, 2, 5, -5, -6]</span>

<span class="sd">    &gt;&gt;&gt; abjad.sequence.sum_by_sign(sequence, sign=[1])</span>
<span class="sd">    [0, 0, -1, -1, 5, -5, 8, -5, -6]</span>

<span class="sd">    &gt;&gt;&gt; abjad.sequence.sum_by_sign(sequence, sign=[-1, 0])</span>
<span class="sd">    [0, -2, 2, 3, -5, 1, 2, 5, -11]</span>

<span class="sd">    &gt;&gt;&gt; abjad.sequence.sum_by_sign(sequence, sign=[-1, 1])</span>
<span class="sd">    [0, 0, -2, 5, -5, 8, -11]</span>

<span class="sd">    &gt;&gt;&gt; abjad.sequence.sum_by_sign(sequence, sign=[0, 1])</span>
<span class="sd">    [0, -1, -1, 5, -5, 8, -5, -6]</span>

<span class="sd">    &gt;&gt;&gt; abjad.sequence.sum_by_sign(sequence, sign=[-1, 0, 1])</span>
<span class="sd">    [0, -2, 5, -5, 8, -11]</span>

<span class="sd">    Sums consecutive negative elements when ``-1`` in ``sign``.</span>

<span class="sd">    Sums consecutive zero-valued elements when ``0`` in ``sign``.</span>

<span class="sd">    Sums consecutive positive elements when ``1`` in ``sign``.</span>

<span class="sd">    Returns ``sequence`` type.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">generator</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="n">_math</span><span class="o">.</span><span class="n">sign</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">current_sign</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">generator</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">current_sign</span> <span class="ow">in</span> <span class="n">sign</span><span class="p">:</span>
            <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">group</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">group</span><span class="p">:</span>
                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">sequence</span><span class="p">)(</span><span class="n">items</span><span class="p">)</span></div>



<div class="viewcode-block" id="truncate">
<a class="viewcode-back" href="../../api/abjad/sequence.html#abjad.sequence.truncate">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">truncate</span><span class="p">(</span>
    <span class="n">sequence</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">sum_</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">fractions</span><span class="o">.</span><span class="n">Fraction</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">weight</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">fractions</span><span class="o">.</span><span class="n">Fraction</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Truncates ``sequence``.</span>

<span class="sd">    &gt;&gt;&gt; sequence = [-1, 2, -3, 4, -5, 6, -7, 8, -9, 10]</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Truncates sequence to weights ranging from 1 to 10:</span>

<span class="sd">        &gt;&gt;&gt; for weight in range(1, 11):</span>
<span class="sd">        ...     result = abjad.sequence.truncate(sequence, weight=weight)</span>
<span class="sd">        ...     print(weight, result)</span>
<span class="sd">        ...</span>
<span class="sd">        1 [-1]</span>
<span class="sd">        2 [-1, 1]</span>
<span class="sd">        3 [-1, 2]</span>
<span class="sd">        4 [-1, 2, -1]</span>
<span class="sd">        5 [-1, 2, -2]</span>
<span class="sd">        6 [-1, 2, -3]</span>
<span class="sd">        7 [-1, 2, -3, 1]</span>
<span class="sd">        8 [-1, 2, -3, 2]</span>
<span class="sd">        9 [-1, 2, -3, 3]</span>
<span class="sd">        10 [-1, 2, -3, 4]</span>

<span class="sd">        Truncates sequence to sums ranging from 1 to 10:</span>

<span class="sd">        &gt;&gt;&gt; for sum_ in range(1, 11):</span>
<span class="sd">        ...     result = abjad.sequence.truncate(sequence, sum_=sum_)</span>
<span class="sd">        ...     print(sum_, result)</span>
<span class="sd">        ...</span>
<span class="sd">        1 [-1, 2]</span>
<span class="sd">        2 [-1, 2, -3, 4]</span>
<span class="sd">        3 [-1, 2, -3, 4, -5, 6]</span>
<span class="sd">        4 [-1, 2, -3, 4, -5, 6, -7, 8]</span>
<span class="sd">        5 [-1, 2, -3, 4, -5, 6, -7, 8, -9, 10]</span>
<span class="sd">        6 [-1, 2, -3, 4, -5, 6, -7, 8, -9, 10]</span>
<span class="sd">        7 [-1, 2, -3, 4, -5, 6, -7, 8, -9, 10]</span>
<span class="sd">        8 [-1, 2, -3, 4, -5, 6, -7, 8, -9, 10]</span>
<span class="sd">        9 [-1, 2, -3, 4, -5, 6, -7, 8, -9, 10]</span>
<span class="sd">        10 [-1, 2, -3, 4, -5, 6, -7, 8, -9, 10]</span>

<span class="sd">        Truncates sequence to zero weight:</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.truncate(sequence, weight=0)</span>
<span class="sd">        []</span>

<span class="sd">        Truncates sequence to zero sum:</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.truncate(sequence, sum_=0)</span>
<span class="sd">        []</span>

<span class="sd">    Ignores ``sum`` when ``weight`` and ``sum`` are both set.</span>

<span class="sd">    Raises value error on negative ``sum``.</span>

<span class="sd">    Returns ``sequence`` type.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">weight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">weight</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">weight</span><span class="p">:</span>
            <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">:</span>
                <span class="n">total</span> <span class="o">+=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">total</span> <span class="o">&lt;</span> <span class="n">weight</span><span class="p">:</span>
                    <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sign</span> <span class="o">=</span> <span class="n">_math</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                    <span class="n">trimmed_part</span> <span class="o">=</span> <span class="n">weight</span> <span class="o">-</span> <span class="n">_math</span><span class="o">.</span><span class="n">weight</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
                    <span class="n">trimmed_part</span> <span class="o">*=</span> <span class="n">sign</span>
                    <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trimmed_part</span><span class="p">)</span>
                    <span class="k">break</span>
    <span class="k">elif</span> <span class="n">sum_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">sum_</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">sum_</span><span class="p">)</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">sum_</span><span class="p">:</span>
            <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">:</span>
                <span class="n">total</span> <span class="o">+=</span> <span class="n">item</span>
                <span class="k">if</span> <span class="n">total</span> <span class="o">&lt;</span> <span class="n">sum_</span><span class="p">:</span>
                    <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sum_</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">items</span><span class="p">))</span>
                    <span class="k">break</span>
    <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">sequence</span><span class="p">)(</span><span class="n">items</span><span class="p">)</span></div>



<div class="viewcode-block" id="weight">
<a class="viewcode-back" href="../../api/abjad/sequence.html#abjad.sequence.weight">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">weight</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Gets weight of ``sequence``.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.weight([])</span>
<span class="sd">        0</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.weight([1])</span>
<span class="sd">        1</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.weight([1, 2, 3])</span>
<span class="sd">        6</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.weight([1, 2, -3])</span>
<span class="sd">        6</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.weight([-1, -2, -3])</span>
<span class="sd">        6</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.weight([-1, 2, -3, 4, -5, 6, -7, 8, -9, 10])</span>
<span class="sd">        55</span>

<span class="sd">        &gt;&gt;&gt; abjad.sequence.weight([[1, -7, -7], [1, -8 -8]])</span>
<span class="sd">        32</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">):</span>
            <span class="n">weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">weight</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span></div>



<div class="viewcode-block" id="zip">
<a class="viewcode-back" href="../../api/abjad/sequence.html#abjad.sequence.zip">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">zip</span><span class="p">(</span><span class="n">sequences</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">cyclic</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">truncate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Zips ``sequences``.</span>

<span class="sd">    Zips cyclically:</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; sequence = [[1, 2, 3], [&#39;a&#39;, &#39;b&#39;]]</span>
<span class="sd">        &gt;&gt;&gt; for item in abjad.sequence.zip(sequence, cyclic=True):</span>
<span class="sd">        ...     item</span>
<span class="sd">        ...</span>
<span class="sd">        (1, &#39;a&#39;)</span>
<span class="sd">        (2, &#39;b&#39;)</span>
<span class="sd">        (3, &#39;a&#39;)</span>

<span class="sd">        &gt;&gt;&gt; sequence = [[10, 11, 12], [20, 21], [30, 31, 32, 33]]</span>
<span class="sd">        &gt;&gt;&gt; for item in abjad.sequence.zip(sequence, cyclic=True):</span>
<span class="sd">        ...     item</span>
<span class="sd">        ...</span>
<span class="sd">        (10, 20, 30)</span>
<span class="sd">        (11, 21, 31)</span>
<span class="sd">        (12, 20, 32)</span>
<span class="sd">        (10, 21, 33)</span>

<span class="sd">        Zips without truncation:</span>

<span class="sd">        &gt;&gt;&gt; sequence = [[1, 2, 3, 4], [11, 12, 13], [21, 22, 23]]</span>
<span class="sd">        &gt;&gt;&gt; for item in abjad.sequence.zip(sequence, truncate=False):</span>
<span class="sd">        ...     item</span>
<span class="sd">        ...</span>
<span class="sd">        (1, 11, 21)</span>
<span class="sd">        (2, 12, 22)</span>
<span class="sd">        (3, 13, 23)</span>
<span class="sd">        (4,)</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Zips strictly:</span>

<span class="sd">        &gt;&gt;&gt; sequences = [[1, 2, 3, 4], [11, 12, 13], [21, 22, 23]]</span>
<span class="sd">        &gt;&gt;&gt; for triple in abjad.sequence.zip(sequences):</span>
<span class="sd">        ...     triple</span>
<span class="sd">        ...</span>
<span class="sd">        (1, 11, 21)</span>
<span class="sd">        (2, 12, 22)</span>
<span class="sd">        (3, 13, 23)</span>

<span class="sd">    Returns list of tuples.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sequences</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;must be iterable: </span><span class="si">{</span><span class="n">item</span><span class="si">!r}</span><span class="s2">.&quot;</span><span class="p">)</span>
    <span class="n">items</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">cyclic</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">sequences</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">items</span>
        <span class="n">maximum_length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">sequences</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">maximum_length</span><span class="p">):</span>
            <span class="n">part</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sequences</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="n">element</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                <span class="n">part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
            <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">truncate</span><span class="p">:</span>
        <span class="n">maximum_length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">sequences</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">maximum_length</span><span class="p">):</span>
            <span class="n">part</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sequences</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">truncate</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">builtins</span><span class="o">.</span><span class="n">zip</span><span class="p">(</span><span class="o">*</span><span class="n">sequences</span><span class="p">):</span>
            <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">items</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">result</span></div>

</pre></div>

    </div>
    
    </div>
    

<footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2008-2025, Trevor Bača &amp; Joséphine Oberholtzer.
      <span class="lastupdated">
        Last updated on Apr 04, 2025.
      </span>

    </p>
  </div> 

</footer>

</div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>