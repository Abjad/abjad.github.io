

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>abjad.contextmanagers &mdash; Abjad 3.27 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/abjad.css?v=1f187528" />
      <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../../_static/uqbar.css?v=e6773f5c" />
      <link rel="stylesheet" type="text/css" href="../../_static/lightbox2/css/lightbox.css?v=d2ef71d2" />

  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="canonical" href="https://abjad.github.io_modules/abjad/contextmanagers.html"/>
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=fd873761"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/ga.js?v=c455bbd5"></script>
      <script src="../../_static/toggleprompt.js?v=5801b3bb"></script>
      <script defer="defer" src="../../_static/lightbox2/js/lightbox.js?v=bc25c2e6"></script>
      <script src="../../_static/inject-autosummary-fqns.js?v=49afa734"></script>
      <script src="../../_static/inject-fqns.js?v=c5423c1b"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #FFAA55" >


    <a href="../../index.html" class="icon icon-home" alt="Documentation
    Home"> Abjad 3.27



</a>




<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>


        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">First steps</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../first_steps/audience.html">Audience</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../first_steps/macos.html">macOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../first_steps/linux.html">Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../first_steps/windows.html">Windows</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../overview/containers.html">Containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/containers-basic-operations-on.html">Containers, basic operations on</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/containers-retrieving-by-name.html">Containers, retrieving by name</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/containers-time-interpretation-of.html">Containers, time interpretation of</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/contexts-lilypond-type-of.html">Contexts, LilyPond type of</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/indicators.html">Indicators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/lilypond-files-preamble-of.html">LilyPond files, preamble of</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/lilypond-format-of-abjad-objects.html">LilyPond format, of Abjad objects</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../examples/corpus-selection.html">Corpus, figure selection from</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/design-by-dyads.html">Design, by dyads</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/enumeration.html">Enumeration, of rhythmic cells</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/magic-square-from-twelve-tone-row.html">Magic square, from twelve-tone row</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/scales-diatonic.html">Scales, diatonic</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/score-fragment-piano.html">Score fragment, piano</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">All classes &amp; functions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">Abjad API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Appendices</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../appendices/best-practices.html">Best practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendices/changes.html">Changes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendices/community.html">Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendices/configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendices/developer-installation.html">Developer installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendices/lilypond-context-concatenation.html">LilyPond context concatenation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendices/publications.html">Publications</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Score gallery</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../gallery-2020.html">2016-present</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gallery-2015.html">2015-11</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gallery-2010.html">2010-00</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #FFAA55" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Abjad</a>
      </nav>

      <div class="wy-nav-content">

<div class="rst-content style-external-links">

    


    <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
    <div itemprop="articleBody">
    
  <h1>Source code for abjad.contextmanagers</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Context managers.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">contextlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">filecmp</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pathlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">types</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">typing</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">_updatelib</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">configuration</span> <span class="k">as</span> <span class="n">_configuration</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">iterate</span> <span class="k">as</span> <span class="n">_iterate</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">score</span> <span class="k">as</span> <span class="n">_score</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">string</span> <span class="k">as</span> <span class="n">_string</span>

<span class="n">_Configuration</span> <span class="o">=</span> <span class="n">_configuration</span><span class="o">.</span><span class="n">Configuration</span><span class="p">()</span>


<div class="viewcode-block" id="FilesystemState">
<a class="viewcode-back" href="../../api/abjad/contextmanagers.html#abjad.contextmanagers.FilesystemState">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">FilesystemState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Filesystem state context manager.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;_keep&quot;</span><span class="p">,</span> <span class="s2">&quot;_remove&quot;</span><span class="p">)</span>
    <span class="n">_is_abstract</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">keep</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">remove</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">keep</span> <span class="o">=</span> <span class="n">keep</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="n">keep_tuple</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">keep</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_keep</span> <span class="o">=</span> <span class="n">keep_tuple</span>
        <span class="n">remove</span> <span class="o">=</span> <span class="n">remove</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="n">remove_tuple</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">remove</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_remove</span> <span class="o">=</span> <span class="n">remove_tuple</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;FilesystemState&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Backs up filesystem paths.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove</span><span class="p">():</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keep</span><span class="p">():</span>
            <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keep</span><span class="p">():</span>
            <span class="n">backup_path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;.backup&quot;</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">backup_path</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">filecmp</span><span class="o">.</span><span class="n">cmp</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">backup_path</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">backup_path</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;neither file nor directory: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exg_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">trackeback</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Restores filesytem paths and removes backups; also removes paths in</span>
<span class="sd">        remove list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">backup_paths</span> <span class="o">=</span> <span class="p">(</span><span class="n">_</span> <span class="o">+</span> <span class="s2">&quot;.backup&quot;</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keep</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">backup_paths</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keep</span><span class="p">():</span>
            <span class="n">backup_path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;.backup&quot;</span>
            <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">backup_path</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">backup_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">backup_path</span><span class="p">):</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">backup_path</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
                <span class="n">filecmp</span><span class="o">.</span><span class="n">cmp</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">backup_path</span><span class="p">)</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">backup_path</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">backup_path</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">backup_path</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">backup_path</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;neither file nor directory: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;neither file nor directory: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keep</span><span class="p">():</span>
            <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">backup_paths</span><span class="p">:</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

<div class="viewcode-block" id="FilesystemState.keep">
<a class="viewcode-back" href="../../api/abjad/contextmanagers.html#abjad.contextmanagers.FilesystemState.keep">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">keep</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets paths to restore on exit.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keep</span></div>


<div class="viewcode-block" id="FilesystemState.remove">
<a class="viewcode-back" href="../../api/abjad/contextmanagers.html#abjad.contextmanagers.FilesystemState.remove">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets paths to remove on exit.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove</span></div>
</div>



<div class="viewcode-block" id="ForbidUpdate">
<a class="viewcode-back" href="../../api/abjad/contextmanagers.html#abjad.contextmanagers.ForbidUpdate">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ForbidUpdate</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Forbid update context manager.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;_component&quot;</span><span class="p">,</span> <span class="s2">&quot;_update_on_exit&quot;</span><span class="p">)</span>
    <span class="n">_is_abstract</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">component</span><span class="p">:</span> <span class="n">_score</span><span class="o">.</span><span class="n">Component</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">update_on_exit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="n">_score</span><span class="o">.</span><span class="n">Component</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">component</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_component</span> <span class="o">=</span> <span class="n">component</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">update_on_exit</span><span class="p">,</span> <span class="nb">bool</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">update_on_exit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_on_exit</span> <span class="o">=</span> <span class="n">update_on_exit</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ForbidUpdate&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enters context manager.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            REGRESSION. Indicators need to be updated after swap; context</span>
<span class="sd">            manager updates indicators before forbidding further updates:</span>

<span class="sd">            &gt;&gt;&gt; staff = abjad.Staff(r&quot;\tuplet 1/1 { c&#39;4 d&#39; }&quot;)</span>
<span class="sd">            &gt;&gt;&gt; abjad.attach(abjad.Clef(&quot;alto&quot;), staff[0][0])</span>
<span class="sd">            &gt;&gt;&gt; container = abjad.Container()</span>
<span class="sd">            &gt;&gt;&gt; abjad.mutate.swap(staff[0], container)</span>
<span class="sd">            &gt;&gt;&gt; with abjad.contextmanagers.ForbidUpdate(staff):</span>
<span class="sd">            ...     for note in staff[0]:</span>
<span class="sd">            ...         print(note)</span>
<span class="sd">            ...         print(abjad.get.effective_indicator(note, abjad.Clef))</span>
<span class="sd">            ...</span>
<span class="sd">            Note(&quot;c&#39;4&quot;)</span>
<span class="sd">            Clef(name=&#39;alto&#39;)</span>
<span class="sd">            Note(&quot;d&#39;4&quot;)</span>
<span class="sd">            Clef(name=&#39;alto&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">component_</span> <span class="ow">in</span> <span class="n">_iterate</span><span class="o">.</span><span class="n">components</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="p">()):</span>
            <span class="n">_updatelib</span><span class="o">.</span><span class="n">_update_now</span><span class="p">(</span>
                <span class="n">component_</span><span class="p">,</span> <span class="n">indicators</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">offsets</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">offsets_in_seconds</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="p">()</span><span class="o">.</span><span class="n">_is_forbidden_to_update</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Exits context manager.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="p">()</span><span class="o">.</span><span class="n">_is_forbidden_to_update</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_on_exit</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">component_</span> <span class="ow">in</span> <span class="n">_iterate</span><span class="o">.</span><span class="n">components</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="p">()):</span>
                <span class="n">_updatelib</span><span class="o">.</span><span class="n">_update_now</span><span class="p">(</span>
                    <span class="n">component_</span><span class="p">,</span>
                    <span class="n">indicators</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">offsets</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">offsets_in_seconds</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_on_exit</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">False</span>

<div class="viewcode-block" id="ForbidUpdate.component">
<a class="viewcode-back" href="../../api/abjad/contextmanagers.html#abjad.contextmanagers.ForbidUpdate.component">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">component</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_score</span><span class="o">.</span><span class="n">Component</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets component.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_component</span></div>


<div class="viewcode-block" id="ForbidUpdate.update_on_exit">
<a class="viewcode-back" href="../../api/abjad/contextmanagers.html#abjad.contextmanagers.ForbidUpdate.update_on_exit">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_on_exit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Is true when context manager updates offsets on exit.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_on_exit</span></div>
</div>



<div class="viewcode-block" id="NullContextManager">
<a class="viewcode-back" href="../../api/abjad/contextmanagers.html#abjad.contextmanagers.NullContextManager">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">NullContextManager</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Null context manager.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">_is_abstract</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enters context manager and does nothing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Exits context manager and does nothing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>



<div class="viewcode-block" id="RedirectedStreams">
<a class="viewcode-back" href="../../api/abjad/contextmanagers.html#abjad.contextmanagers.RedirectedStreams">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">RedirectedStreams</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Redirected streams context manager.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Captures stdout and stderr output:</span>

<span class="sd">        &gt;&gt;&gt; import io</span>
<span class="sd">        &gt;&gt;&gt; string_io = io.StringIO()</span>
<span class="sd">        &gt;&gt;&gt; with abjad.contextmanagers.RedirectedStreams(stdout=string_io):</span>
<span class="sd">        ...     print(&quot;hello, world!&quot;)</span>
<span class="sd">        ...</span>
<span class="sd">        &gt;&gt;&gt; result = string_io.getvalue()</span>
<span class="sd">        &gt;&gt;&gt; string_io.close()</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        hello, world!</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;_stdout&quot;</span><span class="p">,</span> <span class="s2">&quot;_stderr&quot;</span><span class="p">,</span> <span class="s2">&quot;_old_stderr&quot;</span><span class="p">,</span> <span class="s2">&quot;_old_stdout&quot;</span><span class="p">)</span>
    <span class="n">_is_abstract</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">stdout</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">TextIO</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">stderr</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">TextIO</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">stdout</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_stdout</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_stdout</span> <span class="o">=</span> <span class="n">stdout</span>
        <span class="k">if</span> <span class="n">stderr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_stderr</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_stderr</span> <span class="o">=</span> <span class="n">stderr</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;RedirectedStreams&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enters redirected streams context manager.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_old_stdout</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_old_stderr</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_old_stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_old_stderr</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">stderr</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">exc_type</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">exc_value</span><span class="p">:</span> <span class="ne">BaseException</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">traceback</span><span class="p">:</span> <span class="n">types</span><span class="o">.</span><span class="n">TracebackType</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Exits redirected streams context manager.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="p">()</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stderr</span><span class="p">()</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_old_stdout</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_old_stderr</span>

<div class="viewcode-block" id="RedirectedStreams.stderr">
<a class="viewcode-back" href="../../api/abjad/contextmanagers.html#abjad.contextmanagers.RedirectedStreams.stderr">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">stderr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">TextIO</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets stderr of context manager.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stderr</span></div>


<div class="viewcode-block" id="RedirectedStreams.stdout">
<a class="viewcode-back" href="../../api/abjad/contextmanagers.html#abjad.contextmanagers.RedirectedStreams.stdout">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">stdout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">TextIO</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets stdout of context manager.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stdout</span></div>
</div>



<div class="viewcode-block" id="temporary_directory_change">
<a class="viewcode-back" href="../../api/abjad/contextmanagers.html#abjad.contextmanagers.temporary_directory_change">[docs]</a>
<span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
<span class="k">def</span><span class="w"> </span><span class="nf">temporary_directory_change</span><span class="p">(</span><span class="n">directory</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Iterator</span><span class="p">[</span><span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Temporary directory change context manager.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">original_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">original_directory</span><span class="p">)</span></div>



<div class="viewcode-block" id="Timer">
<a class="viewcode-back" href="../../api/abjad/contextmanagers.html#abjad.contextmanagers.Timer">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Timer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Timer context manager.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Prints elapsed time after timer finishes:</span>

<span class="sd">        &gt;&gt;&gt; timer = abjad.contextmanagers.Timer()</span>
<span class="sd">        &gt;&gt;&gt; with timer:</span>
<span class="sd">        ...     for _ in range(1000000):</span>
<span class="sd">        ...         x = 1 + 1</span>
<span class="sd">        ...</span>
<span class="sd">        &gt;&gt;&gt; timer.elapsed_time() # doctest: +SKIP</span>
<span class="sd">        0.092742919921875</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Prints elapsed time while timer is running; timers can be reused</span>
<span class="sd">        between with-blocks:</span>

<span class="sd">        &gt;&gt;&gt; with abjad.contextmanagers.Timer() as timer: # doctest: +SKIP</span>
<span class="sd">        ...     for _ in range(5):</span>
<span class="sd">        ...         for _ in range(1000000):</span>
<span class="sd">        ...             x = 1 + 1</span>
<span class="sd">        ...         print(timer.elapsed_time())</span>
<span class="sd">        ...</span>
<span class="sd">        0.101150989532</span>
<span class="sd">        0.203935861588</span>
<span class="sd">        0.304930925369</span>
<span class="sd">        0.4057970047</span>
<span class="sd">        0.50649189949</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;_enter_message&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_exit_message&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_print_continuously_from_background&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_process&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_start_time&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_stop_time&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_timer_process&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_verbose&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">_is_abstract</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">enter_message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">exit_message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">print_continuously_from_background</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">enter_message</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">enter_message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_enter_message</span> <span class="o">=</span> <span class="n">enter_message</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exit_message</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">exit_message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_exit_message</span> <span class="o">=</span> <span class="n">exit_message</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_print_continuously_from_background</span> <span class="o">=</span> <span class="n">print_continuously_from_background</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_process</span><span class="p">:</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timer_process</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start_time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stop_time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">verbose</span><span class="p">,</span> <span class="nb">bool</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_verbose</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Timer&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enters context manager.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enter_message</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">enter_message</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stop_time</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">print_continuously_from_background</span><span class="p">():</span>
            <span class="n">path</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">_Configuration</span><span class="o">.</span><span class="n">abjad_install_directory</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;scripts&quot;</span> <span class="o">/</span> <span class="s2">&quot;timer.py&quot;</span>
            <span class="p">)</span>
            <span class="n">interval</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">print_continuously_from_background</span><span class="p">()))</span>
            <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="n">path</span><span class="p">,</span> <span class="n">interval</span><span class="p">],</span> <span class="n">shell</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_process</span> <span class="o">=</span> <span class="n">process</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Exits context manager.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stop_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_process</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exit_message</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exit_message</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_time_message</span><span class="p">())</span>

<div class="viewcode-block" id="Timer.elapsed_time">
<a class="viewcode-back" href="../../api/abjad/contextmanagers.html#abjad.contextmanagers.Timer.elapsed_time">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">elapsed_time</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets elapsed time of timer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">start_time</span><span class="p">,</span> <span class="n">stop_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_time</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">start_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">stop_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">stop_time</span> <span class="o">-</span> <span class="n">start_time</span>
            <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
        <span class="k">return</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="Timer.enter_message">
<a class="viewcode-back" href="../../api/abjad/contextmanagers.html#abjad.contextmanagers.Timer.enter_message">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">enter_message</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets timer enter message.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_enter_message</span></div>


<div class="viewcode-block" id="Timer.exit_message">
<a class="viewcode-back" href="../../api/abjad/contextmanagers.html#abjad.contextmanagers.Timer.exit_message">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">exit_message</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets timer exit message.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exit_message</span></div>


<div class="viewcode-block" id="Timer.print_continuously_from_background">
<a class="viewcode-back" href="../../api/abjad/contextmanagers.html#abjad.contextmanagers.Timer.print_continuously_from_background">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">print_continuously_from_background</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Is true when timer prints continuously from background.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_continuously_from_background</span></div>


<div class="viewcode-block" id="Timer.start_time">
<a class="viewcode-back" href="../../api/abjad/contextmanagers.html#abjad.contextmanagers.Timer.start_time">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">start_time</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets start time of timer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start_time</span></div>


<div class="viewcode-block" id="Timer.stop_time">
<a class="viewcode-back" href="../../api/abjad/contextmanagers.html#abjad.contextmanagers.Timer.stop_time">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">stop_time</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets stop time of timer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop_time</span></div>


<div class="viewcode-block" id="Timer.total_time_message">
<a class="viewcode-back" href="../../api/abjad/contextmanagers.html#abjad.contextmanagers.Timer.total_time_message">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">total_time_message</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets total time message, truncated to nearest second.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">identifier</span> <span class="o">=</span> <span class="n">_string</span><span class="o">.</span><span class="n">pluralize</span><span class="p">(</span><span class="s2">&quot;second&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elapsed_time</span><span class="p">()))</span>
        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;total time </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elapsed_time</span><span class="p">())</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">identifier</span><span class="si">}</span><span class="s2"> ...&quot;</span>
        <span class="k">return</span> <span class="n">message</span></div>


<div class="viewcode-block" id="Timer.verbose">
<a class="viewcode-back" href="../../api/abjad/contextmanagers.html#abjad.contextmanagers.Timer.verbose">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">verbose</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Is true when timer prints messages.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_verbose</span></div>
</div>

</pre></div>

    </div>
    
    </div>
    

<footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2008-2025, Trevor Bača &amp; Joséphine Oberholtzer.
      <span class="lastupdated">
        Last updated on Jul 28, 2025.
      </span>

    </p>
  </div> 

</footer>

</div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>