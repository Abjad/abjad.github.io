<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>abjad.meter &mdash; Abjad 3.7 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/abjad.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/uqbar.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/lightbox2/css/lightbox.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="canonical" href="https://abjad.github.io_modules/abjad/meter.html"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script defer="defer" src="../../_static/copybutton.js"></script>
        <script src="../../_static/ga.js"></script>
        <script defer="defer" src="../../_static/lightbox2/js/lightbox.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #112233" >


    <a href="../../index.html" class="icon icon-home" alt="Documentation
    Home"> Abjad 3.7



    <img src="../../_static/abjad-logo.png" class="logo" alt="Logo"/>

</a>




<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>


        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">First steps</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../first_steps/audience.html">Audience</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../first_steps/macos.html">macOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../first_steps/linux.html">Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../first_steps/windows.html">Windows</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../overview/about-the-docs.html">About the docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/containers.html">Containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/containers-basic-operations-on.html">Containers, basic operations on</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/containers-retrieving-by-name.html">Containers, retrieving by name</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/containers-time-interpretation-of.html">Containers, time interpretation of</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/contexts-lilypond-type-of.html">Contexts, LilyPond type of</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/indicators.html">Indicators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/lilypond-files-preamble-of.html">LilyPond files, preamble of</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/lilypond-format-of-abjad-objects.html">LilyPond format, of Abjad objects</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../examples/corpus-selection.html">Corpus, figure selection from</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/design-by-dyads.html">Design, by dyads</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/enumeration.html">Enumeration, of rhythmic cells</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/magic-square-from-twelve-tone-row.html">Magic square, from twelve-tone row</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/scales-diatonic.html">Scales, diatonic</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/score-fragment-piano.html">Score fragment, piano</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">All classes &amp; functions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">Abjad API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Appendices</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../appendices/best-practices.html">Best practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendices/changes.html">Changes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendices/community.html">Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendices/configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendices/developer-installation.html">Developer installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendices/lilypond-context-concatenation.html">LilyPond context concatenation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendices/publications.html">Publications</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Score gallery</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../gallery-2020.html">2020-16</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gallery-2015.html">2015-11</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gallery-2010.html">2010-00</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #112233" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Abjad</a>
      </nav>

      <div class="wy-nav-content">

<div class="rst-content">

    


    <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
    <div itemprop="articleBody">
    
  <h1>Source code for abjad.meter</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Tools for modeling musical meter.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">bisect</span>
<span class="kn">import</span> <span class="nn">collections</span>

<span class="kn">import</span> <span class="nn">uqbar.graphs</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">_inspect</span><span class="p">,</span> <span class="n">_iterate</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">duration</span> <span class="k">as</span> <span class="n">_duration</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">indicators</span> <span class="k">as</span> <span class="n">_indicators</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">lilypondfile</span> <span class="k">as</span> <span class="n">_lilypondfile</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">math</span> <span class="k">as</span> <span class="n">_math</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">mutate</span> <span class="k">as</span> <span class="n">_mutate</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">parentage</span> <span class="k">as</span> <span class="n">_parentage</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">rhythmtrees</span> <span class="k">as</span> <span class="n">_rhythmtrees</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">score</span> <span class="k">as</span> <span class="n">_score</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">select</span> <span class="k">as</span> <span class="n">_select</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">sequence</span> <span class="k">as</span> <span class="n">_sequence</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">timespan</span> <span class="k">as</span> <span class="n">_timespan</span>


<div class="viewcode-block" id="Meter"><a class="viewcode-back" href="../../api/abjad/meter.html#abjad.meter.Meter">[docs]</a><span class="k">class</span> <span class="nc">Meter</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Meter.</span>

<span class="sd">    Meter models a common practice understanding of beats and other levels of rhythmic</span>
<span class="sd">    organization structured as a tree. Meter structure corresponds to the monotonically</span>
<span class="sd">    increasing sequence of factors in the numerator of a given time signature.</span>
<span class="sd">    Successively deeper levels of the tree divide time by successive factors.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Duple meter:</span>

<span class="sd">        &gt;&gt;&gt; meter = abjad.Meter((2, 4))</span>
<span class="sd">        &gt;&gt;&gt; meter</span>
<span class="sd">        Meter(&#39;(2/4 (1/4 1/4))&#39;)</span>
<span class="sd">        &gt;&gt;&gt; print(meter.pretty_rtm_format)</span>
<span class="sd">        (2/4 (</span>
<span class="sd">            1/4</span>
<span class="sd">            1/4))</span>

<span class="sd">        &gt;&gt;&gt; abjad.graph(meter) # doctest: +SKIP</span>

<span class="sd">        ``2/4`` comprises two beats.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Triple meter:</span>

<span class="sd">        &gt;&gt;&gt; meter = abjad.Meter((3, 4))</span>
<span class="sd">        &gt;&gt;&gt; print(meter.pretty_rtm_format)</span>
<span class="sd">        (3/4 (</span>
<span class="sd">            1/4</span>
<span class="sd">            1/4</span>
<span class="sd">            1/4))</span>

<span class="sd">        &gt;&gt;&gt; abjad.graph(meter) # doctest: +SKIP</span>

<span class="sd">        ``3/4`` comprises three beats.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Quadruple meter:</span>

<span class="sd">        &gt;&gt;&gt; meter = abjad.Meter((4, 4))</span>
<span class="sd">        &gt;&gt;&gt; meter</span>
<span class="sd">        Meter(&#39;(4/4 (1/4 1/4 1/4 1/4))&#39;)</span>
<span class="sd">        &gt;&gt;&gt; print(meter.pretty_rtm_format)</span>
<span class="sd">        (4/4 (</span>
<span class="sd">            1/4</span>
<span class="sd">            1/4</span>
<span class="sd">            1/4</span>
<span class="sd">            1/4))</span>

<span class="sd">        &gt;&gt;&gt; abjad.graph(meter) # doctest: +SKIP</span>

<span class="sd">        ``4/4`` comprises four beats.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Compound triple meter:</span>

<span class="sd">        &gt;&gt;&gt; meter = abjad.Meter((6, 8))</span>
<span class="sd">        &gt;&gt;&gt; print(meter.pretty_rtm_format)</span>
<span class="sd">        (6/8 (</span>
<span class="sd">            (3/8 (</span>
<span class="sd">                1/8</span>
<span class="sd">                1/8</span>
<span class="sd">                1/8))</span>
<span class="sd">            (3/8 (</span>
<span class="sd">                1/8</span>
<span class="sd">                1/8</span>
<span class="sd">                1/8))))</span>

<span class="sd">        &gt;&gt;&gt; abjad.graph(meter) # doctest: +SKIP</span>

<span class="sd">        ``6/8`` comprises two beats of three parts each.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Another compound triple meter:</span>

<span class="sd">        &gt;&gt;&gt; meter = abjad.Meter((12, 8))</span>
<span class="sd">        &gt;&gt;&gt; print(meter.pretty_rtm_format)</span>
<span class="sd">        (12/8 (</span>
<span class="sd">            (3/8 (</span>
<span class="sd">                1/8</span>
<span class="sd">                1/8</span>
<span class="sd">                1/8))</span>
<span class="sd">            (3/8 (</span>
<span class="sd">                1/8</span>
<span class="sd">                1/8</span>
<span class="sd">                1/8))</span>
<span class="sd">            (3/8 (</span>
<span class="sd">                1/8</span>
<span class="sd">                1/8</span>
<span class="sd">                1/8))</span>
<span class="sd">            (3/8 (</span>
<span class="sd">                1/8</span>
<span class="sd">                1/8</span>
<span class="sd">                1/8))))</span>

<span class="sd">        &gt;&gt;&gt; abjad.graph(meter) # doctest: +SKIP</span>

<span class="sd">        ``12/8`` comprises four beats of three parts each.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        An asymmetric meter:</span>

<span class="sd">        &gt;&gt;&gt; meter = abjad.Meter((5, 4))</span>
<span class="sd">        &gt;&gt;&gt; print(meter.pretty_rtm_format)</span>
<span class="sd">        (5/4 (</span>
<span class="sd">            (3/4 (</span>
<span class="sd">                1/4</span>
<span class="sd">                1/4</span>
<span class="sd">                1/4))</span>
<span class="sd">            (2/4 (</span>
<span class="sd">                1/4</span>
<span class="sd">                1/4))))</span>

<span class="sd">        &gt;&gt;&gt; abjad.graph(meter) # doctest: +SKIP</span>

<span class="sd">        ``5/4`` comprises two unequal beats. By default unequal beats</span>
<span class="sd">        are arranged from greatest to least.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Another asymmetric meter:</span>

<span class="sd">        &gt;&gt;&gt; meter = abjad.Meter((7, 4))</span>
<span class="sd">        &gt;&gt;&gt; print(meter.pretty_rtm_format)</span>
<span class="sd">        (7/4 (</span>
<span class="sd">            (3/4 (</span>
<span class="sd">                1/4</span>
<span class="sd">                1/4</span>
<span class="sd">                1/4))</span>
<span class="sd">            (2/4 (</span>
<span class="sd">                1/4</span>
<span class="sd">                1/4))</span>
<span class="sd">            (2/4 (</span>
<span class="sd">                1/4</span>
<span class="sd">                1/4))))</span>

<span class="sd">        &gt;&gt;&gt; abjad.graph(meter) # doctest: +SKIP</span>

<span class="sd">        ``7/4`` comprises three unequal beats. Beats are arranged from</span>
<span class="sd">        greatest to least by default.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        The same asymmetric meter structured differently:</span>

<span class="sd">        &gt;&gt;&gt; meter = abjad.Meter(</span>
<span class="sd">        ...     (7, 4),</span>
<span class="sd">        ...     increase_monotonic=True,</span>
<span class="sd">        ...     )</span>
<span class="sd">        &gt;&gt;&gt; print(meter.pretty_rtm_format)</span>
<span class="sd">        (7/4 (</span>
<span class="sd">            (2/4 (</span>
<span class="sd">                1/4</span>
<span class="sd">                1/4))</span>
<span class="sd">            (2/4 (</span>
<span class="sd">                1/4</span>
<span class="sd">                1/4))</span>
<span class="sd">            (3/4 (</span>
<span class="sd">                1/4</span>
<span class="sd">                1/4</span>
<span class="sd">                1/4))))</span>

<span class="sd">        &gt;&gt;&gt; abjad.graph(meter) # doctest: +SKIP</span>

<span class="sd">        ``7/4`` with beats arragned from least to greatest.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Meter interpreted by default as containing two compound beats:</span>

<span class="sd">        &gt;&gt;&gt; meter = abjad.Meter((6, 4))</span>
<span class="sd">        &gt;&gt;&gt; meter</span>
<span class="sd">        Meter(&#39;(6/4 ((3/4 (1/4 1/4 1/4)) (3/4 (1/4 1/4 1/4))))&#39;)</span>
<span class="sd">        &gt;&gt;&gt; print(meter.pretty_rtm_format)</span>
<span class="sd">        (6/4 (</span>
<span class="sd">            (3/4 (</span>
<span class="sd">                1/4</span>
<span class="sd">                1/4</span>
<span class="sd">                1/4))</span>
<span class="sd">            (3/4 (</span>
<span class="sd">                1/4</span>
<span class="sd">                1/4</span>
<span class="sd">                1/4))))</span>

<span class="sd">        &gt;&gt;&gt; abjad.graph(meter) # doctest: +SKIP</span>

<span class="sd">        Same meter customized to contain four compound beats:</span>

<span class="sd">        &gt;&gt;&gt; parser = abjad.rhythmtrees.RhythmTreeParser()</span>
<span class="sd">        &gt;&gt;&gt; meter = abjad.Meter(&#39;(6/4 ((3/8 (1/8 1/8 1/8)) (3/8 (1/8 1/8 1/8)) (3/8 (1/8 1/8 1/8)) (3/8 (1/8 1/8 1/8))))&#39;)</span>
<span class="sd">        &gt;&gt;&gt; meter</span>
<span class="sd">        Meter(&#39;(6/4 ((3/8 (1/8 1/8 1/8)) (3/8 (1/8 1/8 1/8)) (3/8 (1/8 1/8 1/8)) (3/8 (1/8 1/8 1/8))))&#39;)</span>
<span class="sd">        &gt;&gt;&gt; print(meter.pretty_rtm_format)</span>
<span class="sd">        (6/4 (</span>
<span class="sd">            (3/8 (</span>
<span class="sd">                1/8</span>
<span class="sd">                1/8</span>
<span class="sd">                1/8))</span>
<span class="sd">            (3/8 (</span>
<span class="sd">                1/8</span>
<span class="sd">                1/8</span>
<span class="sd">                1/8))</span>
<span class="sd">            (3/8 (</span>
<span class="sd">                1/8</span>
<span class="sd">                1/8</span>
<span class="sd">                1/8))</span>
<span class="sd">            (3/8 (</span>
<span class="sd">                1/8</span>
<span class="sd">                1/8</span>
<span class="sd">                1/8))))</span>

<span class="sd">        &gt;&gt;&gt; abjad.graph(meter) # doctest: +SKIP</span>

<span class="sd">    Prime divisions greater than ``3`` are converted to sequences of ``2`` and ``3``</span>
<span class="sd">    summing to that prime. Summands are arranged from greatest to least by default. This</span>
<span class="sd">    means that ``5`` becomes ``3+2`` and ``7`` becomes ``3+2+2`` in the examples above.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">### CLASS VARIABLES ###</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;_increase_monotonic&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_denominator&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_numerator&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_preferred_boundary_depth&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_root_node&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1">### INITIALIZER ###</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">argument</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">increase_monotonic</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">preferred_boundary_depth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">argument</span> <span class="o">=</span> <span class="n">argument</span> <span class="ow">or</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">preferred_boundary_depth</span><span class="p">,</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_preferred_boundary_depth</span> <span class="o">=</span> <span class="n">preferred_boundary_depth</span>

        <span class="k">def</span> <span class="nf">recurse</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">factors</span><span class="p">,</span> <span class="n">denominator</span><span class="p">,</span> <span class="n">increase_monotonic</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">factors</span><span class="p">:</span>
                <span class="n">factor</span><span class="p">,</span> <span class="n">factors</span> <span class="o">=</span> <span class="n">factors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">factors</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="n">preprolated_duration</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">preprolated_duration</span><span class="o">.</span><span class="n">__div__</span><span class="p">(</span><span class="n">factor</span><span class="p">)</span>
                <span class="c1"># if factor in (2, 3, 4, 5):</span>
                <span class="k">if</span> <span class="n">factor</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">factors</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">factor</span><span class="p">):</span>
                            <span class="n">child</span> <span class="o">=</span> <span class="n">_rhythmtrees</span><span class="o">.</span><span class="n">RhythmTreeContainer</span><span class="p">(</span>
                                <span class="n">preprolated_duration</span><span class="o">=</span><span class="n">preprolated_duration</span>
                            <span class="p">)</span>
                            <span class="n">node</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
                            <span class="n">recurse</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">factors</span><span class="p">,</span> <span class="n">denominator</span><span class="p">,</span> <span class="n">increase_monotonic</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">factor</span><span class="p">):</span>
                            <span class="n">node</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                <span class="n">_rhythmtrees</span><span class="o">.</span><span class="n">RhythmTreeLeaf</span><span class="p">(</span>
                                    <span class="n">preprolated_duration</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">denominator</span><span class="p">)</span>
                                <span class="p">)</span>
                            <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                    <span class="n">total</span> <span class="o">=</span> <span class="mi">3</span>
                    <span class="k">while</span> <span class="n">total</span> <span class="o">&lt;</span> <span class="n">factor</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">increase_monotonic</span><span class="p">:</span>
                            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">parts</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                        <span class="n">total</span> <span class="o">+=</span> <span class="mi">2</span>
                    <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">:</span>
                        <span class="n">grouping</span> <span class="o">=</span> <span class="n">_rhythmtrees</span><span class="o">.</span><span class="n">RhythmTreeContainer</span><span class="p">(</span>
                            <span class="n">preprolated_duration</span><span class="o">=</span><span class="n">part</span> <span class="o">*</span> <span class="n">preprolated_duration</span>
                        <span class="p">)</span>
                        <span class="k">if</span> <span class="n">factors</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">part</span><span class="p">):</span>
                                <span class="n">child</span> <span class="o">=</span> <span class="n">_rhythmtrees</span><span class="o">.</span><span class="n">RhythmTreeContainer</span><span class="p">(</span>
                                    <span class="n">preprolated_duration</span><span class="o">=</span><span class="n">preprolated_duration</span>
                                <span class="p">)</span>
                                <span class="n">grouping</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
                                <span class="n">recurse</span><span class="p">(</span>
                                    <span class="n">child</span><span class="p">,</span>
                                    <span class="n">factors</span><span class="p">,</span>
                                    <span class="n">denominator</span><span class="p">,</span>
                                    <span class="n">increase_monotonic</span><span class="p">,</span>
                                <span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">part</span><span class="p">):</span>
                                <span class="n">grouping</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                    <span class="n">_rhythmtrees</span><span class="o">.</span><span class="n">RhythmTreeLeaf</span><span class="p">(</span>
                                        <span class="n">preprolated_duration</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">denominator</span><span class="p">)</span>
                                    <span class="p">)</span>
                                <span class="p">)</span>
                        <span class="n">node</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">grouping</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">node</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="n">_rhythmtrees</span><span class="o">.</span><span class="n">RhythmTreeLeaf</span><span class="p">(</span>
                            <span class="n">preprolated_duration</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">denominator</span><span class="p">)</span>
                        <span class="p">)</span>
                        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">preprolated_duration</span><span class="o">.</span><span class="n">numerator</span><span class="p">)</span>
                    <span class="p">]</span>
                <span class="p">)</span>

        <span class="n">increase_monotonic</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">increase_monotonic</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">numerator</span> <span class="o">=</span> <span class="n">argument</span><span class="o">.</span><span class="n">numerator</span>
            <span class="n">denominator</span> <span class="o">=</span> <span class="n">argument</span><span class="o">.</span><span class="n">denominator</span>
            <span class="n">is_fraction_like</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">is_fraction_like</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
            <span class="n">root</span> <span class="o">=</span> <span class="n">argument</span><span class="o">.</span><span class="n">root_node</span>
            <span class="n">numerator</span><span class="p">,</span> <span class="n">denominator</span> <span class="o">=</span> <span class="n">argument</span><span class="o">.</span><span class="n">numerator</span><span class="p">,</span> <span class="n">argument</span><span class="o">.</span><span class="n">denominator</span>
            <span class="n">increase_monotonic</span> <span class="o">=</span> <span class="n">argument</span><span class="o">.</span><span class="n">increase_monotonic</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">_rhythmtrees</span><span class="o">.</span><span class="n">RhythmTreeContainer</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">parsed</span> <span class="o">=</span> <span class="n">_rhythmtrees</span><span class="o">.</span><span class="n">RhythmTreeParser</span><span class="p">()(</span><span class="n">argument</span><span class="p">)</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">parsed</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
                <span class="n">root</span> <span class="o">=</span> <span class="n">parsed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">root</span> <span class="o">=</span> <span class="n">argument</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="p">[</span><span class="n">root</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">depth_first</span><span class="p">()):</span>
                <span class="k">assert</span> <span class="n">node</span><span class="o">.</span><span class="n">prolation</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="n">numerator</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">preprolated_duration</span><span class="o">.</span><span class="n">numerator</span>
            <span class="n">denominator</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">preprolated_duration</span><span class="o">.</span><span class="n">denominator</span>
        <span class="k">elif</span> <span class="n">is_fraction_like</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="n">fraction</span> <span class="o">=</span> <span class="n">_duration</span><span class="o">.</span><span class="n">NonreducedFraction</span><span class="p">(</span><span class="n">argument</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fraction</span> <span class="o">=</span> <span class="n">_duration</span><span class="o">.</span><span class="n">NonreducedFraction</span><span class="p">(</span>
                    <span class="n">argument</span><span class="o">.</span><span class="n">numerator</span><span class="p">,</span> <span class="n">argument</span><span class="o">.</span><span class="n">denominator</span>
                <span class="p">)</span>
            <span class="n">numerator</span><span class="p">,</span> <span class="n">denominator</span> <span class="o">=</span> <span class="n">fraction</span><span class="o">.</span><span class="n">numerator</span><span class="p">,</span> <span class="n">fraction</span><span class="o">.</span><span class="n">denominator</span>
            <span class="n">factors</span> <span class="o">=</span> <span class="n">_math</span><span class="o">.</span><span class="n">factors</span><span class="p">(</span><span class="n">numerator</span><span class="p">)</span>
            <span class="c1"># group two nested levels of 2s into a 4</span>
            <span class="k">if</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">factors</span><span class="p">)</span> <span class="ow">and</span> <span class="n">factors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">factors</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">factors</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">]</span>
            <span class="n">root</span> <span class="o">=</span> <span class="n">_rhythmtrees</span><span class="o">.</span><span class="n">RhythmTreeContainer</span><span class="p">(</span><span class="n">preprolated_duration</span><span class="o">=</span><span class="n">fraction</span><span class="p">)</span>
            <span class="n">recurse</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">factors</span><span class="p">,</span> <span class="n">denominator</span><span class="p">,</span> <span class="n">increase_monotonic</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;can not initialize </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">argument</span><span class="si">!r}</span><span class="s2">.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_root_node</span> <span class="o">=</span> <span class="n">root</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_numerator</span> <span class="o">=</span> <span class="n">numerator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_denominator</span> <span class="o">=</span> <span class="n">denominator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_increase_monotonic</span> <span class="o">=</span> <span class="n">increase_monotonic</span>

    <span class="c1">### SPECIAL METHODS ###</span>

<div class="viewcode-block" id="Meter.__eq__"><a class="viewcode-back" href="../../api/abjad/meter.html#abjad.meter.Meter.__eq__">[docs]</a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argument</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compares ``numerator``, ``denominator``, ``increase_monotonic``,</span>
<span class="sd">        ``preferred_boundary_depth``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">numerator</span> <span class="o">==</span> <span class="n">argument</span><span class="o">.</span><span class="n">numerator</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span> <span class="o">==</span> <span class="n">argument</span><span class="o">.</span><span class="n">denominator</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">increase_monotonic</span> <span class="o">==</span> <span class="n">argument</span><span class="o">.</span><span class="n">increase_monotonic</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">preferred_boundary_depth</span> <span class="o">==</span> <span class="n">argument</span><span class="o">.</span><span class="n">preferred_boundary_depth</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Meter.__graph__"><a class="viewcode-back" href="../../api/abjad/meter.html#abjad.meter.Meter.__graph__">[docs]</a>    <span class="k">def</span> <span class="nf">__graph__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">keywords</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets Graphviz format of meter.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Graphs ``7/4``:</span>

<span class="sd">            &gt;&gt;&gt; meter = abjad.Meter((7, 4))</span>
<span class="sd">            &gt;&gt;&gt; meter_graph = meter.__graph__()</span>
<span class="sd">            &gt;&gt;&gt; abjad.graph(meter_graph) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; print(format(meter_graph, &#39;graphviz&#39;))</span>
<span class="sd">                digraph G {</span>
<span class="sd">                    graph [bgcolor=transparent,</span>
<span class="sd">                        fontname=Arial,</span>
<span class="sd">                        penwidth=2,</span>
<span class="sd">                        truecolor=true];</span>
<span class="sd">                    node [fontname=Arial,</span>
<span class="sd">                        fontsize=12,</span>
<span class="sd">                        penwidth=2];</span>
<span class="sd">                    edge [penwidth=2];</span>
<span class="sd">                    node_0 [label=&quot;7/4&quot;,</span>
<span class="sd">                        shape=triangle];</span>
<span class="sd">                    node_1 [label=&quot;3/4&quot;,</span>
<span class="sd">                        shape=triangle];</span>
<span class="sd">                    node_2 [label=&quot;1/4&quot;,</span>
<span class="sd">                        shape=box];</span>
<span class="sd">                    node_3 [label=&quot;1/4&quot;,</span>
<span class="sd">                        shape=box];</span>
<span class="sd">                    node_4 [label=&quot;1/4&quot;,</span>
<span class="sd">                        shape=box];</span>
<span class="sd">                    node_5 [label=&quot;2/4&quot;,</span>
<span class="sd">                        shape=triangle];</span>
<span class="sd">                    node_6 [label=&quot;1/4&quot;,</span>
<span class="sd">                        shape=box];</span>
<span class="sd">                    node_7 [label=&quot;1/4&quot;,</span>
<span class="sd">                        shape=box];</span>
<span class="sd">                    node_8 [label=&quot;2/4&quot;,</span>
<span class="sd">                        shape=triangle];</span>
<span class="sd">                    node_9 [label=&quot;1/4&quot;,</span>
<span class="sd">                        shape=box];</span>
<span class="sd">                    node_10 [label=&quot;1/4&quot;,</span>
<span class="sd">                        shape=box];</span>
<span class="sd">                    subgraph cluster_offsets {</span>
<span class="sd">                        graph [style=rounded];</span>
<span class="sd">                        node_11_0 [color=white,</span>
<span class="sd">                            fillcolor=black,</span>
<span class="sd">                            fontcolor=white,</span>
<span class="sd">                            fontname=&quot;Arial bold&quot;,</span>
<span class="sd">                            label=&quot;{ &lt;f_0_0&gt; 0 | &lt;f_0_1&gt; +++ }&quot;,</span>
<span class="sd">                            shape=Mrecord,</span>
<span class="sd">                            style=filled];</span>
<span class="sd">                        node_11_1 [color=white,</span>
<span class="sd">                            fillcolor=black,</span>
<span class="sd">                            fontcolor=white,</span>
<span class="sd">                            fontname=&quot;Arial bold&quot;,</span>
<span class="sd">                            label=&quot;{ &lt;f_0_0&gt; 1/4 | &lt;f_0_1&gt; + }&quot;,</span>
<span class="sd">                            shape=Mrecord,</span>
<span class="sd">                            style=filled];</span>
<span class="sd">                        node_11_2 [color=white,</span>
<span class="sd">                            fillcolor=black,</span>
<span class="sd">                            fontcolor=white,</span>
<span class="sd">                            fontname=&quot;Arial bold&quot;,</span>
<span class="sd">                            label=&quot;{ &lt;f_0_0&gt; 1/2 | &lt;f_0_1&gt; + }&quot;,</span>
<span class="sd">                            shape=Mrecord,</span>
<span class="sd">                            style=filled];</span>
<span class="sd">                        node_11_3 [color=white,</span>
<span class="sd">                            fillcolor=black,</span>
<span class="sd">                            fontcolor=white,</span>
<span class="sd">                            fontname=&quot;Arial bold&quot;,</span>
<span class="sd">                            label=&quot;{ &lt;f_0_0&gt; 3/4 | &lt;f_0_1&gt; ++ }&quot;,</span>
<span class="sd">                            shape=Mrecord,</span>
<span class="sd">                            style=filled];</span>
<span class="sd">                        node_11_4 [color=white,</span>
<span class="sd">                            fillcolor=black,</span>
<span class="sd">                            fontcolor=white,</span>
<span class="sd">                            fontname=&quot;Arial bold&quot;,</span>
<span class="sd">                            label=&quot;{ &lt;f_0_0&gt; 1 | &lt;f_0_1&gt; + }&quot;,</span>
<span class="sd">                            shape=Mrecord,</span>
<span class="sd">                            style=filled];</span>
<span class="sd">                        node_11_5 [color=white,</span>
<span class="sd">                            fillcolor=black,</span>
<span class="sd">                            fontcolor=white,</span>
<span class="sd">                            fontname=&quot;Arial bold&quot;,</span>
<span class="sd">                            label=&quot;{ &lt;f_0_0&gt; 5/4 | &lt;f_0_1&gt; ++ }&quot;,</span>
<span class="sd">                            shape=Mrecord,</span>
<span class="sd">                            style=filled];</span>
<span class="sd">                        node_11_6 [color=white,</span>
<span class="sd">                            fillcolor=black,</span>
<span class="sd">                            fontcolor=white,</span>
<span class="sd">                            fontname=&quot;Arial bold&quot;,</span>
<span class="sd">                            label=&quot;{ &lt;f_0_0&gt; 3/2 | &lt;f_0_1&gt; + }&quot;,</span>
<span class="sd">                            shape=Mrecord,</span>
<span class="sd">                            style=filled];</span>
<span class="sd">                        node_11_7 [label=&quot;{ &lt;f_0_0&gt; 7/4 | &lt;f_0_1&gt; +++ }&quot;,</span>
<span class="sd">                            shape=Mrecord];</span>
<span class="sd">                    }</span>
<span class="sd">                    node_0 -&gt; node_1;</span>
<span class="sd">                    node_0 -&gt; node_5;</span>
<span class="sd">                    node_0 -&gt; node_8;</span>
<span class="sd">                    node_1 -&gt; node_2;</span>
<span class="sd">                    node_1 -&gt; node_3;</span>
<span class="sd">                    node_1 -&gt; node_4;</span>
<span class="sd">                    node_2 -&gt; node_11_0 [style=dotted];</span>
<span class="sd">                    node_2 -&gt; node_11_1 [style=dotted];</span>
<span class="sd">                    node_3 -&gt; node_11_1 [style=dotted];</span>
<span class="sd">                    node_3 -&gt; node_11_2 [style=dotted];</span>
<span class="sd">                    node_4 -&gt; node_11_2 [style=dotted];</span>
<span class="sd">                    node_4 -&gt; node_11_3 [style=dotted];</span>
<span class="sd">                    node_5 -&gt; node_6;</span>
<span class="sd">                    node_5 -&gt; node_7;</span>
<span class="sd">                    node_6 -&gt; node_11_3 [style=dotted];</span>
<span class="sd">                    node_6 -&gt; node_11_4 [style=dotted];</span>
<span class="sd">                    node_7 -&gt; node_11_4 [style=dotted];</span>
<span class="sd">                    node_7 -&gt; node_11_5 [style=dotted];</span>
<span class="sd">                    node_8 -&gt; node_9;</span>
<span class="sd">                    node_8 -&gt; node_10;</span>
<span class="sd">                    node_9 -&gt; node_11_5 [style=dotted];</span>
<span class="sd">                    node_9 -&gt; node_11_6 [style=dotted];</span>
<span class="sd">                    node_10 -&gt; node_11_6 [style=dotted];</span>
<span class="sd">                    node_10 -&gt; node_11_7 [style=dotted];</span>
<span class="sd">                }</span>

<span class="sd">        Returns Graphviz graph.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">make_offset_node</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">leaf_one</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">leaf_two</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">is_last</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_last</span><span class="p">:</span>
                <span class="n">offset_node</span> <span class="o">=</span> <span class="n">uqbar</span><span class="o">.</span><span class="n">graphs</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
                    <span class="n">attributes</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">&quot;shape&quot;</span><span class="p">:</span> <span class="s2">&quot;Mrecord&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;style&quot;</span><span class="p">:</span> <span class="s2">&quot;filled&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;fontname&quot;</span><span class="p">:</span> <span class="s2">&quot;Arial bold&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;fontcolor&quot;</span><span class="p">:</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;fillcolor&quot;</span><span class="p">:</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">offset_node</span> <span class="o">=</span> <span class="n">uqbar</span><span class="o">.</span><span class="n">graphs</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">attributes</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;shape&quot;</span><span class="p">:</span> <span class="s2">&quot;Mrecord&quot;</span><span class="p">})</span>
            <span class="n">offset_field</span> <span class="o">=</span> <span class="n">uqbar</span><span class="o">.</span><span class="n">graphs</span><span class="o">.</span><span class="n">RecordField</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">offset</span><span class="p">))</span>
            <span class="n">weight_field</span> <span class="o">=</span> <span class="n">uqbar</span><span class="o">.</span><span class="n">graphs</span><span class="o">.</span><span class="n">RecordField</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;+&quot;</span> <span class="o">*</span> <span class="n">offsets</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">offset</span><span class="p">])</span>
            <span class="n">group</span> <span class="o">=</span> <span class="n">uqbar</span><span class="o">.</span><span class="n">graphs</span><span class="o">.</span><span class="n">RecordGroup</span><span class="p">()</span>
            <span class="n">group</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">offset_field</span><span class="p">,</span> <span class="n">weight_field</span><span class="p">])</span>
            <span class="n">offset_node</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
            <span class="n">offset_subgraph</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">offset_node</span><span class="p">)</span>
            <span class="n">leaf_one_node</span> <span class="o">=</span> <span class="n">node_mapping</span><span class="p">[</span><span class="n">leaf_one</span><span class="p">]</span>
            <span class="n">edge</span> <span class="o">=</span> <span class="n">uqbar</span><span class="o">.</span><span class="n">graphs</span><span class="o">.</span><span class="n">Edge</span><span class="p">(</span><span class="n">attributes</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;style&quot;</span><span class="p">:</span> <span class="s2">&quot;dotted&quot;</span><span class="p">})</span>
            <span class="n">edge</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">leaf_one_node</span><span class="p">,</span> <span class="n">offset_node</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">leaf_two</span><span class="p">:</span>
                <span class="n">leaf_two_node</span> <span class="o">=</span> <span class="n">node_mapping</span><span class="p">[</span><span class="n">leaf_two</span><span class="p">]</span>
                <span class="n">edge</span> <span class="o">=</span> <span class="n">uqbar</span><span class="o">.</span><span class="n">graphs</span><span class="o">.</span><span class="n">Edge</span><span class="p">(</span><span class="n">attributes</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;style&quot;</span><span class="p">:</span> <span class="s2">&quot;dotted&quot;</span><span class="p">})</span>
                <span class="n">edge</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">leaf_two_node</span><span class="p">,</span> <span class="n">offset_node</span><span class="p">)</span>

        <span class="n">offsets</span> <span class="o">=</span> <span class="n">MetricAccentKernel</span><span class="o">.</span><span class="n">count_offsets</span><span class="p">(</span>
            <span class="n">_sequence</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depthwise_offset_inventory</span><span class="p">,</span> <span class="n">depth</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">uqbar</span><span class="o">.</span><span class="n">graphs</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;G&quot;</span><span class="p">,</span>
            <span class="n">attributes</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;bgcolor&quot;</span><span class="p">:</span> <span class="s2">&quot;transparent&quot;</span><span class="p">,</span>
                <span class="s2">&quot;fontname&quot;</span><span class="p">:</span> <span class="s2">&quot;Arial&quot;</span><span class="p">,</span>
                <span class="s2">&quot;penwidth&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                <span class="s2">&quot;truecolor&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">edge_attributes</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;penwidth&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span>
            <span class="n">node_attributes</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fontname&quot;</span><span class="p">:</span> <span class="s2">&quot;Arial&quot;</span><span class="p">,</span> <span class="s2">&quot;fontsize&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="s2">&quot;penwidth&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="n">node_mapping</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_node</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">root</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">depth_first</span><span class="p">())</span>
        <span class="n">leaves</span> <span class="o">=</span> <span class="p">[</span><span class="n">_</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">nodes</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="s2">&quot;children&quot;</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
            <span class="n">graphviz_node</span> <span class="o">=</span> <span class="n">uqbar</span><span class="o">.</span><span class="n">graphs</span><span class="o">.</span><span class="n">Node</span><span class="p">()</span>
            <span class="n">graphviz_node</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">preprolated_duration</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">_rhythmtrees</span><span class="o">.</span><span class="n">RhythmTreeContainer</span><span class="p">):</span>
                <span class="n">graphviz_node</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;shape&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;triangle&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">graphviz_node</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;shape&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;box&quot;</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">graphviz_node</span><span class="p">)</span>
            <span class="n">node_mapping</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">graphviz_node</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">uqbar</span><span class="o">.</span><span class="n">graphs</span><span class="o">.</span><span class="n">Edge</span><span class="p">()</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span>
                    <span class="n">node_mapping</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">parent</span><span class="p">],</span> <span class="n">node_mapping</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
                <span class="p">)</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="n">leaves</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">start_offset</span>
        <span class="n">offset_subgraph</span> <span class="o">=</span> <span class="n">uqbar</span><span class="o">.</span><span class="n">graphs</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;cluster_offsets&quot;</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;style&quot;</span><span class="p">:</span> <span class="s2">&quot;rounded&quot;</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">offset_subgraph</span><span class="p">)</span>
        <span class="n">make_offset_node</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">leaves</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">one</span><span class="p">,</span> <span class="n">two</span> <span class="ow">in</span> <span class="n">_sequence</span><span class="o">.</span><span class="n">nwise</span><span class="p">(</span><span class="n">leaves</span><span class="p">):</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">stop_offset</span>
            <span class="n">make_offset_node</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">one</span><span class="p">,</span> <span class="n">two</span><span class="p">)</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="n">leaves</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">stop_offset</span>
        <span class="n">make_offset_node</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">leaves</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">is_last</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">graph</span></div>

<div class="viewcode-block" id="Meter.__hash__"><a class="viewcode-back" href="../../api/abjad/meter.html#abjad.meter.Meter.__hash__">[docs]</a>    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hashes meter.</span>

<span class="sd">        Returns integer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__hash__</span><span class="p">()</span></div>

<div class="viewcode-block" id="Meter.__iter__"><a class="viewcode-back" href="../../api/abjad/meter.html#abjad.meter.Meter.__iter__">[docs]</a>    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterates meter.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Iterates ``5/4``:</span>


<span class="sd">                &gt;&gt;&gt; meter = abjad.Meter((5, 4))</span>
<span class="sd">                &gt;&gt;&gt; for pair in meter:</span>
<span class="sd">                ...    pair</span>
<span class="sd">                ...</span>
<span class="sd">                (NonreducedFraction(0, 4), NonreducedFraction(1, 4))</span>
<span class="sd">                (NonreducedFraction(1, 4), NonreducedFraction(2, 4))</span>
<span class="sd">                (NonreducedFraction(2, 4), NonreducedFraction(3, 4))</span>
<span class="sd">                (NonreducedFraction(0, 4), NonreducedFraction(3, 4))</span>
<span class="sd">                (NonreducedFraction(3, 4), NonreducedFraction(4, 4))</span>
<span class="sd">                (NonreducedFraction(4, 4), NonreducedFraction(5, 4))</span>
<span class="sd">                (NonreducedFraction(3, 4), NonreducedFraction(5, 4))</span>
<span class="sd">                (NonreducedFraction(0, 4), NonreducedFraction(5, 4))</span>

<span class="sd">        Yields pairs.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">recurse</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">_rhythmtrees</span><span class="o">.</span><span class="n">RhythmTreeLeaf</span><span class="p">):</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">recurse</span><span class="p">(</span><span class="n">child</span><span class="p">))</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">recurse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_node</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
            <span class="n">start_offset</span> <span class="o">=</span> <span class="n">_duration</span><span class="o">.</span><span class="n">NonreducedFraction</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">start_offset</span><span class="p">)</span>
            <span class="n">start_offset</span> <span class="o">=</span> <span class="n">start_offset</span><span class="o">.</span><span class="n">with_denominator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">)</span>
            <span class="n">stop_offset</span> <span class="o">=</span> <span class="n">_duration</span><span class="o">.</span><span class="n">NonreducedFraction</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">stop_offset</span><span class="p">)</span>
            <span class="n">stop_offset</span> <span class="o">=</span> <span class="n">stop_offset</span><span class="o">.</span><span class="n">with_denominator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">start_offset</span><span class="p">,</span> <span class="n">stop_offset</span></div>

<div class="viewcode-block" id="Meter.__repr__"><a class="viewcode-back" href="../../api/abjad/meter.html#abjad.meter.Meter.__repr__">[docs]</a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets repr.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">rtm_format</span><span class="si">!r}</span><span class="s2">)&quot;</span></div>

    <span class="c1">### PUBLIC PROPERTIES ###</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">denominator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets denominator of meter.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; meter = abjad.Meter((7, 4))</span>
<span class="sd">            &gt;&gt;&gt; meter.denominator</span>
<span class="sd">            4</span>

<span class="sd">        Returns positive integer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_denominator</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">depthwise_offset_inventory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets depthwise offset inventory of meter.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; meter = abjad.Meter((7, 4))</span>
<span class="sd">            &gt;&gt;&gt; for depth, offsets in enumerate(</span>
<span class="sd">            ...     meter.depthwise_offset_inventory):</span>
<span class="sd">            ...     print(depth, offsets)</span>
<span class="sd">            0 (Offset((0, 1)), Offset((7, 4)))</span>
<span class="sd">            1 (Offset((0, 1)), Offset((3, 4)), Offset((5, 4)), Offset((7, 4)))</span>
<span class="sd">            2 (Offset((0, 1)), Offset((1, 4)), Offset((1, 2)), Offset((3, 4)), Offset((1, 1)), Offset((5, 4)), Offset((3, 2)), Offset((7, 4)))</span>

<span class="sd">        Returns dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">inventory</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">all_offsets</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">all_offsets</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">_duration</span><span class="o">.</span><span class="n">Offset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">numerator</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">depth</span><span class="p">,</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_node</span><span class="o">.</span><span class="n">_depthwise_inventory</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
                <span class="n">all_offsets</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">_duration</span><span class="o">.</span><span class="n">Offset</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">start_offset</span><span class="p">))</span>
            <span class="n">inventory</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">all_offsets</span><span class="p">)))</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">inventory</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">duration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets duration of meter.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; meter = abjad.Meter((7, 4))</span>
<span class="sd">            &gt;&gt;&gt; meter.duration</span>
<span class="sd">            Duration(7, 4)</span>

<span class="sd">        Returns duration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_duration</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">numerator</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fraction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets nonreduced fraction.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_duration</span><span class="o">.</span><span class="n">NonreducedFraction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pair</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">implied_time_signature</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets implied time signature of meter.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; abjad.Meter((4, 4)).implied_time_signature</span>
<span class="sd">            TimeSignature(pair=(4, 4), hide=False, partial=None)</span>

<span class="sd">        Returns time signature.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_indicators</span><span class="o">.</span><span class="n">TimeSignature</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_node</span><span class="o">.</span><span class="n">preprolated_duration</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">increase_monotonic</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Is true when meter divides large primes into collections of ``2``</span>
<span class="sd">        and ``3`` that increase monotonically.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            An asymmetric meter with beats arranged greatest to least:</span>

<span class="sd">            &gt;&gt;&gt; meter = abjad.Meter(</span>
<span class="sd">            ...     (7, 4),</span>
<span class="sd">            ...     increase_monotonic=False,</span>
<span class="sd">            ...     )</span>

<span class="sd">            &gt;&gt;&gt; meter.increase_monotonic</span>
<span class="sd">            False</span>

<span class="sd">            &gt;&gt;&gt; print(meter.pretty_rtm_format)</span>
<span class="sd">            (7/4 (</span>
<span class="sd">                (3/4 (</span>
<span class="sd">                    1/4</span>
<span class="sd">                    1/4</span>
<span class="sd">                    1/4))</span>
<span class="sd">                (2/4 (</span>
<span class="sd">                    1/4</span>
<span class="sd">                    1/4))</span>
<span class="sd">                (2/4 (</span>
<span class="sd">                    1/4</span>
<span class="sd">                    1/4))))</span>

<span class="sd">            This is default beahvior.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            The same asymmetric meter with unequal beats arranged least to</span>
<span class="sd">            greatest:</span>

<span class="sd">            &gt;&gt;&gt; meter = abjad.Meter(</span>
<span class="sd">            ...     (7, 4),</span>
<span class="sd">            ...     increase_monotonic=True</span>
<span class="sd">            ...     )</span>

<span class="sd">            &gt;&gt;&gt; meter.increase_monotonic</span>
<span class="sd">            True</span>

<span class="sd">            &gt;&gt;&gt; print(meter.pretty_rtm_format)</span>
<span class="sd">            (7/4 (</span>
<span class="sd">                (2/4 (</span>
<span class="sd">                    1/4</span>
<span class="sd">                    1/4))</span>
<span class="sd">                (2/4 (</span>
<span class="sd">                    1/4</span>
<span class="sd">                    1/4))</span>
<span class="sd">                (3/4 (</span>
<span class="sd">                    1/4</span>
<span class="sd">                    1/4</span>
<span class="sd">                    1/4))))</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_increase_monotonic</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_compound</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Is true when meter is compound.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Compound meters written over ``4``:</span>

<span class="sd">            &gt;&gt;&gt; for numerator in range(1, 13):</span>
<span class="sd">            ...     meter = abjad.Meter((numerator, 4))</span>
<span class="sd">            ...     string = True if meter.is_compound else &#39;&#39;</span>
<span class="sd">            ...     print(str(meter.fraction), string)</span>
<span class="sd">            ...</span>
<span class="sd">            1/4</span>
<span class="sd">            2/4</span>
<span class="sd">            3/4</span>
<span class="sd">            4/4</span>
<span class="sd">            5/4</span>
<span class="sd">            6/4     True</span>
<span class="sd">            7/4</span>
<span class="sd">            8/4</span>
<span class="sd">            9/4     True</span>
<span class="sd">            10/4</span>
<span class="sd">            11/4</span>
<span class="sd">            12/4    True</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Compound meters written over ``8``:</span>

<span class="sd">            &gt;&gt;&gt; for numerator in range(1, 13):</span>
<span class="sd">            ...     meter = abjad.Meter((numerator, 8))</span>
<span class="sd">            ...     string = True if meter.is_compound else &#39;&#39;</span>
<span class="sd">            ...     print(str(meter.fraction), string)</span>
<span class="sd">            ...</span>
<span class="sd">            1/8</span>
<span class="sd">            2/8</span>
<span class="sd">            3/8</span>
<span class="sd">            4/8</span>
<span class="sd">            5/8</span>
<span class="sd">            6/8     True</span>
<span class="sd">            7/8</span>
<span class="sd">            8/8</span>
<span class="sd">            9/8     True</span>
<span class="sd">            10/8</span>
<span class="sd">            11/8</span>
<span class="sd">            12/8    True</span>

<span class="sd">        Compound meters defined equal to those meters with a numerator divisible by ``3``</span>
<span class="sd">        (but not equal to ``3``).</span>

<span class="sd">        Returns true or false.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="mi">3</span> <span class="ow">in</span> <span class="n">_math</span><span class="o">.</span><span class="n">divisors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">numerator</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">numerator</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_simple</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Is true when meter is simple.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Simple meters written over ``4``:</span>

<span class="sd">            &gt;&gt;&gt; for numerator in range(1, 13):</span>
<span class="sd">            ...     meter = abjad.Meter((numerator, 4))</span>
<span class="sd">            ...     string = True if meter.is_simple else &#39;&#39;</span>
<span class="sd">            ...     print(str(meter.fraction), string)</span>
<span class="sd">            ...</span>
<span class="sd">            1/4     True</span>
<span class="sd">            2/4     True</span>
<span class="sd">            3/4     True</span>
<span class="sd">            4/4     True</span>
<span class="sd">            5/4     True</span>
<span class="sd">            6/4</span>
<span class="sd">            7/4     True</span>
<span class="sd">            8/4     True</span>
<span class="sd">            9/4</span>
<span class="sd">            10/4    True</span>
<span class="sd">            11/4    True</span>
<span class="sd">            12/4</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Simple meters written over ``8``:</span>

<span class="sd">            &gt;&gt;&gt; for numerator in range(1, 13):</span>
<span class="sd">            ...     meter = abjad.Meter((numerator, 8))</span>
<span class="sd">            ...     string = True if meter.is_simple else &#39;&#39;</span>
<span class="sd">            ...     print(str(meter.fraction), string)</span>
<span class="sd">            ...</span>
<span class="sd">            1/8     True</span>
<span class="sd">            2/8     True</span>
<span class="sd">            3/8     True</span>
<span class="sd">            4/8     True</span>
<span class="sd">            5/8     True</span>
<span class="sd">            6/8</span>
<span class="sd">            7/8     True</span>
<span class="sd">            8/8     True</span>
<span class="sd">            9/8</span>
<span class="sd">            10/8    True</span>
<span class="sd">            11/8    True</span>
<span class="sd">            12/8</span>

<span class="sd">        Simple meters defined equal to those meters with a numerator not divisible by</span>
<span class="sd">        ``3``.</span>

<span class="sd">        Meters with numerator equal to ``3`` are also defined as simple.</span>

<span class="sd">        Returns true or false.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_compound</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">numerator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets numerator of meter.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; meter = abjad.Meter((7, 4))</span>
<span class="sd">            &gt;&gt;&gt; meter.numerator</span>
<span class="sd">            7</span>

<span class="sd">        Returns positive integer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_numerator</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">pair</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets pair of numerator and denominator of meter.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; meter = abjad.Meter((6, 4))</span>
<span class="sd">            &gt;&gt;&gt; meter.pair</span>
<span class="sd">            (6, 4)</span>

<span class="sd">        Returns pair.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">numerator</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">preferred_boundary_depth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets preferred boundary depth of meter.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            No preferred boundary depth:</span>

<span class="sd">            &gt;&gt;&gt; abjad.Meter((6, 8)).preferred_boundary_depth is None</span>
<span class="sd">            True</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Customized preferred boundary depth:</span>

<span class="sd">            &gt;&gt;&gt; meter = abjad.Meter(</span>
<span class="sd">            ...     (6, 8),</span>
<span class="sd">            ...     preferred_boundary_depth=1,</span>
<span class="sd">            ...     )</span>
<span class="sd">            &gt;&gt;&gt; meter.preferred_boundary_depth</span>
<span class="sd">            1</span>

<span class="sd">        Used by ``abjad.Meter.rewrite_meter()``.</span>

<span class="sd">        Defaults to none.</span>

<span class="sd">        Set to integer or none.</span>

<span class="sd">        Returns integer or none.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preferred_boundary_depth</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">pretty_rtm_format</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets pretty RTM format of meter.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; meter = abjad.Meter((7, 4))</span>
<span class="sd">            &gt;&gt;&gt; print(meter.pretty_rtm_format)</span>
<span class="sd">            (7/4 (</span>
<span class="sd">                (3/4 (</span>
<span class="sd">                    1/4</span>
<span class="sd">                    1/4</span>
<span class="sd">                    1/4))</span>
<span class="sd">                (2/4 (</span>
<span class="sd">                    1/4</span>
<span class="sd">                    1/4))</span>
<span class="sd">                (2/4 (</span>
<span class="sd">                    1/4</span>
<span class="sd">                    1/4))))</span>

<span class="sd">        Returns string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_node</span><span class="o">.</span><span class="n">pretty_rtm_format</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">root_node</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets root node of meter.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; meter = abjad.Meter((7, 4))</span>
<span class="sd">            &gt;&gt;&gt; for _ in meter.root_node: _</span>
<span class="sd">            RhythmTreeContainer((3, 4))</span>
<span class="sd">            RhythmTreeContainer((2, 4))</span>
<span class="sd">            RhythmTreeContainer((2, 4))</span>

<span class="sd">        Returns rhythm tree node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_node</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">rtm_format</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets RTM format of meter.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; meter = abjad.Meter((7, 4))</span>
<span class="sd">            &gt;&gt;&gt; meter.rtm_format</span>
<span class="sd">            &#39;(7/4 ((3/4 (1/4 1/4 1/4)) (2/4 (1/4 1/4)) (2/4 (1/4 1/4))))&#39;</span>

<span class="sd">        Returns string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_node</span><span class="o">.</span><span class="n">rtm_format</span>

    <span class="c1">### PUBLIC METHODS ###</span>

<div class="viewcode-block" id="Meter.fit_meters"><a class="viewcode-back" href="../../api/abjad/meter.html#abjad.meter.Meter.fit_meters">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">fit_meters</span><span class="p">(</span>
        <span class="n">argument</span><span class="p">,</span>
        <span class="n">meters</span><span class="p">,</span>
        <span class="n">denominator</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>
        <span class="n">discard_final_orphan_downbeat</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">maximum_run_length</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">starting_offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finds the best-matching sequence of meters for the offsets contained in</span>
<span class="sd">        ``argument``.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; meters = [(3, 4), (4, 4), (5, 4)]</span>
<span class="sd">            &gt;&gt;&gt; meters = [abjad.Meter(_) for _ in meters]</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Matches a series of hypothetical ``4/4`` measures:</span>

<span class="sd">            &gt;&gt;&gt; argument = [(0, 4), (4, 4), (8, 4), (12, 4), (16, 4)]</span>
<span class="sd">            &gt;&gt;&gt; for meter in abjad.Meter.fit_meters(argument, meters):</span>
<span class="sd">            ...     print(meter.implied_time_signature)</span>
<span class="sd">            ...</span>
<span class="sd">            TimeSignature(pair=(4, 4), hide=False, partial=None)</span>
<span class="sd">            TimeSignature(pair=(4, 4), hide=False, partial=None)</span>
<span class="sd">            TimeSignature(pair=(4, 4), hide=False, partial=None)</span>
<span class="sd">            TimeSignature(pair=(4, 4), hide=False, partial=None)</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Matches a series of hypothetical ``5/4`` measures:</span>

<span class="sd">            &gt;&gt;&gt; argument = [(0, 4), (3, 4), (5, 4), (10, 4), (15, 4), (20, 4)]</span>
<span class="sd">            &gt;&gt;&gt; for meter in abjad.Meter.fit_meters(argument, meters):</span>
<span class="sd">            ...     print(meter.implied_time_signature)</span>
<span class="sd">            ...</span>
<span class="sd">            TimeSignature(pair=(3, 4), hide=False, partial=None)</span>
<span class="sd">            TimeSignature(pair=(4, 4), hide=False, partial=None)</span>
<span class="sd">            TimeSignature(pair=(3, 4), hide=False, partial=None)</span>
<span class="sd">            TimeSignature(pair=(5, 4), hide=False, partial=None)</span>
<span class="sd">            TimeSignature(pair=(5, 4), hide=False, partial=None)</span>

<span class="sd">        Coerces offsets from ``argument`` via ``MetricAccentKernel.count_offsets()``.</span>

<span class="sd">        Returns list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">session</span> <span class="o">=</span> <span class="n">_MeterFittingSession</span><span class="p">(</span>
            <span class="n">kernel_denominator</span><span class="o">=</span><span class="n">denominator</span><span class="p">,</span>
            <span class="n">maximum_run_length</span><span class="o">=</span><span class="n">maximum_run_length</span><span class="p">,</span>
            <span class="n">meters</span><span class="o">=</span><span class="n">meters</span><span class="p">,</span>
            <span class="n">offset_counter</span><span class="o">=</span><span class="n">argument</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">meters</span> <span class="o">=</span> <span class="n">session</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">meters</span></div>

<div class="viewcode-block" id="Meter.generate_offset_kernel_to_denominator"><a class="viewcode-back" href="../../api/abjad/meter.html#abjad.meter.Meter.generate_offset_kernel_to_denominator">[docs]</a>    <span class="k">def</span> <span class="nf">generate_offset_kernel_to_denominator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">denominator</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a dictionary of all offsets in a meter up to ``denominator``.</span>

<span class="sd">        Keys are the offsets and the values are the normalized weights of those offsets.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; meter = abjad.Meter((4, 4))</span>
<span class="sd">            &gt;&gt;&gt; kernel = meter.generate_offset_kernel_to_denominator(8)</span>
<span class="sd">            &gt;&gt;&gt; for offset, weight in sorted(kernel.kernel.items()):</span>
<span class="sd">            ...     print(f&quot;{offset!s}\t{weight!s}&quot;)</span>
<span class="sd">            ...</span>
<span class="sd">            0       3/16</span>
<span class="sd">            1/8     1/16</span>
<span class="sd">            1/4     1/8</span>
<span class="sd">            3/8     1/16</span>
<span class="sd">            1/2     1/8</span>
<span class="sd">            5/8     1/16</span>
<span class="sd">            3/4     1/8</span>
<span class="sd">            7/8     1/16</span>
<span class="sd">            1       3/16</span>

<span class="sd">        This is useful for testing how strongly a collection of offsets responds to a</span>
<span class="sd">        given meter.</span>

<span class="sd">        Returns dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">_math</span><span class="o">.</span><span class="n">is_positive_integer_power_of_two</span><span class="p">(</span><span class="n">denominator</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">)</span>
        <span class="n">inventory</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depthwise_offset_inventory</span><span class="p">)</span>
        <span class="n">old_flag_count</span> <span class="o">=</span> <span class="n">_duration</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">)</span><span class="o">.</span><span class="n">flag_count</span>
        <span class="n">new_flag_count</span> <span class="o">=</span> <span class="n">_duration</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">denominator</span><span class="p">)</span><span class="o">.</span><span class="n">flag_count</span>
        <span class="n">extra_depth</span> <span class="o">=</span> <span class="n">new_flag_count</span> <span class="o">-</span> <span class="n">old_flag_count</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">extra_depth</span><span class="p">):</span>
            <span class="n">old_offsets</span> <span class="o">=</span> <span class="n">inventory</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">new_offsets</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">first</span><span class="p">,</span> <span class="n">second</span> <span class="ow">in</span> <span class="n">_sequence</span><span class="o">.</span><span class="n">nwise</span><span class="p">(</span><span class="n">old_offsets</span><span class="p">):</span>
                <span class="n">new_offsets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">first</span><span class="p">)</span>
                <span class="n">new_offsets</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">first</span> <span class="o">+</span> <span class="n">second</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">new_offsets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">old_offsets</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">inventory</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">new_offsets</span><span class="p">))</span>
        <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">kernel</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">offsets</span> <span class="ow">in</span> <span class="n">inventory</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">offset</span> <span class="ow">in</span> <span class="n">offsets</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">offset</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kernel</span><span class="p">:</span>
                    <span class="n">kernel</span><span class="p">[</span><span class="n">offset</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">kernel</span><span class="p">[</span><span class="n">offset</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">total</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">offset</span><span class="p">,</span> <span class="n">response</span> <span class="ow">in</span> <span class="n">kernel</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">kernel</span><span class="p">[</span><span class="n">offset</span><span class="p">]</span> <span class="o">=</span> <span class="n">_duration</span><span class="o">.</span><span class="n">Multiplier</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">total</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">MetricAccentKernel</span><span class="p">(</span><span class="n">kernel</span><span class="p">)</span></div>

<div class="viewcode-block" id="Meter.rewrite_meter"><a class="viewcode-back" href="../../api/abjad/meter.html#abjad.meter.Meter.rewrite_meter">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">rewrite_meter</span><span class="p">(</span>
        <span class="n">components</span><span class="p">,</span>
        <span class="n">meter</span><span class="p">,</span>
        <span class="n">boundary_depth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">initial_offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">maximum_dot_count</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">rewrite_tuplets</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rewrites the contents of logical ties in an expression to match ``meter``.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Rewrites the contents of a measure in a staff using the default meter for</span>
<span class="sd">            that measure&#39;s time signature:</span>

<span class="sd">            &gt;&gt;&gt; lily_string = &quot;| 2/4 c&#39;2 ~ |&quot;</span>
<span class="sd">            &gt;&gt;&gt; lily_string += &quot;| 4/4 c&#39;32 d&#39;2.. ~ d&#39;16 e&#39;32 ~ |&quot;</span>
<span class="sd">            &gt;&gt;&gt; lily_string += &quot;| 2/4 e&#39;2 |&quot;</span>
<span class="sd">            &gt;&gt;&gt; container = abjad.parsers.reduced.parse_reduced_ly_syntax(lily_string)</span>
<span class="sd">            &gt;&gt;&gt; staff = abjad.Staff()</span>
<span class="sd">            &gt;&gt;&gt; staff[:] = container</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(staff) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                {</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 2/4</span>
<span class="sd">                        c&#39;2</span>
<span class="sd">                        ~</span>
<span class="sd">                    }</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 4/4</span>
<span class="sd">                        c&#39;32</span>
<span class="sd">                        d&#39;2..</span>
<span class="sd">                        ~</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        e&#39;32</span>
<span class="sd">                        ~</span>
<span class="sd">                    }</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 2/4</span>
<span class="sd">                        e&#39;2</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">            &gt;&gt;&gt; meter = abjad.Meter((4, 4))</span>
<span class="sd">            &gt;&gt;&gt; print(meter.pretty_rtm_format)</span>
<span class="sd">            (4/4 (</span>
<span class="sd">                1/4</span>
<span class="sd">                1/4</span>
<span class="sd">                1/4</span>
<span class="sd">                1/4))</span>

<span class="sd">            &gt;&gt;&gt; abjad.Meter.rewrite_meter(staff[1][:], meter)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(staff) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                {</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 2/4</span>
<span class="sd">                        c&#39;2</span>
<span class="sd">                        ~</span>
<span class="sd">                    }</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 4/4</span>
<span class="sd">                        c&#39;32</span>
<span class="sd">                        d&#39;8..</span>
<span class="sd">                        ~</span>
<span class="sd">                        d&#39;2</span>
<span class="sd">                        ~</span>
<span class="sd">                        d&#39;8..</span>
<span class="sd">                        e&#39;32</span>
<span class="sd">                        ~</span>
<span class="sd">                    }</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 2/4</span>
<span class="sd">                        e&#39;2</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Rewrites the contents of a measure in a staff using a custom meter:</span>

<span class="sd">            &gt;&gt;&gt; container = abjad.parsers.reduced.parse_reduced_ly_syntax(lily_string)</span>
<span class="sd">            &gt;&gt;&gt; staff = abjad.Staff()</span>
<span class="sd">            &gt;&gt;&gt; staff[:] = container</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(staff) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                {</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 2/4</span>
<span class="sd">                        c&#39;2</span>
<span class="sd">                        ~</span>
<span class="sd">                    }</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 4/4</span>
<span class="sd">                        c&#39;32</span>
<span class="sd">                        d&#39;2..</span>
<span class="sd">                        ~</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        e&#39;32</span>
<span class="sd">                        ~</span>
<span class="sd">                    }</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 2/4</span>
<span class="sd">                        e&#39;2</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">            &gt;&gt;&gt; rtm = &#39;(4/4 ((2/4 (1/4 1/4)) (2/4 (1/4 1/4))))&#39;</span>
<span class="sd">            &gt;&gt;&gt; meter = abjad.Meter(rtm)</span>
<span class="sd">            &gt;&gt;&gt; print(meter.pretty_rtm_format) # doctest: +SKIP</span>
<span class="sd">            (4/4 (</span>
<span class="sd">                (2/4 (</span>
<span class="sd">                    1/4</span>
<span class="sd">                    1/4))</span>
<span class="sd">                (2/4 (</span>
<span class="sd">                    1/4</span>
<span class="sd">                    1/4))))</span>

<span class="sd">            &gt;&gt;&gt; abjad.Meter.rewrite_meter(staff[1][:], meter)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(staff) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                {</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 2/4</span>
<span class="sd">                        c&#39;2</span>
<span class="sd">                        ~</span>
<span class="sd">                    }</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 4/4</span>
<span class="sd">                        c&#39;32</span>
<span class="sd">                        d&#39;4...</span>
<span class="sd">                        ~</span>
<span class="sd">                        d&#39;4...</span>
<span class="sd">                        e&#39;32</span>
<span class="sd">                        ~</span>
<span class="sd">                    }</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 2/4</span>
<span class="sd">                        e&#39;2</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Limit the maximum number of dots per leaf using ``maximum_dot_count``:</span>

<span class="sd">            &gt;&gt;&gt; lily_string = &quot;| 3/4 c&#39;32 d&#39;8 e&#39;8 fs&#39;4... |&quot;</span>
<span class="sd">            &gt;&gt;&gt; container = abjad.parsers.reduced.parse_reduced_ly_syntax(lily_string)</span>
<span class="sd">            &gt;&gt;&gt; staff = abjad.Staff()</span>
<span class="sd">            &gt;&gt;&gt; staff.append(container)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(staff) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                {</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 3/4</span>
<span class="sd">                        c&#39;32</span>
<span class="sd">                        d&#39;8</span>
<span class="sd">                        e&#39;8</span>
<span class="sd">                        fs&#39;4...</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">            Without constraining the ``maximum_dot_count``:</span>

<span class="sd">            &gt;&gt;&gt; measure = staff[0]</span>
<span class="sd">            &gt;&gt;&gt; time_signature = abjad.get.indicator(</span>
<span class="sd">            ...     measure[0],</span>
<span class="sd">            ...     abjad.TimeSignature</span>
<span class="sd">            ...     )</span>
<span class="sd">            &gt;&gt;&gt; abjad.Meter.rewrite_meter(measure[:], time_signature)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(staff) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                {</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 3/4</span>
<span class="sd">                        c&#39;32</span>
<span class="sd">                        d&#39;16.</span>
<span class="sd">                        ~</span>
<span class="sd">                        d&#39;32</span>
<span class="sd">                        e&#39;16.</span>
<span class="sd">                        ~</span>
<span class="sd">                        e&#39;32</span>
<span class="sd">                        fs&#39;4...</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">            Constraining the ``maximum_dot_count`` to ``2``:</span>

<span class="sd">            &gt;&gt;&gt; lily_string = &quot;| 3/4 c&#39;32 d&#39;8 e&#39;8 fs&#39;4... |&quot;</span>
<span class="sd">            &gt;&gt;&gt; container = abjad.parsers.reduced.parse_reduced_ly_syntax(lily_string)</span>
<span class="sd">            &gt;&gt;&gt; staff = abjad.Staff()</span>
<span class="sd">            &gt;&gt;&gt; staff.append(container)</span>
<span class="sd">            &gt;&gt;&gt; measure = staff[0]</span>
<span class="sd">            &gt;&gt;&gt; time_signature = abjad.get.indicator(</span>
<span class="sd">            ...     measure[0],</span>
<span class="sd">            ...     abjad.TimeSignature</span>
<span class="sd">            ...     )</span>
<span class="sd">            &gt;&gt;&gt; abjad.Meter.rewrite_meter(</span>
<span class="sd">            ...     measure[:],</span>
<span class="sd">            ...     time_signature,</span>
<span class="sd">            ...     maximum_dot_count=2,</span>
<span class="sd">            ...     )</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(staff) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                {</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 3/4</span>
<span class="sd">                        c&#39;32</span>
<span class="sd">                        d&#39;16.</span>
<span class="sd">                        ~</span>
<span class="sd">                        d&#39;32</span>
<span class="sd">                        e&#39;16.</span>
<span class="sd">                        ~</span>
<span class="sd">                        e&#39;32</span>
<span class="sd">                        fs&#39;8..</span>
<span class="sd">                        ~</span>
<span class="sd">                        fs&#39;4</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">            Constraining the ``maximum_dot_count`` to ``1``:</span>

<span class="sd">            &gt;&gt;&gt; lily_string = &quot;| 3/4 c&#39;32 d&#39;8 e&#39;8 fs&#39;4... |&quot;</span>
<span class="sd">            &gt;&gt;&gt; container = abjad.parsers.reduced.parse_reduced_ly_syntax(lily_string)</span>
<span class="sd">            &gt;&gt;&gt; staff = abjad.Staff()</span>
<span class="sd">            &gt;&gt;&gt; staff.append(container)</span>
<span class="sd">            &gt;&gt;&gt; measure = staff[0]</span>
<span class="sd">            &gt;&gt;&gt; time_signature = abjad.get.indicator(</span>
<span class="sd">            ...     measure[0],</span>
<span class="sd">            ...     abjad.TimeSignature</span>
<span class="sd">            ...     )</span>
<span class="sd">            &gt;&gt;&gt; abjad.Meter.rewrite_meter(</span>
<span class="sd">            ...     measure[:],</span>
<span class="sd">            ...     time_signature,</span>
<span class="sd">            ...     maximum_dot_count=1,</span>
<span class="sd">            ...     )</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(staff) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                {</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 3/4</span>
<span class="sd">                        c&#39;32</span>
<span class="sd">                        d&#39;16.</span>
<span class="sd">                        ~</span>
<span class="sd">                        d&#39;32</span>
<span class="sd">                        e&#39;16.</span>
<span class="sd">                        ~</span>
<span class="sd">                        e&#39;32</span>
<span class="sd">                        fs&#39;16.</span>
<span class="sd">                        ~</span>
<span class="sd">                        fs&#39;8</span>
<span class="sd">                        ~</span>
<span class="sd">                        fs&#39;4</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">            Constraining the ``maximum_dot_count`` to ``0``:</span>

<span class="sd">            &gt;&gt;&gt; lily_string = &quot;| 3/4 c&#39;32 d&#39;8 e&#39;8 fs&#39;4... |&quot;</span>
<span class="sd">            &gt;&gt;&gt; container = abjad.parsers.reduced.parse_reduced_ly_syntax(lily_string)</span>
<span class="sd">            &gt;&gt;&gt; staff = abjad.Staff()</span>
<span class="sd">            &gt;&gt;&gt; staff.append(container)</span>
<span class="sd">            &gt;&gt;&gt; measure = staff[0]</span>
<span class="sd">            &gt;&gt;&gt; time_signature = abjad.get.indicator(</span>
<span class="sd">            ...     measure[0],</span>
<span class="sd">            ...     abjad.TimeSignature</span>
<span class="sd">            ...     )</span>
<span class="sd">            &gt;&gt;&gt; abjad.Meter.rewrite_meter(</span>
<span class="sd">            ...     measure[:],</span>
<span class="sd">            ...     time_signature,</span>
<span class="sd">            ...     maximum_dot_count=0,</span>
<span class="sd">            ...     )</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(staff) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                {</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 3/4</span>
<span class="sd">                        c&#39;32</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        ~</span>
<span class="sd">                        d&#39;32</span>
<span class="sd">                        ~</span>
<span class="sd">                        d&#39;32</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        ~</span>
<span class="sd">                        e&#39;32</span>
<span class="sd">                        ~</span>
<span class="sd">                        e&#39;32</span>
<span class="sd">                        fs&#39;16</span>
<span class="sd">                        ~</span>
<span class="sd">                        fs&#39;32</span>
<span class="sd">                        ~</span>
<span class="sd">                        fs&#39;8</span>
<span class="sd">                        ~</span>
<span class="sd">                        fs&#39;4</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Split logical ties at different depths of the ``Meter``, if those logical</span>
<span class="sd">            ties cross any offsets at that depth, but do not also both begin and end at</span>
<span class="sd">            any of those offsets.</span>

<span class="sd">            Consider the default meter for ``9/8``:</span>

<span class="sd">            &gt;&gt;&gt; meter = abjad.Meter((9, 8))</span>
<span class="sd">            &gt;&gt;&gt; print(meter.pretty_rtm_format)</span>
<span class="sd">            (9/8 (</span>
<span class="sd">                (3/8 (</span>
<span class="sd">                    1/8</span>
<span class="sd">                    1/8</span>
<span class="sd">                    1/8))</span>
<span class="sd">                (3/8 (</span>
<span class="sd">                    1/8</span>
<span class="sd">                    1/8</span>
<span class="sd">                    1/8))</span>
<span class="sd">                (3/8 (</span>
<span class="sd">                    1/8</span>
<span class="sd">                    1/8</span>
<span class="sd">                    1/8))))</span>

<span class="sd">            We can establish that meter without specifying a ``boundary_depth``:</span>

<span class="sd">            &gt;&gt;&gt; lily_string = &quot;| 9/8 c&#39;2 d&#39;2 e&#39;8 |&quot;</span>
<span class="sd">            &gt;&gt;&gt; container = abjad.parsers.reduced.parse_reduced_ly_syntax(lily_string)</span>
<span class="sd">            &gt;&gt;&gt; staff = abjad.Staff()</span>
<span class="sd">            &gt;&gt;&gt; staff.append(container)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(staff) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                {</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 9/8</span>
<span class="sd">                        c&#39;2</span>
<span class="sd">                        d&#39;2</span>
<span class="sd">                        e&#39;8</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">            &gt;&gt;&gt; measure = staff[0]</span>
<span class="sd">            &gt;&gt;&gt; time_signature = abjad.get.indicator(</span>
<span class="sd">            ...     measure[0],</span>
<span class="sd">            ...     abjad.TimeSignature</span>
<span class="sd">            ...     )</span>
<span class="sd">            &gt;&gt;&gt; abjad.Meter.rewrite_meter(measure[:], time_signature)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(staff) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                {</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 9/8</span>
<span class="sd">                        c&#39;2</span>
<span class="sd">                        d&#39;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        d&#39;4</span>
<span class="sd">                        e&#39;8</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">            With a ``boundary_depth`` of ``1`` logical ties which cross any offsets</span>
<span class="sd">            created by nodes with a depth of ``1`` in this Meter&#39;s rhythm tree - i.e.</span>
<span class="sd">            ``0/8`` ``3/8`` ``6/8`` and ``9/8`` - which do not also begin and end at any</span>
<span class="sd">            of those offsets, will be split:</span>

<span class="sd">            &gt;&gt;&gt; lily_string = &quot;| 9/8 c&#39;2 d&#39;2 e&#39;8 |&quot;</span>
<span class="sd">            &gt;&gt;&gt; container = abjad.parsers.reduced.parse_reduced_ly_syntax(lily_string)</span>
<span class="sd">            &gt;&gt;&gt; staff = abjad.Staff()</span>
<span class="sd">            &gt;&gt;&gt; staff.append(container)</span>
<span class="sd">            &gt;&gt;&gt; measure = staff[0]</span>
<span class="sd">            &gt;&gt;&gt; time_signature = abjad.get.indicator(</span>
<span class="sd">            ...     measure[0],</span>
<span class="sd">            ...     abjad.TimeSignature</span>
<span class="sd">            ...     )</span>
<span class="sd">            &gt;&gt;&gt; abjad.Meter.rewrite_meter(</span>
<span class="sd">            ...     measure[:],</span>
<span class="sd">            ...     time_signature,</span>
<span class="sd">            ...     boundary_depth=1,</span>
<span class="sd">            ...     )</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(staff) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                {</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 9/8</span>
<span class="sd">                        c&#39;4.</span>
<span class="sd">                        ~</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        d&#39;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        d&#39;4</span>
<span class="sd">                        e&#39;8</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">            For this ``9/8`` meter, and this input notation, A ``boundary_depth`` of</span>
<span class="sd">            ``2`` causes no change, as all logical ties already align to multiples of</span>
<span class="sd">            ``1/8``</span>

<span class="sd">            &gt;&gt;&gt; lily_string = &quot;| 9/8 c&#39;2 d&#39;2 e&#39;8 |&quot;</span>
<span class="sd">            &gt;&gt;&gt; container = abjad.parsers.reduced.parse_reduced_ly_syntax(lily_string)</span>
<span class="sd">            &gt;&gt;&gt; staff = abjad.Staff()</span>
<span class="sd">            &gt;&gt;&gt; staff.append(container)</span>
<span class="sd">            &gt;&gt;&gt; measure = staff[0]</span>
<span class="sd">            &gt;&gt;&gt; time_signature = abjad.get.indicator(</span>
<span class="sd">            ...     measure[0],</span>
<span class="sd">            ...     abjad.TimeSignature</span>
<span class="sd">            ...     )</span>
<span class="sd">            &gt;&gt;&gt; abjad.Meter.rewrite_meter(</span>
<span class="sd">            ...     measure[:],</span>
<span class="sd">            ...     time_signature,</span>
<span class="sd">            ...     boundary_depth=2,</span>
<span class="sd">            ...     )</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(staff) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                {</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 9/8</span>
<span class="sd">                        c&#39;2</span>
<span class="sd">                        d&#39;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        d&#39;4</span>
<span class="sd">                        e&#39;8</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Comparison of ``3/4`` and ``6/8`` at ``boundary_depths`` of 0 and 1:</span>

<span class="sd">            &gt;&gt;&gt; triple = &quot;| 3/4 2 4 || 3/4 4 2 || 3/4 4. 4. |&quot;</span>
<span class="sd">            &gt;&gt;&gt; triple += &quot;| 3/4 2 ~ 8 8 || 3/4 8 8 ~ 2 |&quot;</span>
<span class="sd">            &gt;&gt;&gt; container = abjad.parsers.reduced.parse_reduced_ly_syntax(triple)</span>
<span class="sd">            &gt;&gt;&gt; staff_1 = abjad.Staff()</span>
<span class="sd">            &gt;&gt;&gt; staff_1[:] = container</span>
<span class="sd">            &gt;&gt;&gt; duples = &quot;| 6/8 2 4 || 6/8 4 2 || 6/8 4. 4. |&quot;</span>
<span class="sd">            &gt;&gt;&gt; duples += &quot;| 6/8 2 ~ 8 8 || 6/8 8 8 ~ 2 |&quot;</span>
<span class="sd">            &gt;&gt;&gt; container = abjad.parsers.reduced.parse_reduced_ly_syntax(duples)</span>
<span class="sd">            &gt;&gt;&gt; staff_2 = abjad.Staff()</span>
<span class="sd">            &gt;&gt;&gt; staff_2[:] = container</span>
<span class="sd">            &gt;&gt;&gt; score = abjad.Score([staff_1, staff_2])</span>

<span class="sd">            In order to see the different time signatures on each staff, we need to move</span>
<span class="sd">            some engravers from the Score context to the Staff context:</span>

<span class="sd">            &gt;&gt;&gt; engravers = [</span>
<span class="sd">            ...     &#39;Timing_translator&#39;,</span>
<span class="sd">            ...     &#39;Time_signature_engraver&#39;,</span>
<span class="sd">            ...     &#39;Default_bar_line_engraver&#39;,</span>
<span class="sd">            ...     ]</span>
<span class="sd">            &gt;&gt;&gt; score.remove_commands.extend(engravers)</span>
<span class="sd">            &gt;&gt;&gt; score[0].consists_commands.extend(engravers)</span>
<span class="sd">            &gt;&gt;&gt; score[1].consists_commands.extend(engravers)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(score) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Score</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \remove Timing_translator</span>
<span class="sd">                    \remove Time_signature_engraver</span>
<span class="sd">                    \remove Default_bar_line_engraver</span>
<span class="sd">                }</span>
<span class="sd">                &lt;&lt;</span>
<span class="sd">                    \new Staff</span>
<span class="sd">                    \with</span>
<span class="sd">                    {</span>
<span class="sd">                        \consists Timing_translator</span>
<span class="sd">                        \consists Time_signature_engraver</span>
<span class="sd">                        \consists Default_bar_line_engraver</span>
<span class="sd">                    }</span>
<span class="sd">                    {</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 3/4</span>
<span class="sd">                            c&#39;2</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                        }</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 3/4</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                            c&#39;2</span>
<span class="sd">                        }</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 3/4</span>
<span class="sd">                            c&#39;4.</span>
<span class="sd">                            c&#39;4.</span>
<span class="sd">                        }</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 3/4</span>
<span class="sd">                            c&#39;2</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                        }</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 3/4</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;2</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                    \new Staff</span>
<span class="sd">                    \with</span>
<span class="sd">                    {</span>
<span class="sd">                        \consists Timing_translator</span>
<span class="sd">                        \consists Time_signature_engraver</span>
<span class="sd">                        \consists Default_bar_line_engraver</span>
<span class="sd">                    }</span>
<span class="sd">                    {</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 6/8</span>
<span class="sd">                            c&#39;2</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                        }</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 6/8</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                            c&#39;2</span>
<span class="sd">                        }</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 6/8</span>
<span class="sd">                            c&#39;4.</span>
<span class="sd">                            c&#39;4.</span>
<span class="sd">                        }</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 6/8</span>
<span class="sd">                            c&#39;2</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                        }</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 6/8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;2</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                &gt;&gt;</span>

<span class="sd">            Here we establish a meter without specifying any boundary depth:</span>

<span class="sd">            &gt;&gt;&gt; for staff in score:</span>
<span class="sd">            ...     for container in staff:</span>
<span class="sd">            ...         leaf = abjad.get.leaf(container, 0)</span>
<span class="sd">            ...         time_signature = abjad.get.indicator(</span>
<span class="sd">            ...             leaf,</span>
<span class="sd">            ...             abjad.TimeSignature</span>
<span class="sd">            ...             )</span>
<span class="sd">            ...         abjad.Meter.rewrite_meter(container[:], time_signature)</span>
<span class="sd">            ...</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(score) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Score</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \remove Timing_translator</span>
<span class="sd">                    \remove Time_signature_engraver</span>
<span class="sd">                    \remove Default_bar_line_engraver</span>
<span class="sd">                }</span>
<span class="sd">                &lt;&lt;</span>
<span class="sd">                    \new Staff</span>
<span class="sd">                    \with</span>
<span class="sd">                    {</span>
<span class="sd">                        \consists Timing_translator</span>
<span class="sd">                        \consists Time_signature_engraver</span>
<span class="sd">                        \consists Default_bar_line_engraver</span>
<span class="sd">                    }</span>
<span class="sd">                    {</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 3/4</span>
<span class="sd">                            c&#39;2</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                        }</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 3/4</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                            c&#39;2</span>
<span class="sd">                        }</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 3/4</span>
<span class="sd">                            c&#39;4.</span>
<span class="sd">                            c&#39;4.</span>
<span class="sd">                        }</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 3/4</span>
<span class="sd">                            c&#39;2</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                        }</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 3/4</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;2</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                    \new Staff</span>
<span class="sd">                    \with</span>
<span class="sd">                    {</span>
<span class="sd">                        \consists Timing_translator</span>
<span class="sd">                        \consists Time_signature_engraver</span>
<span class="sd">                        \consists Default_bar_line_engraver</span>
<span class="sd">                    }</span>
<span class="sd">                    {</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 6/8</span>
<span class="sd">                            c&#39;2</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                        }</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 6/8</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                            c&#39;2</span>
<span class="sd">                        }</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 6/8</span>
<span class="sd">                            c&#39;4.</span>
<span class="sd">                            c&#39;4.</span>
<span class="sd">                        }</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 6/8</span>
<span class="sd">                            c&#39;4.</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                        }</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 6/8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;4.</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                &gt;&gt;</span>

<span class="sd">            Here we reestablish meter at a boundary depth of ``1``</span>

<span class="sd">            &gt;&gt;&gt; for staff in score:</span>
<span class="sd">            ...     for container in staff:</span>
<span class="sd">            ...         leaf = abjad.get.leaf(container, 0)</span>
<span class="sd">            ...         time_signature = abjad.get.indicator(</span>
<span class="sd">            ...             leaf,</span>
<span class="sd">            ...             abjad.TimeSignature</span>
<span class="sd">            ...             )</span>
<span class="sd">            ...         abjad.Meter.rewrite_meter(</span>
<span class="sd">            ...             container[:],</span>
<span class="sd">            ...             time_signature,</span>
<span class="sd">            ...             boundary_depth=1,</span>
<span class="sd">            ...             )</span>
<span class="sd">            ...</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(score) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Score</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \remove Timing_translator</span>
<span class="sd">                    \remove Time_signature_engraver</span>
<span class="sd">                    \remove Default_bar_line_engraver</span>
<span class="sd">                }</span>
<span class="sd">                &lt;&lt;</span>
<span class="sd">                    \new Staff</span>
<span class="sd">                    \with</span>
<span class="sd">                    {</span>
<span class="sd">                        \consists Timing_translator</span>
<span class="sd">                        \consists Time_signature_engraver</span>
<span class="sd">                        \consists Default_bar_line_engraver</span>
<span class="sd">                    }</span>
<span class="sd">                    {</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 3/4</span>
<span class="sd">                            c&#39;2</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                        }</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 3/4</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                            c&#39;2</span>
<span class="sd">                        }</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 3/4</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                        }</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 3/4</span>
<span class="sd">                            c&#39;2</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                        }</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 3/4</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;2</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                    \new Staff</span>
<span class="sd">                    \with</span>
<span class="sd">                    {</span>
<span class="sd">                        \consists Timing_translator</span>
<span class="sd">                        \consists Time_signature_engraver</span>
<span class="sd">                        \consists Default_bar_line_engraver</span>
<span class="sd">                    }</span>
<span class="sd">                    {</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 6/8</span>
<span class="sd">                            c&#39;4.</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                        }</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 6/8</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;4.</span>
<span class="sd">                        }</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 6/8</span>
<span class="sd">                            c&#39;4.</span>
<span class="sd">                            c&#39;4.</span>
<span class="sd">                        }</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 6/8</span>
<span class="sd">                            c&#39;4.</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                        }</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 6/8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;4.</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                &gt;&gt;</span>

<span class="sd">            Note that the two time signatures are much more clearly disambiguated above.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Establishing meter recursively in measures with nested tuplets:</span>

<span class="sd">            &gt;&gt;&gt; lily_string = &quot;| 4/4 c&#39;16 ~ c&#39;4 d&#39;8. ~ &quot;</span>
<span class="sd">            &gt;&gt;&gt; lily_string += &quot;2/3 { d&#39;8. ~ 3/5 { d&#39;16 e&#39;8. f&#39;16 ~ } } &quot;</span>
<span class="sd">            &gt;&gt;&gt; lily_string += &quot;f&#39;4 |&quot;</span>
<span class="sd">            &gt;&gt;&gt; container = abjad.parsers.reduced.parse_reduced_ly_syntax(lily_string)</span>
<span class="sd">            &gt;&gt;&gt; staff = abjad.Staff()</span>
<span class="sd">            &gt;&gt;&gt; staff.append(container)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(staff) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                {</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 4/4</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        ~</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        d&#39;8.</span>
<span class="sd">                        ~</span>
<span class="sd">                        \times 2/3 {</span>
<span class="sd">                            d&#39;8.</span>
<span class="sd">                            ~</span>
<span class="sd">                            \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                            \times 3/5 {</span>
<span class="sd">                                d&#39;16</span>
<span class="sd">                                e&#39;8.</span>
<span class="sd">                                f&#39;16</span>
<span class="sd">                                ~</span>
<span class="sd">                            }</span>
<span class="sd">                        }</span>
<span class="sd">                        f&#39;4</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">            When establishing a meter on a selection of components which contain</span>
<span class="sd">            containers, like tuplets or containers, ``rewrite_meter()`` will recurse into</span>
<span class="sd">            those containers, treating them as measures whose time signature is derived</span>
<span class="sd">            from the preprolated preprolated_duration of the container&#39;s contents:</span>

<span class="sd">            &gt;&gt;&gt; measure = staff[0]</span>
<span class="sd">            &gt;&gt;&gt; time_signature = abjad.get.indicator(</span>
<span class="sd">            ...     measure[0],</span>
<span class="sd">            ...     abjad.TimeSignature</span>
<span class="sd">            ...     )</span>
<span class="sd">            &gt;&gt;&gt; abjad.Meter.rewrite_meter(</span>
<span class="sd">            ...     measure[:],</span>
<span class="sd">            ...     time_signature,</span>
<span class="sd">            ...     boundary_depth=1,</span>
<span class="sd">            ...     )</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(staff) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                {</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 4/4</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        d&#39;8.</span>
<span class="sd">                        ~</span>
<span class="sd">                        \times 2/3 {</span>
<span class="sd">                            d&#39;8</span>
<span class="sd">                            ~</span>
<span class="sd">                            d&#39;16</span>
<span class="sd">                            ~</span>
<span class="sd">                            \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                            \times 3/5 {</span>
<span class="sd">                                d&#39;16</span>
<span class="sd">                                e&#39;8</span>
<span class="sd">                                ~</span>
<span class="sd">                                e&#39;16</span>
<span class="sd">                                f&#39;16</span>
<span class="sd">                                ~</span>
<span class="sd">                            }</span>
<span class="sd">                        }</span>
<span class="sd">                        f&#39;4</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Default rewrite behavior doesn&#39;t subdivide the first note in this measure</span>
<span class="sd">            because the first note in the measure starts at the beginning of a level-0</span>
<span class="sd">            beat in meter:</span>

<span class="sd">            &gt;&gt;&gt; staff = abjad.Staff(&quot;c&#39;4.. c&#39;16 ~ c&#39;4&quot;)</span>
<span class="sd">            &gt;&gt;&gt; abjad.attach(abjad.TimeSignature((6, 8)), staff[0])</span>
<span class="sd">            &gt;&gt;&gt; meter = abjad.Meter((6, 8))</span>
<span class="sd">            &gt;&gt;&gt; abjad.Meter.rewrite_meter(staff[:], meter)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(staff) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                {</span>
<span class="sd">                    \time 6/8</span>
<span class="sd">                    c&#39;4..</span>
<span class="sd">                    c&#39;16</span>
<span class="sd">                    ~</span>
<span class="sd">                    c&#39;4</span>
<span class="sd">                }</span>

<span class="sd">            Setting boundary depth to 1 subdivides the first note in this measure:</span>

<span class="sd">            &gt;&gt;&gt; staff = abjad.Staff(&quot;c&#39;4.. c&#39;16 ~ c&#39;4&quot;)</span>
<span class="sd">            &gt;&gt;&gt; abjad.attach(abjad.TimeSignature((6, 8)), staff[0])</span>
<span class="sd">            &gt;&gt;&gt; meter = abjad.Meter((6, 8))</span>
<span class="sd">            &gt;&gt;&gt; abjad.Meter.rewrite_meter(staff[:], meter, boundary_depth=1)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(staff) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                {</span>
<span class="sd">                    \time 6/8</span>
<span class="sd">                    c&#39;4.</span>
<span class="sd">                    ~</span>
<span class="sd">                    c&#39;16</span>
<span class="sd">                    c&#39;16</span>
<span class="sd">                    ~</span>
<span class="sd">                    c&#39;4</span>
<span class="sd">                }</span>

<span class="sd">            Another way of doing this is by setting preferred boundary depth on the meter</span>
<span class="sd">            itself:</span>

<span class="sd">            &gt;&gt;&gt; staff = abjad.Staff(&quot;c&#39;4.. c&#39;16 ~ c&#39;4&quot;)</span>
<span class="sd">            &gt;&gt;&gt; abjad.attach(abjad.TimeSignature((6, 8)), staff[0])</span>
<span class="sd">            &gt;&gt;&gt; meter = abjad.Meter(</span>
<span class="sd">            ...     (6, 8),</span>
<span class="sd">            ...     preferred_boundary_depth=1,</span>
<span class="sd">            ...     )</span>
<span class="sd">            &gt;&gt;&gt; abjad.Meter.rewrite_meter(staff[:], meter)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(staff) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                {</span>
<span class="sd">                    \time 6/8</span>
<span class="sd">                    c&#39;4.</span>
<span class="sd">                    ~</span>
<span class="sd">                    c&#39;16</span>
<span class="sd">                    c&#39;16</span>
<span class="sd">                    ~</span>
<span class="sd">                    c&#39;4</span>
<span class="sd">                }</span>

<span class="sd">            This makes it possible to divide different meters in different ways.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Rewrites notes and tuplets:</span>

<span class="sd">            &gt;&gt;&gt; lily_string = r&quot;c&#39;8 ~ c&#39;8 ~ c&#39;8 \times 6/7 { c&#39;4. r16 }&quot;</span>
<span class="sd">            &gt;&gt;&gt; lily_string += r&quot; \times 6/7 { r16 c&#39;4. } c&#39;8 ~ c&#39;8 ~ c&#39;8&quot;</span>
<span class="sd">            &gt;&gt;&gt; staff = abjad.Staff(lily_string)</span>
<span class="sd">            &gt;&gt;&gt; abjad.attach(abjad.TimeSignature((6, 4)), staff[0])</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(staff) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                {</span>
<span class="sd">                    \time 6/4</span>
<span class="sd">                    c&#39;8</span>
<span class="sd">                    ~</span>
<span class="sd">                    c&#39;8</span>
<span class="sd">                    ~</span>
<span class="sd">                    c&#39;8</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 6/7 {</span>
<span class="sd">                        c&#39;4.</span>
<span class="sd">                        r16</span>
<span class="sd">                    }</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 6/7 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        c&#39;4.</span>
<span class="sd">                    }</span>
<span class="sd">                    c&#39;8</span>
<span class="sd">                    ~</span>
<span class="sd">                    c&#39;8</span>
<span class="sd">                    ~</span>
<span class="sd">                    c&#39;8</span>
<span class="sd">                }</span>

<span class="sd">            &gt;&gt;&gt; meter = abjad.Meter((6, 4))</span>
<span class="sd">            &gt;&gt;&gt; abjad.Meter.rewrite_meter(</span>
<span class="sd">            ...     staff[:],</span>
<span class="sd">            ...     meter,</span>
<span class="sd">            ...     boundary_depth=1,</span>
<span class="sd">            ...     )</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(staff) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                {</span>
<span class="sd">                    \time 6/4</span>
<span class="sd">                    c&#39;4.</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 6/7 {</span>
<span class="sd">                        c&#39;8.</span>
<span class="sd">                        ~</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        ~</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        r16</span>
<span class="sd">                    }</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 6/7 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        ~</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                    }</span>
<span class="sd">                    c&#39;4.</span>
<span class="sd">                }</span>

<span class="sd">            The tied note rewriting is good while the tuplet rewriting could use some</span>
<span class="sd">            adjustment.</span>

<span class="sd">            Rewrites notes but not tuplets:</span>

<span class="sd">            &gt;&gt;&gt; lily_string = r&quot;c&#39;8 ~ c&#39;8 ~ c&#39;8 \times 6/7 { c&#39;4. r16 }&quot;</span>
<span class="sd">            &gt;&gt;&gt; lily_string += r&quot; \times 6/7 { r16 c&#39;4. } c&#39;8 ~ c&#39;8 ~ c&#39;8&quot;</span>
<span class="sd">            &gt;&gt;&gt; staff = abjad.Staff(lily_string)</span>
<span class="sd">            &gt;&gt;&gt; abjad.attach(abjad.TimeSignature((6, 4)), staff[0])</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(staff) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                {</span>
<span class="sd">                    \time 6/4</span>
<span class="sd">                    c&#39;8</span>
<span class="sd">                    ~</span>
<span class="sd">                    c&#39;8</span>
<span class="sd">                    ~</span>
<span class="sd">                    c&#39;8</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 6/7 {</span>
<span class="sd">                        c&#39;4.</span>
<span class="sd">                        r16</span>
<span class="sd">                    }</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 6/7 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        c&#39;4.</span>
<span class="sd">                    }</span>
<span class="sd">                    c&#39;8</span>
<span class="sd">                    ~</span>
<span class="sd">                    c&#39;8</span>
<span class="sd">                    ~</span>
<span class="sd">                    c&#39;8</span>
<span class="sd">                }</span>

<span class="sd">            &gt;&gt;&gt; meter = abjad.Meter((6, 4))</span>
<span class="sd">            &gt;&gt;&gt; abjad.Meter.rewrite_meter(</span>
<span class="sd">            ...     staff[:],</span>
<span class="sd">            ...     meter,</span>
<span class="sd">            ...     boundary_depth=1,</span>
<span class="sd">            ...     rewrite_tuplets=False,</span>
<span class="sd">            ...     )</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(staff) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                {</span>
<span class="sd">                    \time 6/4</span>
<span class="sd">                    c&#39;4.</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 6/7 {</span>
<span class="sd">                        c&#39;4.</span>
<span class="sd">                        r16</span>
<span class="sd">                    }</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 6/7 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        c&#39;4.</span>
<span class="sd">                    }</span>
<span class="sd">                    c&#39;4.</span>
<span class="sd">                }</span>

<span class="sd">        Operates in place and returns none.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">recurse</span><span class="p">(</span>
            <span class="n">boundary_depth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">boundary_offsets</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">depth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">logical_tie</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="n">offsets</span> <span class="o">=</span> <span class="n">_MeterManager</span><span class="o">.</span><span class="n">get_offsets_at_depth</span><span class="p">(</span><span class="n">depth</span><span class="p">,</span> <span class="n">offset_inventory</span><span class="p">)</span>
            <span class="n">logical_tie_duration</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
                <span class="n">_</span><span class="o">.</span><span class="n">_get_preprolated_duration</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">logical_tie</span>
            <span class="p">)</span>
            <span class="n">logical_tie_timespan</span> <span class="o">=</span> <span class="n">_inspect</span><span class="o">.</span><span class="n">_get_timespan</span><span class="p">(</span><span class="n">logical_tie</span><span class="p">)</span>
            <span class="n">logical_tie_start_offset</span> <span class="o">=</span> <span class="n">logical_tie_timespan</span><span class="o">.</span><span class="n">start_offset</span>
            <span class="n">logical_tie_stop_offset</span> <span class="o">=</span> <span class="n">logical_tie_timespan</span><span class="o">.</span><span class="n">stop_offset</span>
            <span class="n">logical_tie_starts_in_offsets</span> <span class="o">=</span> <span class="n">logical_tie_start_offset</span> <span class="ow">in</span> <span class="n">offsets</span>
            <span class="n">logical_tie_stops_in_offsets</span> <span class="o">=</span> <span class="n">logical_tie_stop_offset</span> <span class="ow">in</span> <span class="n">offsets</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_MeterManager</span><span class="o">.</span><span class="n">is_acceptable_logical_tie</span><span class="p">(</span>
                <span class="n">logical_tie_duration</span><span class="o">=</span><span class="n">logical_tie_duration</span><span class="p">,</span>
                <span class="n">logical_tie_starts_in_offsets</span><span class="o">=</span><span class="n">logical_tie_starts_in_offsets</span><span class="p">,</span>
                <span class="n">logical_tie_stops_in_offsets</span><span class="o">=</span><span class="n">logical_tie_stops_in_offsets</span><span class="p">,</span>
                <span class="n">maximum_dot_count</span><span class="o">=</span><span class="n">maximum_dot_count</span><span class="p">,</span>
            <span class="p">):</span>
                <span class="n">split_offset</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">offsets</span> <span class="o">=</span> <span class="n">_MeterManager</span><span class="o">.</span><span class="n">get_offsets_at_depth</span><span class="p">(</span><span class="n">depth</span><span class="p">,</span> <span class="n">offset_inventory</span><span class="p">)</span>
                <span class="c1"># If the logical tie&#39;s start aligns,</span>
                <span class="c1"># take the latest possible offset.</span>
                <span class="k">if</span> <span class="n">logical_tie_starts_in_offsets</span><span class="p">:</span>
                    <span class="n">offsets</span> <span class="o">=</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">offsets</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">offset</span> <span class="ow">in</span> <span class="n">offsets</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">logical_tie_start_offset</span> <span class="o">&lt;</span> <span class="n">offset</span> <span class="o">&lt;</span> <span class="n">logical_tie_stop_offset</span><span class="p">:</span>
                        <span class="n">split_offset</span> <span class="o">=</span> <span class="n">offset</span>
                        <span class="k">break</span>
                <span class="k">if</span> <span class="n">split_offset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">split_offset</span> <span class="o">-=</span> <span class="n">logical_tie_start_offset</span>
                    <span class="n">shards</span> <span class="o">=</span> <span class="n">_mutate</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">logical_tie</span><span class="p">[:],</span> <span class="p">[</span><span class="n">split_offset</span><span class="p">])</span>
                    <span class="n">logical_ties</span> <span class="o">=</span> <span class="p">[</span><span class="n">_select</span><span class="o">.</span><span class="n">LogicalTie</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">shards</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">logical_tie</span> <span class="ow">in</span> <span class="n">logical_ties</span><span class="p">:</span>
                        <span class="n">recurse</span><span class="p">(</span>
                            <span class="n">boundary_depth</span><span class="o">=</span><span class="n">boundary_depth</span><span class="p">,</span>
                            <span class="n">boundary_offsets</span><span class="o">=</span><span class="n">boundary_offsets</span><span class="p">,</span>
                            <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">,</span>
                            <span class="n">logical_tie</span><span class="o">=</span><span class="n">logical_tie</span><span class="p">,</span>
                        <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">recurse</span><span class="p">(</span>
                        <span class="n">boundary_depth</span><span class="o">=</span><span class="n">boundary_depth</span><span class="p">,</span>
                        <span class="n">boundary_offsets</span><span class="o">=</span><span class="n">boundary_offsets</span><span class="p">,</span>
                        <span class="n">depth</span><span class="o">=</span><span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="n">logical_tie</span><span class="o">=</span><span class="n">logical_tie</span><span class="p">,</span>
                    <span class="p">)</span>
            <span class="k">elif</span> <span class="n">_MeterManager</span><span class="o">.</span><span class="n">is_boundary_crossing_logical_tie</span><span class="p">(</span>
                <span class="n">boundary_depth</span><span class="o">=</span><span class="n">boundary_depth</span><span class="p">,</span>
                <span class="n">boundary_offsets</span><span class="o">=</span><span class="n">boundary_offsets</span><span class="p">,</span>
                <span class="n">logical_tie_start_offset</span><span class="o">=</span><span class="n">logical_tie_start_offset</span><span class="p">,</span>
                <span class="n">logical_tie_stop_offset</span><span class="o">=</span><span class="n">logical_tie_stop_offset</span><span class="p">,</span>
            <span class="p">):</span>
                <span class="n">offsets</span> <span class="o">=</span> <span class="n">boundary_offsets</span>
                <span class="k">if</span> <span class="n">logical_tie_start_offset</span> <span class="ow">in</span> <span class="n">boundary_offsets</span><span class="p">:</span>
                    <span class="n">offsets</span> <span class="o">=</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">boundary_offsets</span><span class="p">)</span>
                <span class="n">split_offset</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">for</span> <span class="n">offset</span> <span class="ow">in</span> <span class="n">offsets</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">logical_tie_start_offset</span> <span class="o">&lt;</span> <span class="n">offset</span> <span class="o">&lt;</span> <span class="n">logical_tie_stop_offset</span><span class="p">:</span>
                        <span class="n">split_offset</span> <span class="o">=</span> <span class="n">offset</span>
                        <span class="k">break</span>
                <span class="k">assert</span> <span class="n">split_offset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="n">split_offset</span> <span class="o">-=</span> <span class="n">logical_tie_start_offset</span>
                <span class="n">shards</span> <span class="o">=</span> <span class="n">_mutate</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">logical_tie</span><span class="p">[:],</span> <span class="p">[</span><span class="n">split_offset</span><span class="p">])</span>
                <span class="n">logical_ties</span> <span class="o">=</span> <span class="p">[</span><span class="n">_select</span><span class="o">.</span><span class="n">LogicalTie</span><span class="p">(</span><span class="n">shard</span><span class="p">)</span> <span class="k">for</span> <span class="n">shard</span> <span class="ow">in</span> <span class="n">shards</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">logical_tie</span> <span class="ow">in</span> <span class="n">logical_ties</span><span class="p">:</span>
                    <span class="n">recurse</span><span class="p">(</span>
                        <span class="n">boundary_depth</span><span class="o">=</span><span class="n">boundary_depth</span><span class="p">,</span>
                        <span class="n">boundary_offsets</span><span class="o">=</span><span class="n">boundary_offsets</span><span class="p">,</span>
                        <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">,</span>
                        <span class="n">logical_tie</span><span class="o">=</span><span class="n">logical_tie</span><span class="p">,</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_mutate</span><span class="o">.</span><span class="n">_fuse</span><span class="p">(</span><span class="n">logical_tie</span><span class="p">[:])</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">meter</span><span class="p">,</span> <span class="n">Meter</span><span class="p">):</span>
            <span class="n">meter</span> <span class="o">=</span> <span class="n">Meter</span><span class="p">(</span><span class="n">meter</span><span class="p">)</span>
        <span class="n">boundary_depth</span> <span class="o">=</span> <span class="n">boundary_depth</span> <span class="ow">or</span> <span class="n">meter</span><span class="o">.</span><span class="n">preferred_boundary_depth</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">meter</span><span class="p">,</span> <span class="n">Meter</span><span class="p">):</span>
            <span class="n">meter</span> <span class="o">=</span> <span class="n">Meter</span><span class="p">(</span><span class="n">meter</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">boundary_depth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">boundary_depth</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">boundary_depth</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">maximum_dot_count</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">maximum_dot_count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">maximum_dot_count</span><span class="p">)</span>
            <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">maximum_dot_count</span>
        <span class="k">if</span> <span class="n">initial_offset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">initial_offset</span> <span class="o">=</span> <span class="n">_duration</span><span class="o">.</span><span class="n">Offset</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">initial_offset</span> <span class="o">=</span> <span class="n">_duration</span><span class="o">.</span><span class="n">Offset</span><span class="p">(</span><span class="n">initial_offset</span><span class="p">)</span>
        <span class="n">first_start_offset</span> <span class="o">=</span> <span class="n">components</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_get_timespan</span><span class="p">()</span><span class="o">.</span><span class="n">start_offset</span>
        <span class="n">last_start_offset</span> <span class="o">=</span> <span class="n">components</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">_get_timespan</span><span class="p">()</span><span class="o">.</span><span class="n">start_offset</span>
        <span class="n">difference</span> <span class="o">=</span> <span class="n">last_start_offset</span> <span class="o">-</span> <span class="n">first_start_offset</span> <span class="o">+</span> <span class="n">initial_offset</span>
        <span class="k">assert</span> <span class="n">difference</span> <span class="o">&lt;</span> <span class="n">meter</span><span class="o">.</span><span class="n">implied_time_signature</span><span class="o">.</span><span class="n">duration</span>
        <span class="c1"># Build offset inventory, adjusted for initial offset and prolation.</span>
        <span class="n">first_offset</span> <span class="o">=</span> <span class="n">components</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_get_timespan</span><span class="p">()</span><span class="o">.</span><span class="n">start_offset</span>
        <span class="n">first_offset</span> <span class="o">-=</span> <span class="n">initial_offset</span>
        <span class="k">if</span> <span class="n">components</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_parent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">prolation</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parentage</span> <span class="o">=</span> <span class="n">_parentage</span><span class="o">.</span><span class="n">Parentage</span><span class="p">(</span><span class="n">components</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_parent</span><span class="p">)</span>
            <span class="n">prolation</span> <span class="o">=</span> <span class="n">parentage</span><span class="o">.</span><span class="n">prolation</span>
        <span class="n">offset_inventory</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">offsets</span> <span class="ow">in</span> <span class="n">meter</span><span class="o">.</span><span class="n">depthwise_offset_inventory</span><span class="p">:</span>
            <span class="n">offsets</span> <span class="o">=</span> <span class="p">[(</span><span class="n">_</span> <span class="o">*</span> <span class="n">prolation</span><span class="p">)</span> <span class="o">+</span> <span class="n">first_offset</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">offsets</span><span class="p">]</span>
            <span class="n">offset_inventory</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">offsets</span><span class="p">))</span>
        <span class="c1"># Build boundary offset inventory, if applicable.</span>
        <span class="k">if</span> <span class="n">boundary_depth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">boundary_offsets</span> <span class="o">=</span> <span class="n">offset_inventory</span><span class="p">[</span><span class="n">boundary_depth</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">boundary_offsets</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Cache results of iterator;</span>
        <span class="c1"># we&#39;ll be mutating the underlying collection</span>
        <span class="n">iterator</span> <span class="o">=</span> <span class="n">_MeterManager</span><span class="o">.</span><span class="n">iterate_rewrite_inputs</span><span class="p">(</span><span class="n">components</span><span class="p">)</span>
        <span class="n">items</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">iterator</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">_select</span><span class="o">.</span><span class="n">LogicalTie</span><span class="p">):</span>
                <span class="n">recurse</span><span class="p">(</span>
                    <span class="n">boundary_depth</span><span class="o">=</span><span class="n">boundary_depth</span><span class="p">,</span>
                    <span class="n">boundary_offsets</span><span class="o">=</span><span class="n">boundary_offsets</span><span class="p">,</span>
                    <span class="n">depth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">logical_tie</span><span class="o">=</span><span class="n">item</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">_score</span><span class="o">.</span><span class="n">Tuplet</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">rewrite_tuplets</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">preprolated_duration</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">_</span><span class="o">.</span><span class="n">_get_preprolated_duration</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">item</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">preprolated_duration</span><span class="o">.</span><span class="n">numerator</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">preprolated_duration</span> <span class="o">=</span> <span class="n">_duration</span><span class="o">.</span><span class="n">NonreducedFraction</span><span class="p">(</span>
                        <span class="n">preprolated_duration</span>
                    <span class="p">)</span>
                    <span class="n">preprolated_duration</span> <span class="o">=</span> <span class="n">preprolated_duration</span><span class="o">.</span><span class="n">with_denominator</span><span class="p">(</span>
                        <span class="n">preprolated_duration</span><span class="o">.</span><span class="n">denominator</span> <span class="o">*</span> <span class="mi">4</span>
                    <span class="p">)</span>
                <span class="n">sub_metrical_hierarchy</span> <span class="o">=</span> <span class="n">Meter</span><span class="p">(</span><span class="n">preprolated_duration</span><span class="p">)</span>
                <span class="n">sub_boundary_depth</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">boundary_depth</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">sub_boundary_depth</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">Meter</span><span class="o">.</span><span class="n">rewrite_meter</span><span class="p">(</span>
                    <span class="n">item</span><span class="p">[:],</span>
                    <span class="n">sub_metrical_hierarchy</span><span class="p">,</span>
                    <span class="n">boundary_depth</span><span class="o">=</span><span class="n">sub_boundary_depth</span><span class="p">,</span>
                    <span class="n">maximum_dot_count</span><span class="o">=</span><span class="n">maximum_dot_count</span><span class="p">,</span>
                <span class="p">)</span></div></div>


<div class="viewcode-block" id="illustrate_meter_list"><a class="viewcode-back" href="../../api/abjad/meter.html#abjad.meter.illustrate_meter_list">[docs]</a><span class="k">def</span> <span class="nf">illustrate_meter_list</span><span class="p">(</span>
    <span class="n">meter_list</span><span class="p">,</span> <span class="n">denominator</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">range_</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_lilypondfile</span><span class="o">.</span><span class="n">LilyPondFile</span><span class="p">:</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Illustrates meters.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; meters = [abjad.Meter(_) for _ in [(3, 4), (5, 16), (7, 8)]]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = abjad.meter.illustrate_meter_list(meters, scale=0.5)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.meter.illustrate_meter_list(meters)</span>
<span class="sd">            &gt;&gt;&gt; markup = lilypond_file.items[0]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(markup)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \markup</span>
<span class="sd">            \column</span>
<span class="sd">            {</span>
<span class="sd">            \combine</span>
<span class="sd">            \combine</span>
<span class="sd">            \translate #&#39;(1.0 . 1)</span>
<span class="sd">            \sans \fontsize #-3 \center-align \fraction 3 4</span>
<span class="sd">            \translate #&#39;(49.38709677419355 . 1)</span>
<span class="sd">            \sans \fontsize #-3 \center-align \fraction 5 16</span>
<span class="sd">            \translate #&#39;(69.54838709677419 . 1)</span>
<span class="sd">            \sans \fontsize #-3 \center-align \fraction 7 8</span>
<span class="sd">            \combine</span>
<span class="sd">            \postscript</span>
<span class="sd">            #&quot;</span>
<span class="sd">            0.2 setlinewidth</span>
<span class="sd">            1 0.5 moveto</span>
<span class="sd">            49.38709677419355 0.5 lineto</span>
<span class="sd">            stroke</span>
<span class="sd">            1 1.25 moveto</span>
<span class="sd">            1 -0.25 lineto</span>
<span class="sd">            stroke</span>
<span class="sd">            49.38709677419355 1.25 moveto</span>
<span class="sd">            49.38709677419355 -0.25 lineto</span>
<span class="sd">            stroke</span>
<span class="sd">            49.38709677419355 0.5 moveto</span>
<span class="sd">            69.54838709677419 0.5 lineto</span>
<span class="sd">            stroke</span>
<span class="sd">            49.38709677419355 1.25 moveto</span>
<span class="sd">            49.38709677419355 -0.25 lineto</span>
<span class="sd">            stroke</span>
<span class="sd">            69.54838709677419 1.25 moveto</span>
<span class="sd">            69.54838709677419 -0.25 lineto</span>
<span class="sd">            stroke</span>
<span class="sd">            69.54838709677419 0.5 moveto</span>
<span class="sd">            126 0.5 lineto</span>
<span class="sd">            stroke</span>
<span class="sd">            69.54838709677419 1.25 moveto</span>
<span class="sd">            69.54838709677419 -0.25 lineto</span>
<span class="sd">            stroke</span>
<span class="sd">            126 1.25 moveto</span>
<span class="sd">            126 -0.25 lineto</span>
<span class="sd">            stroke</span>
<span class="sd">            &quot;</span>
<span class="sd">            \postscript</span>
<span class="sd">            #&quot;</span>
<span class="sd">            1 -2 moveto</span>
<span class="sd">            0 -6.153846153846154 rlineto</span>
<span class="sd">            stroke</span>
<span class="sd">            5.032258064516129 -2 moveto</span>
<span class="sd">            0 -1.5384615384615385 rlineto</span>
<span class="sd">            stroke</span>
<span class="sd">            9.064516129032258 -2 moveto</span>
<span class="sd">            0 -3.076923076923077 rlineto</span>
<span class="sd">            stroke</span>
<span class="sd">            13.096774193548388 -2 moveto</span>
<span class="sd">            0 -1.5384615384615385 rlineto</span>
<span class="sd">            stroke</span>
<span class="sd">            17.129032258064516 -2 moveto</span>
<span class="sd">            0 -4.615384615384616 rlineto</span>
<span class="sd">            stroke</span>
<span class="sd">            21.161290322580644 -2 moveto</span>
<span class="sd">            0 -1.5384615384615385 rlineto</span>
<span class="sd">            stroke</span>
<span class="sd">            25.193548387096776 -2 moveto</span>
<span class="sd">            0 -3.076923076923077 rlineto</span>
<span class="sd">            stroke</span>
<span class="sd">            29.225806451612904 -2 moveto</span>
<span class="sd">            0 -1.5384615384615385 rlineto</span>
<span class="sd">            stroke</span>
<span class="sd">            33.25806451612903 -2 moveto</span>
<span class="sd">            0 -4.615384615384616 rlineto</span>
<span class="sd">            stroke</span>
<span class="sd">            37.29032258064516 -2 moveto</span>
<span class="sd">            0 -1.5384615384615385 rlineto</span>
<span class="sd">            stroke</span>
<span class="sd">            41.32258064516129 -2 moveto</span>
<span class="sd">            0 -3.076923076923077 rlineto</span>
<span class="sd">            stroke</span>
<span class="sd">            45.354838709677416 -2 moveto</span>
<span class="sd">            0 -1.5384615384615385 rlineto</span>
<span class="sd">            stroke</span>
<span class="sd">            49.38709677419355 -2 moveto</span>
<span class="sd">            0 -6.153846153846154 rlineto</span>
<span class="sd">            stroke</span>
<span class="sd">            49.38709677419355 -2 moveto</span>
<span class="sd">            0 -10.909090909090908 rlineto</span>
<span class="sd">            stroke</span>
<span class="sd">            53.41935483870968 -2 moveto</span>
<span class="sd">            0 -3.6363636363636367 rlineto</span>
<span class="sd">            stroke</span>
<span class="sd">            57.45161290322581 -2 moveto</span>
<span class="sd">            0 -3.6363636363636367 rlineto</span>
<span class="sd">            stroke</span>
<span class="sd">            61.483870967741936 -2 moveto</span>
<span class="sd">            0 -7.272727272727273 rlineto</span>
<span class="sd">            stroke</span>
<span class="sd">            65.51612903225806 -2 moveto</span>
<span class="sd">            0 -3.6363636363636367 rlineto</span>
<span class="sd">            stroke</span>
<span class="sd">            69.54838709677419 -2 moveto</span>
<span class="sd">            0 -10.909090909090908 rlineto</span>
<span class="sd">            stroke</span>
<span class="sd">            69.54838709677419 -2 moveto</span>
<span class="sd">            0 -5.517241379310345 rlineto</span>
<span class="sd">            stroke</span>
<span class="sd">            73.58064516129032 -2 moveto</span>
<span class="sd">            0 -1.3793103448275863 rlineto</span>
<span class="sd">            stroke</span>
<span class="sd">            77.61290322580645 -2 moveto</span>
<span class="sd">            0 -2.7586206896551726 rlineto</span>
<span class="sd">            stroke</span>
<span class="sd">            81.64516129032258 -2 moveto</span>
<span class="sd">            0 -1.3793103448275863 rlineto</span>
<span class="sd">            stroke</span>
<span class="sd">            85.6774193548387 -2 moveto</span>
<span class="sd">            0 -2.7586206896551726 rlineto</span>
<span class="sd">            stroke</span>
<span class="sd">            89.70967741935483 -2 moveto</span>
<span class="sd">            0 -1.3793103448275863 rlineto</span>
<span class="sd">            stroke</span>
<span class="sd">            93.74193548387096 -2 moveto</span>
<span class="sd">            0 -4.137931034482759 rlineto</span>
<span class="sd">            stroke</span>
<span class="sd">            97.7741935483871 -2 moveto</span>
<span class="sd">            0 -1.3793103448275863 rlineto</span>
<span class="sd">            stroke</span>
<span class="sd">            101.80645161290323 -2 moveto</span>
<span class="sd">            0 -2.7586206896551726 rlineto</span>
<span class="sd">            stroke</span>
<span class="sd">            105.83870967741936 -2 moveto</span>
<span class="sd">            0 -1.3793103448275863 rlineto</span>
<span class="sd">            stroke</span>
<span class="sd">            109.87096774193549 -2 moveto</span>
<span class="sd">            0 -4.137931034482759 rlineto</span>
<span class="sd">            stroke</span>
<span class="sd">            113.90322580645162 -2 moveto</span>
<span class="sd">            0 -1.3793103448275863 rlineto</span>
<span class="sd">            stroke</span>
<span class="sd">            117.93548387096774 -2 moveto</span>
<span class="sd">            0 -2.7586206896551726 rlineto</span>
<span class="sd">            stroke</span>
<span class="sd">            121.96774193548387 -2 moveto</span>
<span class="sd">            0 -1.3793103448275863 rlineto</span>
<span class="sd">            stroke</span>
<span class="sd">            126 -2 moveto</span>
<span class="sd">            0 -5.517241379310345 rlineto</span>
<span class="sd">            stroke</span>
<span class="sd">            &quot;</span>
<span class="sd">            }</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">durations</span> <span class="o">=</span> <span class="p">[</span><span class="n">_</span><span class="o">.</span><span class="n">duration</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">meter_list</span><span class="p">]</span>
    <span class="n">total_duration</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">durations</span><span class="p">)</span>
    <span class="n">offsets</span> <span class="o">=</span> <span class="n">_math</span><span class="o">.</span><span class="n">cumulative_sums</span><span class="p">(</span><span class="n">durations</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">timespans</span> <span class="o">=</span> <span class="n">_timespan</span><span class="o">.</span><span class="n">TimespanList</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">one</span><span class="p">,</span> <span class="n">two</span> <span class="ow">in</span> <span class="n">_sequence</span><span class="o">.</span><span class="n">nwise</span><span class="p">(</span><span class="n">offsets</span><span class="p">):</span>
        <span class="n">timespan</span> <span class="o">=</span> <span class="n">_timespan</span><span class="o">.</span><span class="n">Timespan</span><span class="p">(</span><span class="n">start_offset</span><span class="o">=</span><span class="n">one</span><span class="p">,</span> <span class="n">stop_offset</span><span class="o">=</span><span class="n">two</span><span class="p">)</span>
        <span class="n">timespans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">timespan</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">range_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">minimum</span><span class="p">,</span> <span class="n">maximum</span> <span class="o">=</span> <span class="n">range_</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">minimum</span><span class="p">,</span> <span class="n">maximum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">total_duration</span>
    <span class="n">minimum</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">_duration</span><span class="o">.</span><span class="n">Offset</span><span class="p">(</span><span class="n">minimum</span><span class="p">))</span>
    <span class="n">maximum</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">_duration</span><span class="o">.</span><span class="n">Offset</span><span class="p">(</span><span class="n">maximum</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">scale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">scale</span>
    <span class="n">postscript_scale</span> <span class="o">=</span> <span class="mf">125.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">maximum</span> <span class="o">-</span> <span class="n">minimum</span><span class="p">)</span>
    <span class="n">postscript_scale</span> <span class="o">*=</span> <span class="nb">float</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>
    <span class="n">postscript_x_offset</span> <span class="o">=</span> <span class="p">(</span><span class="n">minimum</span> <span class="o">*</span> <span class="n">postscript_scale</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">timespan_markup</span> <span class="o">=</span> <span class="n">_timespan</span><span class="o">.</span><span class="n">_make_timespan_list_markup</span><span class="p">(</span>
        <span class="n">timespans</span><span class="p">,</span>
        <span class="n">postscript_x_offset</span><span class="p">,</span>
        <span class="n">postscript_scale</span><span class="p">,</span>
        <span class="n">draw_offsets</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">postscript_strings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">rational_x_offset</span> <span class="o">=</span> <span class="n">_duration</span><span class="o">.</span><span class="n">Offset</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">meter</span> <span class="ow">in</span> <span class="n">meter_list</span><span class="p">:</span>
        <span class="n">kernel_denominator</span> <span class="o">=</span> <span class="n">denominator</span> <span class="ow">or</span> <span class="n">meter</span><span class="o">.</span><span class="n">denominator</span>
        <span class="n">kernel</span> <span class="o">=</span> <span class="n">MetricAccentKernel</span><span class="o">.</span><span class="n">from_meter</span><span class="p">(</span><span class="n">meter</span><span class="p">,</span> <span class="n">kernel_denominator</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">offset</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">kernel</span><span class="o">.</span><span class="n">kernel</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">weight</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="mi">40</span>
            <span class="n">ps_x_offset</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">rational_x_offset</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span>
            <span class="n">ps_x_offset</span> <span class="o">*=</span> <span class="n">postscript_scale</span>
            <span class="n">ps_x_offset</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">postscript_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_timespan</span><span class="o">.</span><span class="n">_fpa</span><span class="p">(</span><span class="n">ps_x_offset</span><span class="p">)</span><span class="si">}</span><span class="s2"> -2 moveto&quot;</span><span class="p">)</span>
            <span class="n">postscript_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;0 </span><span class="si">{</span><span class="n">_timespan</span><span class="o">.</span><span class="n">_fpa</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span><span class="si">}</span><span class="s2"> rlineto&quot;</span><span class="p">)</span>
            <span class="n">postscript_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;stroke&quot;</span><span class="p">)</span>
        <span class="n">rational_x_offset</span> <span class="o">+=</span> <span class="n">meter</span><span class="o">.</span><span class="n">duration</span>
    <span class="n">fraction_pairs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">meter</span><span class="p">,</span> <span class="n">offset</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">meter_list</span><span class="p">,</span> <span class="n">offsets</span><span class="p">):</span>
        <span class="n">numerator</span><span class="p">,</span> <span class="n">denominator</span> <span class="o">=</span> <span class="n">meter</span><span class="o">.</span><span class="n">numerator</span><span class="p">,</span> <span class="n">meter</span><span class="o">.</span><span class="n">denominator</span>
        <span class="n">x_translation</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span> <span class="o">*</span> <span class="n">postscript_scale</span>
        <span class="n">x_translation</span> <span class="o">-=</span> <span class="n">postscript_x_offset</span>
        <span class="n">top_string</span> <span class="o">=</span> <span class="sa">rf</span><span class="s2">&quot;\translate #&#39;(</span><span class="si">{</span><span class="n">x_translation</span><span class="si">}</span><span class="s2"> . 1)&quot;</span>
        <span class="n">bottom_string</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\sans \fontsize #-3 \center-align&quot;</span>
        <span class="n">bottom_string</span> <span class="o">=</span> <span class="n">bottom_string</span> <span class="o">+</span> <span class="sa">rf</span><span class="s2">&quot; \fraction </span><span class="si">{</span><span class="n">numerator</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">denominator</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">pair</span> <span class="o">=</span> <span class="p">(</span><span class="n">top_string</span><span class="p">,</span> <span class="n">bottom_string</span><span class="p">)</span>
        <span class="n">fraction_pairs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pair</span><span class="p">)</span>
    <span class="n">fraction_strings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">fraction_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fraction_pairs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">fraction_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fraction_pairs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">fraction_pairs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">fraction_strings</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;\combine&quot;</span><span class="p">)</span>
        <span class="n">fraction_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">fraction_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">strings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\markup&quot;</span><span class="p">)</span>
    <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\column&quot;</span><span class="p">)</span>
    <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;{&quot;</span><span class="p">)</span>
    <span class="n">strings</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">fraction_strings</span><span class="p">)</span>
    <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\combine&quot;</span><span class="p">)</span>
    <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">timespan_markup</span><span class="o">.</span><span class="n">string</span><span class="p">)</span>
    <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\postscript&quot;</span><span class="p">)</span>
    <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;#&quot;&#39;</span><span class="p">)</span>
    <span class="n">strings</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">postscript_strings</span><span class="p">)</span>
    <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
    <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;}&quot;</span><span class="p">)</span>
    <span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">strings</span><span class="p">)</span>
    <span class="n">markup</span> <span class="o">=</span> <span class="n">_indicators</span><span class="o">.</span><span class="n">Markup</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
    <span class="n">lilypond_file</span> <span class="o">=</span> <span class="n">_lilypondfile</span><span class="o">.</span><span class="n">LilyPondFile</span><span class="p">()</span>
    <span class="n">lilypond_file</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">markup</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">lilypond_file</span></div>


<div class="viewcode-block" id="MetricAccentKernel"><a class="viewcode-back" href="../../api/abjad/meter.html#abjad.meter.MetricAccentKernel">[docs]</a><span class="k">class</span> <span class="nc">MetricAccentKernel</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Metric accent kernel.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; hierarchy = abjad.Meter((7, 8))</span>
<span class="sd">        &gt;&gt;&gt; kernel = hierarchy.generate_offset_kernel_to_denominator(8)</span>
<span class="sd">        &gt;&gt;&gt; kernel</span>
<span class="sd">        MetricAccentKernel(kernel={Offset((0, 1)): Multiplier(3, 14), Offset((7, 8)): Multiplier(3, 14), Offset((3, 8)): Multiplier(1, 7), Offset((5, 8)): Multiplier(1, 7), Offset((1, 8)): Multiplier(1, 14), Offset((1, 4)): Multiplier(1, 14), Offset((1, 2)): Multiplier(1, 14), Offset((3, 4)): Multiplier(1, 14)})</span>

<span class="sd">    Call the kernel against an expression from which offsets can be counted to receive an</span>
<span class="sd">    impulse-response:</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; offsets = [(0, 8), (1, 8), (1, 8), (3, 8)]</span>
<span class="sd">        &gt;&gt;&gt; kernel(offsets)</span>
<span class="sd">        Multiplier(1, 2)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">### CLASS VARIABLES ###</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;_kernel&quot;</span><span class="p">,</span> <span class="s2">&quot;_offsets&quot;</span><span class="p">)</span>

    <span class="c1">### INITIALIZER ###</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">kernel</span> <span class="o">=</span> <span class="n">kernel</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kernel</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kernel</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">_duration</span><span class="o">.</span><span class="n">Offset</span><span class="p">)</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">_duration</span><span class="o">.</span><span class="n">Multiplier</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_kernel</span> <span class="o">=</span> <span class="n">kernel</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_offsets</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_kernel</span><span class="p">))</span>

    <span class="c1">### SPECIAL METHODS ###</span>

<div class="viewcode-block" id="MetricAccentKernel.__call__"><a class="viewcode-back" href="../../api/abjad/meter.html#abjad.meter.MetricAccentKernel.__call__">[docs]</a>    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argument</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calls metrical accent kernal on ``argument``.</span>

<span class="sd">        &gt;&gt;&gt; upper_staff = abjad.Staff(&quot;c&#39;8 d&#39;4. e&#39;8 f&#39;4.&quot;)</span>
<span class="sd">        &gt;&gt;&gt; lower_staff = abjad.Staff(r&#39;\clef bass c4 b,4 a,2&#39;)</span>
<span class="sd">        &gt;&gt;&gt; score = abjad.Score([upper_staff, lower_staff])</span>

<span class="sd">        &gt;&gt;&gt; kernel = abjad.MetricAccentKernel.from_meter((4, 4))</span>
<span class="sd">        &gt;&gt;&gt; kernel(score)</span>
<span class="sd">        Multiplier(10, 33)</span>

<span class="sd">        Returns float.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">offset_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">count_offsets</span><span class="p">(</span><span class="n">argument</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">_duration</span><span class="o">.</span><span class="n">Multiplier</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">offset</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">offset_count</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">offset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kernel</span><span class="p">:</span>
                <span class="n">weight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kernel</span><span class="p">[</span><span class="n">offset</span><span class="p">]</span>
                <span class="n">weighted_count</span> <span class="o">=</span> <span class="n">weight</span> <span class="o">*</span> <span class="n">count</span>
                <span class="n">response</span> <span class="o">+=</span> <span class="n">weighted_count</span>
        <span class="k">return</span> <span class="n">response</span></div>

<div class="viewcode-block" id="MetricAccentKernel.__eq__"><a class="viewcode-back" href="../../api/abjad/meter.html#abjad.meter.MetricAccentKernel.__eq__">[docs]</a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argument</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Is true when ``argument`` is a metrical accent kernal with a kernal equal to that</span>
<span class="sd">        of this metrical accent kernel.</span>

<span class="sd">        Returns true or false.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">argument</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetricAccentKernel.__hash__"><a class="viewcode-back" href="../../api/abjad/meter.html#abjad.meter.MetricAccentKernel.__hash__">[docs]</a>    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hashes metric accent kernel.</span>

<span class="sd">        Returns integer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__hash__</span><span class="p">()</span></div>

<div class="viewcode-block" id="MetricAccentKernel.__repr__"><a class="viewcode-back" href="../../api/abjad/meter.html#abjad.meter.MetricAccentKernel.__repr__">[docs]</a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets repr.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(kernel=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel</span><span class="si">}</span><span class="s2">)&quot;</span></div>

    <span class="c1">### PUBLIC PROPERTIES ###</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">duration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets duration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_duration</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_offsets</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">kernel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The kernel datastructure.</span>

<span class="sd">        Returns dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kernel</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1">### PUBLIC METHODS ###</span>

<div class="viewcode-block" id="MetricAccentKernel.count_offsets"><a class="viewcode-back" href="../../api/abjad/meter.html#abjad.meter.MetricAccentKernel.count_offsets">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">count_offsets</span><span class="p">(</span><span class="n">argument</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_timespan</span><span class="o">.</span><span class="n">OffsetCounter</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Count offsets in ``argument``.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; upper_staff = abjad.Staff(&quot;c&#39;8 d&#39;4. e&#39;8 f&#39;4.&quot;)</span>
<span class="sd">            &gt;&gt;&gt; lower_staff = abjad.Staff(r&#39;\clef bass c4 b,4 a,2&#39;)</span>
<span class="sd">            &gt;&gt;&gt; score = abjad.Score([upper_staff, lower_staff])</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Score</span>
<span class="sd">                &lt;&lt;</span>
<span class="sd">                    \new Staff</span>
<span class="sd">                    {</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        d&#39;4.</span>
<span class="sd">                        e&#39;8</span>
<span class="sd">                        f&#39;4.</span>
<span class="sd">                    }</span>
<span class="sd">                    \new Staff</span>
<span class="sd">                    {</span>
<span class="sd">                        \clef &quot;bass&quot;</span>
<span class="sd">                        c4</span>
<span class="sd">                        b,4</span>
<span class="sd">                        a,2</span>
<span class="sd">                    }</span>
<span class="sd">                &gt;&gt;</span>

<span class="sd">            &gt;&gt;&gt; abjad.show(score) # doctest: +SKIP</span>

<span class="sd">            &gt;&gt;&gt; MetricAccentKernel = abjad.MetricAccentKernel</span>
<span class="sd">            &gt;&gt;&gt; leaves = abjad.select.leaves(score)</span>
<span class="sd">            &gt;&gt;&gt; counter = abjad.MetricAccentKernel.count_offsets(leaves)</span>
<span class="sd">            &gt;&gt;&gt; for offset, count in sorted(counter.items.items()):</span>
<span class="sd">            ...     offset, count</span>
<span class="sd">            (Offset((0, 1)), 2)</span>
<span class="sd">            (Offset((1, 8)), 2)</span>
<span class="sd">            (Offset((1, 4)), 2)</span>
<span class="sd">            (Offset((1, 2)), 4)</span>
<span class="sd">            (Offset((5, 8)), 2)</span>
<span class="sd">            (Offset((1, 1)), 2)</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; a = abjad.Timespan(0, 10)</span>
<span class="sd">            &gt;&gt;&gt; b = abjad.Timespan(5, 15)</span>
<span class="sd">            &gt;&gt;&gt; c = abjad.Timespan(15, 20)</span>

<span class="sd">            &gt;&gt;&gt; counter = MetricAccentKernel.count_offsets((a, b, c))</span>
<span class="sd">            &gt;&gt;&gt; for offset, count in sorted(counter.items.items()):</span>
<span class="sd">            ...     offset, count</span>
<span class="sd">            (Offset((0, 1)), 1)</span>
<span class="sd">            (Offset((5, 1)), 1)</span>
<span class="sd">            (Offset((10, 1)), 1)</span>
<span class="sd">            (Offset((15, 1)), 2)</span>
<span class="sd">            (Offset((20, 1)), 1)</span>

<span class="sd">        Returns counter.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_timespan</span><span class="o">.</span><span class="n">OffsetCounter</span><span class="p">(</span><span class="n">argument</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetricAccentKernel.from_meter"><a class="viewcode-back" href="../../api/abjad/meter.html#abjad.meter.MetricAccentKernel.from_meter">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">from_meter</span><span class="p">(</span><span class="n">meter</span><span class="p">,</span> <span class="n">denominator</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a metric accent kernel from ``meter``.</span>

<span class="sd">        Returns new metric accent kernel.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">meter</span><span class="p">,</span> <span class="n">Meter</span><span class="p">):</span>
            <span class="n">meter</span> <span class="o">=</span> <span class="n">Meter</span><span class="p">(</span><span class="n">meter</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">meter</span><span class="o">.</span><span class="n">generate_offset_kernel_to_denominator</span><span class="p">(</span>
            <span class="n">denominator</span><span class="o">=</span><span class="n">denominator</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="n">normalize</span>
        <span class="p">)</span></div></div>


<span class="k">class</span> <span class="nc">_MeterFittingSession</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Meter-fitting session.</span>

<span class="sd">    Used internally by Meter.fit_meters().</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">### CLASS VARIABLES ###</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;_cached_offset_counters&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_kernel_denominator&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_kernels&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_longest_kernel&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_maximum_run_length&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_meters&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_offset_counter&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_ordered_offsets&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">KernelScore</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">namedtuple</span><span class="p">(</span><span class="s2">&quot;KernelScore&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;kernel&quot;</span><span class="p">,</span> <span class="s2">&quot;score&quot;</span><span class="p">))</span>

    <span class="c1">### INITIALIZER ###</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">kernel_denominator</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>
        <span class="n">maximum_run_length</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">meters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">offset_counter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cached_offset_counters</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">maximum_run_length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">maximum_run_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">maximum_run_length</span><span class="p">)</span>
            <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">maximum_run_length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_maximum_run_length</span> <span class="o">=</span> <span class="n">maximum_run_length</span>
        <span class="k">if</span> <span class="n">offset_counter</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_offset_counter</span> <span class="o">=</span> <span class="n">MetricAccentKernel</span><span class="o">.</span><span class="n">count_offsets</span><span class="p">(</span><span class="n">offset_counter</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_offset_counter</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ordered_offsets</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset_counter</span><span class="o">.</span><span class="n">items</span><span class="p">))</span>
        <span class="n">meters</span> <span class="o">=</span> <span class="n">meters</span> <span class="ow">or</span> <span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_meters</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">Meter</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">meters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_kernel_denominator</span> <span class="o">=</span> <span class="n">_duration</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="n">kernel_denominator</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_kernels</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">meter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meters</span><span class="p">:</span>
            <span class="n">kernel</span> <span class="o">=</span> <span class="n">meter</span><span class="o">.</span><span class="n">generate_offset_kernel_to_denominator</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_kernel_denominator</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_kernels</span><span class="p">[</span><span class="n">kernel</span><span class="p">]</span> <span class="o">=</span> <span class="n">meter</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernels</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_longest_kernel</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_kernels</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="n">_</span><span class="o">.</span><span class="n">duration</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_longest_kernel</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1">### SPECIAL METHODS ###</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fits meters.</span>

<span class="sd">        Returns meter list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">selected_kernels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">current_offset</span> <span class="o">=</span> <span class="n">_duration</span><span class="o">.</span><span class="n">Offset</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">current_offset</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordered_offsets</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">kernel_scores</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">kernels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_kernels</span><span class="p">(</span><span class="n">selected_kernels</span><span class="p">)</span>
            <span class="n">offset_counter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_offset_counter_at</span><span class="p">(</span><span class="n">current_offset</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">offset_counter</span><span class="p">:</span>
                <span class="n">winning_kernel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">longest_kernel</span>
                <span class="k">if</span> <span class="n">selected_kernels</span><span class="p">:</span>
                    <span class="n">winning_kernel</span> <span class="o">=</span> <span class="n">selected_kernels</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">kernel</span> <span class="ow">in</span> <span class="n">kernels</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">maximum_run_length</span>
                        <span class="ow">and</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">kernels</span><span class="p">)</span>
                        <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">maximum_run_length</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected_kernels</span><span class="p">)</span>
                    <span class="p">):</span>
                        <span class="n">last_n_kernels</span> <span class="o">=</span> <span class="n">selected_kernels</span><span class="p">[</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">maximum_run_length</span> <span class="p">:]</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">last_n_kernels</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">kernel</span> <span class="o">==</span> <span class="n">last_n_kernels</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                                <span class="k">continue</span>
                    <span class="n">initial_score</span> <span class="o">=</span> <span class="n">kernel</span><span class="p">(</span><span class="n">offset_counter</span><span class="p">)</span>
                    <span class="n">lookahead_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_lookahead_score</span><span class="p">(</span>
                        <span class="n">current_offset</span><span class="p">,</span> <span class="n">kernel</span><span class="p">,</span> <span class="n">kernels</span>
                    <span class="p">)</span>
                    <span class="n">score</span> <span class="o">=</span> <span class="n">initial_score</span> <span class="o">+</span> <span class="n">lookahead_score</span>
                    <span class="n">kernel_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">KernelScore</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="n">kernel</span><span class="p">,</span> <span class="n">score</span><span class="o">=</span><span class="n">score</span><span class="p">)</span>
                    <span class="n">kernel_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kernel_score</span><span class="p">)</span>
                <span class="n">kernel_scores</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">kernel_score</span><span class="p">:</span> <span class="n">kernel_score</span><span class="o">.</span><span class="n">score</span><span class="p">)</span>
                <span class="n">winning_kernel</span> <span class="o">=</span> <span class="n">kernel_scores</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">kernel</span>
            <span class="n">selected_kernels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">winning_kernel</span><span class="p">)</span>
            <span class="n">current_offset</span> <span class="o">+=</span> <span class="n">winning_kernel</span><span class="o">.</span><span class="n">duration</span>
        <span class="n">selected_meters</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernels</span><span class="p">[</span><span class="n">_</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">selected_kernels</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">selected_meters</span>

    <span class="c1">### PRIVATE METHODS ###</span>

    <span class="k">def</span> <span class="nf">_get_kernels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selected_kernels</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernels</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_lookahead_score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_offset</span><span class="p">,</span> <span class="n">kernel</span><span class="p">,</span> <span class="n">kernels</span><span class="p">):</span>
        <span class="n">lookahead_scores</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">lookahead_offset</span> <span class="o">=</span> <span class="n">current_offset</span> <span class="o">+</span> <span class="n">kernel</span><span class="o">.</span><span class="n">duration</span>
        <span class="n">lookahead_offset_counter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_offset_counter_at</span><span class="p">(</span><span class="n">lookahead_offset</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">lookahead_kernel</span> <span class="ow">in</span> <span class="n">kernels</span><span class="p">:</span>
            <span class="n">lookahead_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lookahead_kernel</span><span class="p">(</span><span class="n">lookahead_offset_counter</span><span class="p">))</span>
        <span class="n">lookahead_score</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">lookahead_scores</span><span class="p">)</span>  <span class="c1"># / len(lookahead_scores)</span>
        <span class="k">return</span> <span class="n">lookahead_score</span>

    <span class="k">def</span> <span class="nf">_get_offset_counter_at</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_offset</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">start_offset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cached_offset_counters</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cached_offset_counters</span><span class="p">[</span><span class="n">start_offset</span><span class="p">]</span>
        <span class="n">offset_counter</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">stop_offset</span> <span class="o">=</span> <span class="n">start_offset</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">longest_kernel</span><span class="o">.</span><span class="n">duration</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_left</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ordered_offsets</span><span class="p">,</span> <span class="n">start_offset</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ordered_offsets</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">offset_counter</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordered_offsets</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">while</span> <span class="n">offset</span> <span class="o">&lt;=</span> <span class="n">stop_offset</span><span class="p">:</span>
            <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset_counter</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">offset</span><span class="p">]</span>
            <span class="n">offset_counter</span><span class="p">[</span><span class="n">offset</span> <span class="o">-</span> <span class="n">start_offset</span><span class="p">]</span> <span class="o">=</span> <span class="n">count</span>
            <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ordered_offsets</span><span class="p">):</span>
                <span class="k">break</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordered_offsets</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cached_offset_counters</span><span class="p">[</span><span class="n">start_offset</span><span class="p">]</span> <span class="o">=</span> <span class="n">offset_counter</span>
        <span class="k">return</span> <span class="n">offset_counter</span>

    <span class="c1">### PUBLIC PROPERTIES ###</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cached_offset_counters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets cached offset counters</span>

<span class="sd">        Returns dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cached_offset_counters</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">kernel_denominator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets kernel denominator.</span>

<span class="sd">        Returns duration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kernel_denominator</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">kernels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets kernels-to-meter dictionary.</span>

<span class="sd">        Returns dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kernels</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">longest_kernel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets longest kernel.</span>

<span class="sd">        Returns kernel.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_longest_kernel</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">maximum_run_length</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets maximum meter repetitions.</span>

<span class="sd">        Returns integer or none.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maximum_run_length</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">meters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets meters.</span>

<span class="sd">        Returns meters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meters</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">offset_counter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets offset counter.</span>

<span class="sd">        Returns offset counter.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_offset_counter</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ordered_offsets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets ordered offsets.</span>

<span class="sd">        Returns offsets.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ordered_offsets</span>


<span class="k">class</span> <span class="nc">_MeterManager</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Meter manager.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">### CLASS VARIABLES ###</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">()</span>

    <span class="c1">### PUBLIC METHODS ###</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_offsets_at_depth</span><span class="p">(</span><span class="n">depth</span><span class="p">,</span> <span class="n">offset_inventory</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets offsets at ``depth`` in ``offset_inventory``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">depth</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">offset_inventory</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">offset_inventory</span><span class="p">[</span><span class="n">depth</span><span class="p">]</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">offset_inventory</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">depth</span><span class="p">:</span>
            <span class="n">new_offsets</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">old_offsets</span> <span class="o">=</span> <span class="n">offset_inventory</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">first</span><span class="p">,</span> <span class="n">second</span> <span class="ow">in</span> <span class="n">_sequence</span><span class="o">.</span><span class="n">nwise</span><span class="p">(</span><span class="n">old_offsets</span><span class="p">):</span>
                <span class="n">new_offsets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">first</span><span class="p">)</span>
                <span class="n">difference</span> <span class="o">=</span> <span class="n">second</span> <span class="o">-</span> <span class="n">first</span>
                <span class="n">half</span> <span class="o">=</span> <span class="p">(</span><span class="n">first</span> <span class="o">+</span> <span class="n">second</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="k">if</span> <span class="n">_duration</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">difference</span><span class="p">:</span>
                    <span class="n">new_offsets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">half</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">one_quarter</span> <span class="o">=</span> <span class="p">(</span><span class="n">first</span> <span class="o">+</span> <span class="n">half</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="n">three_quarters</span> <span class="o">=</span> <span class="p">(</span><span class="n">half</span> <span class="o">+</span> <span class="n">second</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="n">new_offsets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">one_quarter</span><span class="p">)</span>
                    <span class="n">new_offsets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">half</span><span class="p">)</span>
                    <span class="n">new_offsets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">three_quarters</span><span class="p">)</span>
            <span class="n">new_offsets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">old_offsets</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">offset_inventory</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">new_offsets</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">offset_inventory</span><span class="p">[</span><span class="n">depth</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">is_acceptable_logical_tie</span><span class="p">(</span>
        <span class="n">logical_tie_duration</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">logical_tie_starts_in_offsets</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">logical_tie_stops_in_offsets</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">maximum_dot_count</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Is true if logical tie is acceptable.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># print &#39;\tTESTING ACCEPTABILITY&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">logical_tie_duration</span><span class="o">.</span><span class="n">is_assignable</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">maximum_dot_count</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="n">maximum_dot_count</span> <span class="o">&lt;</span> <span class="n">logical_tie_duration</span><span class="o">.</span><span class="n">dot_count</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">logical_tie_starts_in_offsets</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">logical_tie_stops_in_offsets</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">is_boundary_crossing_logical_tie</span><span class="p">(</span>
        <span class="n">boundary_depth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">boundary_offsets</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">logical_tie_start_offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">logical_tie_stop_offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Is true if logical tie crosses meter boundaries.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># print &#39;\tTESTING BOUNDARY CROSSINGS&#39;</span>
        <span class="k">if</span> <span class="n">boundary_depth</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span>
            <span class="n">logical_tie_start_offset</span> <span class="o">&lt;</span> <span class="n">_</span> <span class="o">&lt;</span> <span class="n">logical_tie_stop_offset</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">boundary_offsets</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">logical_tie_start_offset</span> <span class="ow">in</span> <span class="n">boundary_offsets</span>
            <span class="ow">and</span> <span class="n">logical_tie_stop_offset</span> <span class="ow">in</span> <span class="n">boundary_offsets</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">iterate_rewrite_inputs</span><span class="p">(</span><span class="n">argument</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterates topmost masked logical ties, rest groups and containers in ``argument``,</span>
<span class="sd">        masked by ``argument``.</span>

<span class="sd">        &gt;&gt;&gt; string = &quot;! 2/4 c&#39;4 d&#39;4 ~ !&quot;</span>
<span class="sd">        &gt;&gt;&gt; string += &quot;! 4/4 d&#39;8. r16 r8. e&#39;16 ~ &quot;</span>
<span class="sd">        &gt;&gt;&gt; string += &quot;2/3 { e&#39;8 ~ e&#39;8 f&#39;8 ~ } f&#39;4 ~ !&quot;</span>
<span class="sd">        &gt;&gt;&gt; string += &quot;! 4/4 f&#39;8 g&#39;8 ~ g&#39;4 a&#39;4 ~ a&#39;8 b&#39;8 ~ !&quot;</span>
<span class="sd">        &gt;&gt;&gt; string += &quot;! 2/4 b&#39;4 c&#39;&#39;4 !&quot;</span>
<span class="sd">        &gt;&gt;&gt; string = string.replace(&#39;!&#39;, &#39;|&#39;)</span>
<span class="sd">        &gt;&gt;&gt; container = abjad.parsers.reduced.parse_reduced_ly_syntax(string)</span>
<span class="sd">        &gt;&gt;&gt; staff = abjad.Staff()</span>
<span class="sd">        &gt;&gt;&gt; staff[:] = container</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \new Staff</span>
<span class="sd">            {</span>
<span class="sd">                {</span>
<span class="sd">                    \time 2/4</span>
<span class="sd">                    c&#39;4</span>
<span class="sd">                    d&#39;4</span>
<span class="sd">                    ~</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \time 4/4</span>
<span class="sd">                    d&#39;8.</span>
<span class="sd">                    r16</span>
<span class="sd">                    r8.</span>
<span class="sd">                    e&#39;16</span>
<span class="sd">                    ~</span>
<span class="sd">                    \times 2/3 {</span>
<span class="sd">                        e&#39;8</span>
<span class="sd">                        ~</span>
<span class="sd">                        e&#39;8</span>
<span class="sd">                        f&#39;8</span>
<span class="sd">                        ~</span>
<span class="sd">                    }</span>
<span class="sd">                    f&#39;4</span>
<span class="sd">                    ~</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \time 4/4</span>
<span class="sd">                    f&#39;8</span>
<span class="sd">                    g&#39;8</span>
<span class="sd">                    ~</span>
<span class="sd">                    g&#39;4</span>
<span class="sd">                    a&#39;4</span>
<span class="sd">                    ~</span>
<span class="sd">                    a&#39;8</span>
<span class="sd">                    b&#39;8</span>
<span class="sd">                    ~</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \time 2/4</span>
<span class="sd">                    b&#39;4</span>
<span class="sd">                    c&#39;&#39;4</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">        &gt;&gt;&gt; for x in abjad.meter._MeterManager.iterate_rewrite_inputs(</span>
<span class="sd">        ...     staff[0]): x</span>
<span class="sd">        ...</span>
<span class="sd">        LogicalTie(items=[Note(&quot;c&#39;4&quot;)])</span>
<span class="sd">        LogicalTie(items=[Note(&quot;d&#39;4&quot;)])</span>

<span class="sd">        &gt;&gt;&gt; for x in abjad.meter._MeterManager.iterate_rewrite_inputs(</span>
<span class="sd">        ...     staff[1]): x</span>
<span class="sd">        ...</span>
<span class="sd">        LogicalTie(items=[Note(&quot;d&#39;8.&quot;)])</span>
<span class="sd">        LogicalTie(items=[Rest(&#39;r16&#39;), Rest(&#39;r8.&#39;)])</span>
<span class="sd">        LogicalTie(items=[Note(&quot;e&#39;16&quot;)])</span>
<span class="sd">        Tuplet(&#39;3:2&#39;, &quot;e&#39;8 e&#39;8 f&#39;8&quot;)</span>
<span class="sd">        LogicalTie(items=[Note(&quot;f&#39;4&quot;)])</span>

<span class="sd">        &gt;&gt;&gt; for x in abjad.meter._MeterManager.iterate_rewrite_inputs(</span>
<span class="sd">        ...     staff[2]): x</span>
<span class="sd">        ...</span>
<span class="sd">        LogicalTie(items=[Note(&quot;f&#39;8&quot;)])</span>
<span class="sd">        LogicalTie(items=[Note(&quot;g&#39;8&quot;), Note(&quot;g&#39;4&quot;)])</span>
<span class="sd">        LogicalTie(items=[Note(&quot;a&#39;4&quot;), Note(&quot;a&#39;8&quot;)])</span>
<span class="sd">        LogicalTie(items=[Note(&quot;b&#39;8&quot;)])</span>

<span class="sd">        &gt;&gt;&gt; for x in abjad.meter._MeterManager.iterate_rewrite_inputs(</span>
<span class="sd">        ...     staff[3]): x</span>
<span class="sd">        ...</span>
<span class="sd">        LogicalTie(items=[Note(&quot;b&#39;4&quot;)])</span>
<span class="sd">        LogicalTie(items=[Note(&quot;c&#39;&#39;4&quot;)])</span>

<span class="sd">        Returns generator.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">last_tie</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">current_leaf_group</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">current_leaf_group_is_silent</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">argument</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="n">_score</span><span class="o">.</span><span class="n">Note</span> <span class="o">|</span> <span class="n">_score</span><span class="o">.</span><span class="n">Chord</span><span class="p">):</span>
                <span class="n">this_tie_leaves</span> <span class="o">=</span> <span class="n">_iterate</span><span class="o">.</span><span class="n">_get_logical_tie_leaves</span><span class="p">(</span><span class="n">component</span><span class="p">)</span>
                <span class="n">this_tie</span> <span class="o">=</span> <span class="n">_select</span><span class="o">.</span><span class="n">LogicalTie</span><span class="p">(</span><span class="n">this_tie_leaves</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">current_leaf_group</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">current_leaf_group</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">elif</span> <span class="p">(</span>
                    <span class="n">current_leaf_group_is_silent</span>
                    <span class="ow">or</span> <span class="n">this_tie</span> <span class="ow">is</span> <span class="kc">None</span>
                    <span class="ow">or</span> <span class="n">last_tie</span> <span class="o">!=</span> <span class="n">this_tie</span>
                <span class="p">):</span>
                    <span class="k">yield</span> <span class="n">_select</span><span class="o">.</span><span class="n">LogicalTie</span><span class="p">(</span><span class="n">current_leaf_group</span><span class="p">)</span>
                    <span class="n">current_leaf_group</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">current_leaf_group_is_silent</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">current_leaf_group</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">component</span><span class="p">)</span>
                <span class="n">last_tie</span> <span class="o">=</span> <span class="n">this_tie</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="n">_score</span><span class="o">.</span><span class="n">Rest</span> <span class="o">|</span> <span class="n">_score</span><span class="o">.</span><span class="n">Skip</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">current_leaf_group</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">current_leaf_group</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="n">current_leaf_group_is_silent</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="n">_select</span><span class="o">.</span><span class="n">LogicalTie</span><span class="p">(</span><span class="n">current_leaf_group</span><span class="p">)</span>
                    <span class="n">current_leaf_group</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">current_leaf_group_is_silent</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">current_leaf_group</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">component</span><span class="p">)</span>
                <span class="n">last_tie</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="n">_score</span><span class="o">.</span><span class="n">Container</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">current_leaf_group</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="n">_select</span><span class="o">.</span><span class="n">LogicalTie</span><span class="p">(</span><span class="n">current_leaf_group</span><span class="p">)</span>
                    <span class="n">current_leaf_group</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">last_tie</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">yield</span> <span class="n">component</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unhandled component: </span><span class="si">{</span><span class="n">component</span><span class="si">!r}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">current_leaf_group</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">_select</span><span class="o">.</span><span class="n">LogicalTie</span><span class="p">(</span><span class="n">current_leaf_group</span><span class="p">)</span>
</pre></div>

    </div>
    
    </div>
    

<footer>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div> 

</footer>

</div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>